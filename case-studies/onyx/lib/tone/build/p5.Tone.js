(function(root){"use strict";var Tone;function Main(func){Tone=func()}
function Module(func){func(Tone)}
Main(function(){function isUndef(val){return val===void 0}
function isFunction(val){return typeof val==='function'}
var audioContext;if(isUndef(window.AudioContext)){window.AudioContext=window.webkitAudioContext}
if(isUndef(window.OfflineAudioContext)){window.OfflineAudioContext=window.webkitOfflineAudioContext}
if(!isUndef(AudioContext)){audioContext=new AudioContext()}else{throw new Error('Web Audio is not supported in this browser')}
if(!isFunction(AudioContext.prototype.createGain)){AudioContext.prototype.createGain=AudioContext.prototype.createGainNode}
if(!isFunction(AudioContext.prototype.createDelay)){AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode}
if(!isFunction(AudioContext.prototype.createPeriodicWave)){AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable}
if(!isFunction(AudioBufferSourceNode.prototype.start)){AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn}
if(!isFunction(AudioBufferSourceNode.prototype.stop)){AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff}
if(!isFunction(AudioBuffer.prototype.copyToChannel)){AudioBuffer.prototype.copyToChannel=function(source,channelNumber,startInChannel){var clipped=source.subarray(0,Math.min(source.length,this.length-(startInChannel|0)));this.getChannelData(channelNumber|0).set(clipped,startInChannel|0)}}
if(!isFunction(OscillatorNode.prototype.start)){OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn}
if(!isFunction(OscillatorNode.prototype.stop)){OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff}
if(!isFunction(OscillatorNode.prototype.setPeriodicWave)){OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable}
AudioNode.prototype._nativeConnect=AudioNode.prototype.connect;AudioNode.prototype.connect=function(B,outNum,inNum){if(B.input){if(Array.isArray(B.input)){if(isUndef(inNum)){inNum=0}
this.connect(B.input[inNum])}else{this.connect(B.input,outNum,inNum)}}else{try{if(B instanceof AudioNode){this._nativeConnect(B,outNum,inNum)}else{this._nativeConnect(B,outNum)}}catch(e){throw new Error('error connecting to node: '+B)}}};var Tone=function(inputs,outputs){if(isUndef(inputs)||inputs===1){this.input=this.context.createGain()}else if(inputs>1){this.input=new Array(inputs)}
if(isUndef(outputs)||outputs===1){this.output=this.context.createGain()}else if(outputs>1){this.output=new Array(inputs)}};Tone.prototype.set=function(params,value,rampTime){if(this.isObject(params)){rampTime=value}else if(this.isString(params)){var tmpObj={};tmpObj[params]=value;params=tmpObj}
for(var attr in params){value=params[attr];var parent=this;if(attr.indexOf('.')!==-1){var attrSplit=attr.split('.');for(var i=0;i<attrSplit.length-1;i++){parent=parent[attrSplit[i]]}
attr=attrSplit[attrSplit.length-1]}
var param=parent[attr];if(isUndef(param)){continue}
if(Tone.Signal&&param instanceof Tone.Signal||Tone.Param&&param instanceof Tone.Param){if(param.value!==value){if(isUndef(rampTime)){param.value=value}else{param.rampTo(value,rampTime)}}}else if(param instanceof AudioParam){if(param.value!==value){param.value=value}}else if(param instanceof Tone){param.set(value)}else if(param!==value){parent[attr]=value}}
return this};Tone.prototype.get=function(params){if(isUndef(params)){params=this._collectDefaults(this.constructor)}else if(this.isString(params)){params=[params]}
var ret={};for(var i=0;i<params.length;i++){var attr=params[i];var parent=this;var subRet=ret;if(attr.indexOf('.')!==-1){var attrSplit=attr.split('.');for(var j=0;j<attrSplit.length-1;j++){var subAttr=attrSplit[j];subRet[subAttr]=subRet[subAttr]||{};subRet=subRet[subAttr];parent=parent[subAttr]}
attr=attrSplit[attrSplit.length-1]}
var param=parent[attr];if(this.isObject(params[attr])){subRet[attr]=param.get()}else if(Tone.Signal&&param instanceof Tone.Signal){subRet[attr]=param.value}else if(Tone.Param&&param instanceof Tone.Param){subRet[attr]=param.value}else if(param instanceof AudioParam){subRet[attr]=param.value}else if(param instanceof Tone){subRet[attr]=param.get()}else if(!isFunction(param)&&!isUndef(param)){subRet[attr]=param}}
return ret};Tone.prototype._collectDefaults=function(constr){var ret=[];if(!isUndef(constr.defaults)){ret=Object.keys(constr.defaults)}
if(!isUndef(constr._super)){var superDefs=this._collectDefaults(constr._super);for(var i=0;i<superDefs.length;i++){if(ret.indexOf(superDefs[i])===-1){ret.push(superDefs[i])}}}
return ret};Tone.prototype.toString=function(){for(var className in Tone){var isLetter=className[0].match(/^[A-Z]$/);var sameConstructor=Tone[className]===this.constructor;if(isFunction(Tone[className])&&isLetter&&sameConstructor){return className}}
return'Tone'};Tone.context=audioContext;Tone.prototype.context=Tone.context;Tone.prototype.bufferSize=2048;Tone.prototype.blockTime=128/Tone.context.sampleRate;Tone.prototype.dispose=function(){if(!this.isUndef(this.input)){if(this.input instanceof AudioNode){this.input.disconnect()}
this.input=null}
if(!this.isUndef(this.output)){if(this.output instanceof AudioNode){this.output.disconnect()}
this.output=null}
return this};var _silentNode=null;Tone.prototype.noGC=function(){this.output.connect(_silentNode);return this};AudioNode.prototype.noGC=function(){this.connect(_silentNode);return this};Tone.prototype.connect=function(unit,outputNum,inputNum){if(Array.isArray(this.output)){outputNum=this.defaultArg(outputNum,0);this.output[outputNum].connect(unit,0,inputNum)}else{this.output.connect(unit,outputNum,inputNum)}
return this};Tone.prototype.disconnect=function(outputNum){if(Array.isArray(this.output)){outputNum=this.defaultArg(outputNum,0);this.output[outputNum].disconnect()}else{this.output.disconnect()}
return this};Tone.prototype.connectSeries=function(){if(arguments.length>1){var currentUnit=arguments[0];for(var i=1;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit);currentUnit=toUnit}}
return this};Tone.prototype.connectParallel=function(){var connectFrom=arguments[0];if(arguments.length>1){for(var i=1;i<arguments.length;i++){var connectTo=arguments[i];connectFrom.connect(connectTo)}}
return this};Tone.prototype.chain=function(){if(arguments.length>0){var currentUnit=this;for(var i=0;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit);currentUnit=toUnit}}
return this};Tone.prototype.fan=function(){if(arguments.length>0){for(var i=0;i<arguments.length;i++){this.connect(arguments[i])}}
return this};AudioNode.prototype.chain=Tone.prototype.chain;AudioNode.prototype.fan=Tone.prototype.fan;Tone.prototype.defaultArg=function(given,fallback){if(this.isObject(given)&&this.isObject(fallback)){var ret={};for(var givenProp in given){ret[givenProp]=this.defaultArg(fallback[givenProp],given[givenProp])}
for(var fallbackProp in fallback){ret[fallbackProp]=this.defaultArg(given[fallbackProp],fallback[fallbackProp])}
return ret}else{return isUndef(given)?fallback:given}};Tone.prototype.optionsObject=function(values,keys,defaults){var options={};if(values.length===1&&this.isObject(values[0])){options=values[0]}else{for(var i=0;i<keys.length;i++){options[keys[i]]=values[i]}}
if(!this.isUndef(defaults)){return this.defaultArg(options,defaults)}else{return options}};Tone.prototype.isUndef=isUndef;Tone.prototype.isFunction=isFunction;Tone.prototype.isNumber=function(arg){return typeof arg==='number'};Tone.prototype.isObject=function(arg){return Object.prototype.toString.call(arg)==='[object Object]'&&arg.constructor===Object};Tone.prototype.isBoolean=function(arg){return typeof arg==='boolean'};Tone.prototype.isArray=function(arg){return Array.isArray(arg)};Tone.prototype.isString=function(arg){return typeof arg==='string'};Tone.noOp=function(){};Tone.prototype._readOnly=function(property){if(Array.isArray(property)){for(var i=0;i<property.length;i++){this._readOnly(property[i])}}else{Object.defineProperty(this,property,{writable:!1,enumerable:!0})}};Tone.prototype._writable=function(property){if(Array.isArray(property)){for(var i=0;i<property.length;i++){this._writable(property[i])}}else{Object.defineProperty(this,property,{writable:!0})}};Tone.State={Started:'started',Stopped:'stopped',Paused:'paused'};Tone.prototype.equalPowerScale=function(percent){var piFactor=0.5*Math.PI;return Math.sin(percent*piFactor)};Tone.prototype.dbToGain=function(db){return Math.pow(2,db/6)};Tone.prototype.gainToDb=function(gain){return 20*(Math.log(gain)/ Math.LN10);
	    };
	    /
Tone.prototype.now=function(){return this.context.currentTime};Tone.extend=function(child,parent){if(isUndef(parent)){parent=Tone}
function TempConstructor(){}
TempConstructor.prototype=parent.prototype;child.prototype=new TempConstructor();child.prototype.constructor=child;child._super=parent};var newContextCallbacks=[];Tone._initAudioContext=function(callback){callback(Tone.context);newContextCallbacks.push(callback)};Tone.setContext=function(ctx){Tone.prototype.context=ctx;Tone.context=ctx;for(var i=0;i<newContextCallbacks.length;i++){newContextCallbacks[i](ctx)}};Tone.startMobile=function(){var osc=Tone.context.createOscillator();var silent=Tone.context.createGain();silent.gain.value=0;osc.connect(silent);silent.connect(Tone.context.destination);var now=Tone.context.currentTime;osc.start(now);osc.stop(now+1)};Tone._initAudioContext(function(audioContext){Tone.prototype.blockTime=128/audioContext.sampleRate;_silentNode=audioContext.createGain();_silentNode.gain.value=0;_silentNode.connect(audioContext.destination)});Tone.version='r6';console.log('%c * Tone.js '+Tone.version+' * ','background: #000; color: #fff');return Tone});Module(function(Tone){Tone.SignalBase=function(){};Tone.extend(Tone.SignalBase);Tone.SignalBase.prototype.connect=function(node,outputNumber,inputNumber){if(Tone.Signal&&Tone.Signal===node.constructor||Tone.Param&&Tone.Param===node.constructor||Tone.TimelineSignal&&Tone.TimelineSignal===node.constructor){node._param.cancelScheduledValues(0);node._param.value=0;node.overridden=!0}else if(node instanceof AudioParam){node.cancelScheduledValues(0);node.value=0}
Tone.prototype.connect.call(this,node,outputNumber,inputNumber);return this};return Tone.SignalBase});Module(function(Tone){Tone.WaveShaper=function(mapping,bufferLen){this._shaper=this.input=this.output=this.context.createWaveShaper();this._curve=null;if(Array.isArray(mapping)){this.curve=mapping}else if(isFinite(mapping)||this.isUndef(mapping)){this._curve=new Float32Array(this.defaultArg(mapping,1024))}else if(this.isFunction(mapping)){this._curve=new Float32Array(this.defaultArg(bufferLen,1024));this.setMap(mapping)}};Tone.extend(Tone.WaveShaper,Tone.SignalBase);Tone.WaveShaper.prototype.setMap=function(mapping){for(var i=0,len=this._curve.length;i<len;i++){var normalized=i/len*2-1;this._curve[i]=mapping(normalized,i)}
this._shaper.curve=this._curve;return this};Object.defineProperty(Tone.WaveShaper.prototype,'curve',{get:function(){return this._shaper.curve},set:function(mapping){this._curve=new Float32Array(mapping);this._shaper.curve=this._curve}});Object.defineProperty(Tone.WaveShaper.prototype,'oversample',{get:function(){return this._shaper.oversample},set:function(oversampling){if(['none','2x','4x'].indexOf(oversampling)!==-1){this._shaper.oversample=oversampling}else{throw new Error('invalid oversampling: '+oversampling)}}});Tone.WaveShaper.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._shaper.disconnect();this._shaper=null;this._curve=null;return this};return Tone.WaveShaper});Module(function(Tone){Tone.Type={Default:'number',Time:'time',Frequency:'frequency',NormalRange:'normalRange',AudioRange:'audioRange',Decibels:'db',Interval:'interval',BPM:'bpm',Positive:'positive',Cents:'cents',Degrees:'degrees',MIDI:'midi',TransportTime:'transportTime',Ticks:'tick',Note:'note',Milliseconds:'milliseconds',Notation:'notation'};Tone.prototype.isNowRelative=function(){var nowRelative=new RegExp(/^\s*\+(.)+/i);return function(note){return nowRelative.test(note)}}();Tone.prototype.isTicks=function(){var tickFormat=new RegExp(/^\d+i$/i);return function(note){return tickFormat.test(note)}}();Tone.prototype.isNotation=function(){var notationFormat=new RegExp(/^[0-9]+[mnt]$/i);return function(note){return notationFormat.test(note)}}();Tone.prototype.isTransportTime=function(){var transportTimeFormat=new RegExp(/^(\d+(\.\d+)?\:){1,2}(\d+(\.\d+)?)?$/i);return function(transportTime){return transportTimeFormat.test(transportTime)}}();Tone.prototype.isNote=function(){var noteFormat=new RegExp(/^[a-g]{1}(b|#|x|bb)?-?[0-9]+$/i);return function(note){return noteFormat.test(note)}}();Tone.prototype.isFrequency=function(){var freqFormat=new RegExp(/^\d*\.?\d+hz$/i);return function(freq){return freqFormat.test(freq)}}();function getTransportBpm(){if(Tone.Transport&&Tone.Transport.bpm){return Tone.Transport.bpm.value}else{return 120}}
function getTransportTimeSignature(){if(Tone.Transport&&Tone.Transport.timeSignature){return Tone.Transport.timeSignature}else{return 4}}
Tone.prototype.notationToSeconds=function(notation,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm());timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var beatTime=60/bpm;if(notation==='1n'){notation='1m'}
var subdivision=parseInt(notation,10);var beats=0;if(subdivision===0){beats=0}
var lastLetter=notation.slice(-1);if(lastLetter==='t'){beats=4/subdivision*2/3}else if(lastLetter==='n'){beats=4/subdivision}else if(lastLetter==='m'){beats=subdivision*timeSignature}else{beats=0}
return beatTime*beats};Tone.prototype.transportTimeToSeconds=function(transportTime,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm());timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var measures=0;var quarters=0;var sixteenths=0;var split=transportTime.split(':');if(split.length===2){measures=parseFloat(split[0]);quarters=parseFloat(split[1])}else if(split.length===1){quarters=parseFloat(split[0])}else if(split.length===3){measures=parseFloat(split[0]);quarters=parseFloat(split[1]);sixteenths=parseFloat(split[2])}
var beats=measures*timeSignature+quarters+sixteenths/4;return beats*(60/bpm)};Tone.prototype.ticksToSeconds=function(ticks,bpm){if(this.isUndef(Tone.Transport)){return 0}
ticks=parseFloat(ticks);bpm=this.defaultArg(bpm,getTransportBpm());var tickTime=60/bpm/Tone.Transport.PPQ;return tickTime*ticks};Tone.prototype.frequencyToSeconds=function(freq){return 1/parseFloat(freq)};Tone.prototype.samplesToSeconds=function(samples){return samples/this.context.sampleRate};Tone.prototype.secondsToSamples=function(seconds){return seconds*this.context.sampleRate};Tone.prototype.secondsToTransportTime=function(seconds,bpm,timeSignature){bpm=this.defaultArg(bpm,getTransportBpm());timeSignature=this.defaultArg(timeSignature,getTransportTimeSignature());var quarterTime=60/bpm;var quarters=seconds/quarterTime;var measures=Math.floor(quarters/timeSignature);var sixteenths=quarters%1*4;quarters=Math.floor(quarters)%timeSignature;var progress=[measures,quarters,sixteenths];return progress.join(':')};Tone.prototype.secondsToFrequency=function(seconds){return 1/seconds};Tone.prototype.toTransportTime=function(time,bpm,timeSignature){var seconds=this.toSeconds(time);return this.secondsToTransportTime(seconds,bpm,timeSignature)};Tone.prototype.toFrequency=function(freq,now){if(this.isFrequency(freq)){return parseFloat(freq)}else if(this.isNotation(freq)||this.isTransportTime(freq)){return this.secondsToFrequency(this.toSeconds(freq,now))}else if(this.isNote(freq)){return this.noteToFrequency(freq)}else{return freq}};Tone.prototype.toTicks=function(time){if(this.isUndef(Tone.Transport)){return 0}
var bpm=Tone.Transport.bpm.value;var plusNow=0;if(this.isNowRelative(time)){time=time.replace('+','');plusNow=Tone.Transport.ticks}else if(this.isUndef(time)){return Tone.Transport.ticks}
var seconds=this.toSeconds(time);var quarter=60/bpm;var quarters=seconds/quarter;var tickNum=quarters*Tone.Transport.PPQ;return Math.round(tickNum+plusNow)};Tone.prototype.toSamples=function(time){var seconds=this.toSeconds(time);return Math.round(seconds*this.context.sampleRate)};Tone.prototype.toSeconds=function(time,now){now=this.defaultArg(now,this.now());if(this.isNumber(time)){return time}else if(this.isString(time)){var plusTime=0;if(this.isNowRelative(time)){time=time.replace('+','');plusTime=now}
var betweenParens=time.match(/\(([^)(]+)\)/g);if(betweenParens){for(var j=0;j<betweenParens.length;j++){var symbol=betweenParens[j].replace(/[\(\)]/g,'');var symbolVal=this.toSeconds(symbol);time=time.replace(betweenParens[j],symbolVal)}}
if(time.indexOf('@')!==-1){var quantizationSplit=time.split('@');if(!this.isUndef(Tone.Transport)){var toQuantize=quantizationSplit[0].trim();if(toQuantize===''){toQuantize=undefined}
if(plusTime>0){toQuantize='+'+toQuantize;plusTime=0}
var subdivision=quantizationSplit[1].trim();time=Tone.Transport.quantize(toQuantize,subdivision)}else{throw new Error('quantization requires Tone.Transport')}}else{var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){var originalTime=time;for(var i=0;i<components.length;i++){var symb=components[i].trim();if(symb!==''){var val=this.toSeconds(symb);time=time.replace(symb,val)}}
try{time=eval(time)}catch(e){throw new EvalError('cannot evaluate Time: '+originalTime)}}else if(this.isNotation(time)){time=this.notationToSeconds(time)}else if(this.isTransportTime(time)){time=this.transportTimeToSeconds(time)}else if(this.isFrequency(time)){time=this.frequencyToSeconds(time)}else if(this.isTicks(time)){time=this.ticksToSeconds(time)}else{time=parseFloat(time)}}
return time+plusTime}else{return now}};Tone.prototype.toNotation=function(time,bpm,timeSignature){var testNotations=['1m','2n','4n','8n','16n','32n','64n','128n'];var retNotation=toNotationHelper.call(this,time,bpm,timeSignature,testNotations);var testTripletNotations=['1m','2n','2t','4n','4t','8n','8t','16n','16t','32n','32t','64n','64t','128n'];var retTripletNotation=toNotationHelper.call(this,time,bpm,timeSignature,testTripletNotations);if(retTripletNotation.split('+').length<retNotation.split('+').length){return retTripletNotation}else{return retNotation}};function toNotationHelper(time,bpm,timeSignature,testNotations){var seconds=this.toSeconds(time);var threshold=this.notationToSeconds(testNotations[testNotations.length-1],bpm,timeSignature);var retNotation='';for(var i=0;i<testNotations.length;i++){var notationTime=this.notationToSeconds(testNotations[i],bpm,timeSignature);var multiple=seconds/notationTime;var floatingPointError=0.000001;if(1-multiple%1<floatingPointError){multiple+=floatingPointError}
multiple=Math.floor(multiple);if(multiple>0){if(multiple===1){retNotation+=testNotations[i]}else{retNotation+=multiple.toString()+'*'+testNotations[i]}
seconds-=multiple*notationTime;if(seconds<threshold){break}else{retNotation+=' + '}}}
if(retNotation===''){retNotation='0'}
return retNotation}
Tone.prototype.fromUnits=function(val,units){if(this.convert||this.isUndef(this.convert)){switch(units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}}else{return val}};Tone.prototype.toUnits=function(val,units){if(this.convert||this.isUndef(this.convert)){switch(units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}}else{return val}};var noteToScaleIndex={'cbb':-2,'cb':-1,'c':0,'c#':1,'cx':2,'dbb':0,'db':1,'d':2,'d#':3,'dx':4,'ebb':2,'eb':3,'e':4,'e#':5,'ex':6,'fbb':3,'fb':4,'f':5,'f#':6,'fx':7,'gbb':5,'gb':6,'g':7,'g#':8,'gx':9,'abb':7,'ab':8,'a':9,'a#':10,'ax':11,'bbb':9,'bb':10,'b':11,'b#':12,'bx':13};var scaleIndexToNote=['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];Tone.A4=440;Tone.prototype.noteToFrequency=function(note){var parts=note.split(/(-?\d+)/);if(parts.length===3){var index=noteToScaleIndex[parts[0].toLowerCase()];var octave=parts[1];var noteNumber=index+(parseInt(octave,10)+1)*12;return this.midiToFrequency(noteNumber)}else{return 0}};Tone.prototype.frequencyToNote=function(freq){var log=Math.log(freq/Tone.A4)/Math.LN2;var noteNumber=Math.round(12*log)+57;var octave=Math.floor(noteNumber/12);if(octave<0){noteNumber+=-12*octave}
var noteName=scaleIndexToNote[noteNumber%12];return noteName+octave.toString()};Tone.prototype.intervalToFrequencyRatio=function(interval){return Math.pow(2,interval/12)};Tone.prototype.midiToNote=function(midiNumber){var octave=Math.floor(midiNumber/12)-1;var note=midiNumber%12;return scaleIndexToNote[note]+octave};Tone.prototype.noteToMidi=function(note){var parts=note.split(/(\d+)/);if(parts.length===3){var index=noteToScaleIndex[parts[0].toLowerCase()];var octave=parts[1];return index+(parseInt(octave,10)+1)*12}else{return 0}};Tone.prototype.midiToFrequency=function(midi){return Tone.A4*Math.pow(2,(midi-69)/12)};return Tone});Module(function(Tone){Tone.Param=function(){var options=this.optionsObject(arguments,['param','units','convert'],Tone.Param.defaults);this._param=this.input=options.param;this.units=options.units;this.convert=options.convert;this.overridden=!1;if(!this.isUndef(options.value)){this.value=options.value}};Tone.extend(Tone.Param);Tone.Param.defaults={'units':Tone.Type.Default,'convert':!0,'param':undefined};Object.defineProperty(Tone.Param.prototype,'value',{get:function(){return this._toUnits(this._param.value)},set:function(value){var convertedVal=this._fromUnits(value);this._param.value=convertedVal}});Tone.Param.prototype._fromUnits=function(val){if(this.convert||this.isUndef(this.convert)){switch(this.units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}}else{return val}};Tone.Param.prototype._toUnits=function(val){if(this.convert||this.isUndef(this.convert)){switch(this.units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}}else{return val}};Tone.Param.prototype._minOutput=0.00001;Tone.Param.prototype.setValueAtTime=function(value,time){value=this._fromUnits(value);this._param.setValueAtTime(value,this.toSeconds(time));return this};Tone.Param.prototype.setRampPoint=function(now){now=this.defaultArg(now,this.now());var currentVal=this._param.value;this._param.setValueAtTime(currentVal,now);return this};Tone.Param.prototype.linearRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);this._param.linearRampToValueAtTime(value,this.toSeconds(endTime));return this};Tone.Param.prototype.exponentialRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);value=Math.max(this._minOutput,value);this._param.exponentialRampToValueAtTime(value,this.toSeconds(endTime));return this};Tone.Param.prototype.exponentialRampToValue=function(value,rampTime){var now=this.now();var currentVal=this.value;this.setValueAtTime(Math.max(currentVal,this._minOutput),now);this.exponentialRampToValueAtTime(value,now+this.toSeconds(rampTime));return this};Tone.Param.prototype.linearRampToValue=function(value,rampTime){var now=this.now();this.setRampPoint(now);this.linearRampToValueAtTime(value,now+this.toSeconds(rampTime));return this};Tone.Param.prototype.setTargetAtTime=function(value,startTime,timeConstant){value=this._fromUnits(value);value=Math.max(this._minOutput,value);timeConstant=Math.max(this._minOutput,timeConstant);this._param.setTargetAtTime(value,this.toSeconds(startTime),timeConstant);return this};Tone.Param.prototype.setValueCurveAtTime=function(values,startTime,duration){for(var i=0;i<values.length;i++){values[i]=this._fromUnits(values[i])}
this._param.setValueCurveAtTime(values,this.toSeconds(startTime),this.toSeconds(duration));return this};Tone.Param.prototype.cancelScheduledValues=function(startTime){this._param.cancelScheduledValues(this.toSeconds(startTime));return this};Tone.Param.prototype.rampTo=function(value,rampTime){rampTime=this.defaultArg(rampTime,0);if(this.units===Tone.Type.Frequency||this.units===Tone.Type.BPM){this.exponentialRampToValue(value,rampTime)}else{this.linearRampToValue(value,rampTime)}
return this};Tone.Param.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._param=null;return this};return Tone.Param});Module(function(Tone){Tone.Gain=function(){var options=this.optionsObject(arguments,['gain','units'],Tone.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain();this.gain=new Tone.Param({'param':this._gainNode.gain,'units':options.units,'value':options.gain,'convert':options.convert});this._readOnly('gain')};Tone.extend(Tone.Gain);Tone.Gain.defaults={'gain':1,'convert':!0};Tone.Gain.prototype.dispose=function(){Tone.Param.prototype.dispose.call(this);this._gainNode.disconnect();this._gainNode=null;this._writable('gain');this.gain.dispose();this.gain=null};return Tone.Gain});Module(function(Tone){Tone.Signal=function(){var options=this.optionsObject(arguments,['value','units'],Tone.Signal.defaults);this.output=this._gain=this.context.createGain();options.param=this._gain.gain;Tone.Param.call(this,options);this.input=this._param=this._gain.gain;Tone.Signal._constant.chain(this._gain)};Tone.extend(Tone.Signal,Tone.Param);Tone.Signal.defaults={'value':0,'units':Tone.Type.Default,'convert':!0};Tone.Signal.prototype.connect=Tone.SignalBase.prototype.connect;Tone.Signal.prototype.dispose=function(){Tone.Param.prototype.dispose.call(this);this._param=null;this._gain.disconnect();this._gain=null;return this};Tone.Signal._constant=null;Tone._initAudioContext(function(audioContext){var buffer=audioContext.createBuffer(1,128,audioContext.sampleRate);var arr=buffer.getChannelData(0);for(var i=0;i<arr.length;i++){arr[i]=1}
Tone.Signal._constant=audioContext.createBufferSource();Tone.Signal._constant.channelCount=1;Tone.Signal._constant.channelCountMode='explicit';Tone.Signal._constant.buffer=buffer;Tone.Signal._constant.loop=!0;Tone.Signal._constant.start(0);Tone.Signal._constant.noGC()});return Tone.Signal});Module(function(Tone){Tone.Timeline=function(){var options=this.optionsObject(arguments,['memory'],Tone.Timeline.defaults);this._timeline=[];this._toRemove=[];this._iterating=!1;this.memory=options.memory};Tone.extend(Tone.Timeline);Tone.Timeline.defaults={'memory':Infinity};Object.defineProperty(Tone.Timeline.prototype,'length',{get:function(){return this._timeline.length}});Tone.Timeline.prototype.addEvent=function(event){if(this.isUndef(event.time)){throw new Error('events must have a time attribute')}
event.time=this.toSeconds(event.time);if(this._timeline.length){var index=this._search(event.time);this._timeline.splice(index+1,0,event)}else{this._timeline.push(event)}
if(this.length>this.memory){var diff=this.length-this.memory;this._timeline.splice(0,diff)}
return this};Tone.Timeline.prototype.removeEvent=function(event){if(this._iterating){this._toRemove.push(event)}else{var index=this._timeline.indexOf(event);if(index!==-1){this._timeline.splice(index,1)}}
return this};Tone.Timeline.prototype.getEvent=function(time){time=this.toSeconds(time);var index=this._search(time);if(index!==-1){return this._timeline[index]}else{return null}};Tone.Timeline.prototype.getEventAfter=function(time){time=this.toSeconds(time);var index=this._search(time);if(index+1<this._timeline.length){return this._timeline[index+1]}else{return null}};Tone.Timeline.prototype.getEventBefore=function(time){time=this.toSeconds(time);var index=this._search(time);if(index-1>=0){return this._timeline[index-1]}else{return null}};Tone.Timeline.prototype.cancel=function(after){if(this._timeline.length>1){after=this.toSeconds(after);var index=this._search(after);if(index>=0){this._timeline=this._timeline.slice(0,index)}else{this._timeline=[]}}else if(this._timeline.length===1){if(this._timeline[0].time>=after){this._timeline=[]}}
return this};Tone.Timeline.prototype.cancelBefore=function(time){if(this._timeline.length){time=this.toSeconds(time);var index=this._search(time);if(index>=0){this._timeline=this._timeline.slice(index+1)}}
return this};Tone.Timeline.prototype._search=function(time){var beginning=0;var len=this._timeline.length;var end=len;while(beginning<=end&&beginning<len){var midPoint=Math.floor(beginning+(end-beginning)/2);var event=this._timeline[midPoint];if(event.time===time){for(var i=midPoint;i<this._timeline.length;i++){var testEvent=this._timeline[i];if(testEvent.time===time){midPoint=i}}
return midPoint}else if(event.time>time){end=midPoint-1}else if(event.time<time){beginning=midPoint+1}}
return beginning-1};Tone.Timeline.prototype._iterate=function(callback,lowerBound,upperBound){this._iterating=!0;lowerBound=this.defaultArg(lowerBound,0);upperBound=this.defaultArg(upperBound,this._timeline.length-1);for(var i=lowerBound;i<=upperBound;i++){callback(this._timeline[i])}
this._iterating=!1;if(this._toRemove.length>0){for(var j=0;j<this._toRemove.length;j++){var index=this._timeline.indexOf(this._toRemove[j]);if(index!==-1){this._timeline.splice(index,1)}}
this._toRemove=[]}};Tone.Timeline.prototype.forEach=function(callback){this._iterate(callback);return this};Tone.Timeline.prototype.forEachBefore=function(time,callback){time=this.toSeconds(time);var upperBound=this._search(time);if(upperBound!==-1){this._iterate(callback,0,upperBound)}
return this};Tone.Timeline.prototype.forEachAfter=function(time,callback){time=this.toSeconds(time);var lowerBound=this._search(time);this._iterate(callback,lowerBound+1);return this};Tone.Timeline.prototype.forEachFrom=function(time,callback){time=this.toSeconds(time);var lowerBound=this._search(time);while(lowerBound>=0&&this._timeline[lowerBound].time>=time){lowerBound--}
this._iterate(callback,lowerBound+1);return this};Tone.Timeline.prototype.forEachAtTime=function(time,callback){time=this.toSeconds(time);var upperBound=this._search(time);if(upperBound!==-1){this._iterate(function(event){if(event.time===time){callback(event)}},0,upperBound)}
return this};Tone.Timeline.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._timeline=null;this._toRemove=null};return Tone.Timeline});Module(function(Tone){Tone.TimelineSignal=function(){var options=this.optionsObject(arguments,['value','units'],Tone.Signal.defaults);Tone.Signal.apply(this,options);options.param=this._param;Tone.Param.call(this,options);this._events=new Tone.Timeline(10);this._initial=this._fromUnits(this._param.value)};Tone.extend(Tone.TimelineSignal,Tone.Param);Tone.TimelineSignal.Type={Linear:'linear',Exponential:'exponential',Target:'target',Set:'set'};Object.defineProperty(Tone.TimelineSignal.prototype,'value',{get:function(){return this._toUnits(this._param.value)},set:function(value){var convertedVal=this._fromUnits(value);this._initial=convertedVal;this._param.value=convertedVal}});Tone.TimelineSignal.prototype.setValueAtTime=function(value,startTime){value=this._fromUnits(value);startTime=this.toSeconds(startTime);this._events.addEvent({'type':Tone.TimelineSignal.Type.Set,'value':value,'time':startTime});this._param.setValueAtTime(value,startTime);return this};Tone.TimelineSignal.prototype.linearRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);endTime=this.toSeconds(endTime);this._events.addEvent({'type':Tone.TimelineSignal.Type.Linear,'value':value,'time':endTime});this._param.linearRampToValueAtTime(value,endTime);return this};Tone.TimelineSignal.prototype.exponentialRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);value=Math.max(this._minOutput,value);endTime=this.toSeconds(endTime);this._events.addEvent({'type':Tone.TimelineSignal.Type.Exponential,'value':value,'time':endTime});this._param.exponentialRampToValueAtTime(value,endTime);return this};Tone.TimelineSignal.prototype.setTargetAtTime=function(value,startTime,timeConstant){value=this._fromUnits(value);value=Math.max(this._minOutput,value);timeConstant=Math.max(this._minOutput,timeConstant);startTime=this.toSeconds(startTime);this._events.addEvent({'type':Tone.TimelineSignal.Type.Target,'value':value,'time':startTime,'constant':timeConstant});this._param.setTargetAtTime(value,startTime,timeConstant);return this};Tone.TimelineSignal.prototype.cancelScheduledValues=function(after){this._events.cancel(after);this._param.cancelScheduledValues(this.toSeconds(after));return this};Tone.TimelineSignal.prototype.setRampPoint=function(time){time=this.toSeconds(time);var val=this.getValueAtTime(time);var after=this._searchAfter(time);if(after){this.cancelScheduledValues(time);if(after.type===Tone.TimelineSignal.Type.Linear){this.linearRampToValueAtTime(val,time)}else if(after.type===Tone.TimelineSignal.Type.Exponential){this.exponentialRampToValueAtTime(val,time)}}
this.setValueAtTime(val,time);return this};Tone.TimelineSignal.prototype.linearRampToValueBetween=function(value,start,finish){this.setRampPoint(start);this.linearRampToValueAtTime(value,finish);return this};Tone.TimelineSignal.prototype.exponentialRampToValueBetween=function(value,start,finish){this.setRampPoint(start);this.exponentialRampToValueAtTime(value,finish);return this};Tone.TimelineSignal.prototype._searchBefore=function(time){return this._events.getEvent(time)};Tone.TimelineSignal.prototype._searchAfter=function(time){return this._events.getEventAfter(time)};Tone.TimelineSignal.prototype.getValueAtTime=function(time){var after=this._searchAfter(time);var before=this._searchBefore(time);var value=this._initial;if(before===null){value=this._initial}else if(before.type===Tone.TimelineSignal.Type.Target){var previous=this._events.getEventBefore(before.time);var previouVal;if(previous===null){previouVal=this._initial}else{previouVal=previous.value}
value=this._exponentialApproach(before.time,previouVal,before.value,before.constant,time)}else if(after===null){value=before.value}else if(after.type===Tone.TimelineSignal.Type.Linear){value=this._linearInterpolate(before.time,before.value,after.time,after.value,time)}else if(after.type===Tone.TimelineSignal.Type.Exponential){value=this._exponentialInterpolate(before.time,before.value,after.time,after.value,time)}else{value=before.value}
return value};Tone.TimelineSignal.prototype.connect=Tone.SignalBase.prototype.connect;Tone.TimelineSignal.prototype._exponentialApproach=function(t0,v0,v1,timeConstant,t){return v1+(v0-v1)*Math.exp(-(t-t0)/timeConstant)};Tone.TimelineSignal.prototype._linearInterpolate=function(t0,v0,t1,v1,t){return v0+(v1-v0)*((t-t0)/(t1-t0))};Tone.TimelineSignal.prototype._exponentialInterpolate=function(t0,v0,t1,v1,t){v0=Math.max(this._minOutput,v0);return v0*Math.pow(v1/v0,(t-t0)/(t1-t0))};Tone.TimelineSignal.prototype.dispose=function(){Tone.Signal.prototype.dispose.call(this);Tone.Param.prototype.dispose.call(this);this._events.dispose();this._events=null};return Tone.TimelineSignal});Module(function(Tone){Tone.Pow=function(exp){this._exp=this.defaultArg(exp,1);this._expScaler=this.input=this.output=new Tone.WaveShaper(this._expFunc(this._exp),8192)};Tone.extend(Tone.Pow,Tone.SignalBase);Object.defineProperty(Tone.Pow.prototype,'value',{get:function(){return this._exp},set:function(exp){this._exp=exp;this._expScaler.setMap(this._expFunc(this._exp))}});Tone.Pow.prototype._expFunc=function(exp){return function(val){return Math.pow(Math.abs(val),exp)}};Tone.Pow.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._expScaler.dispose();this._expScaler=null;return this};return Tone.Pow});Module(function(Tone){Tone.Envelope=function(){var options=this.optionsObject(arguments,['attack','decay','sustain','release'],Tone.Envelope.defaults);this.attack=options.attack;this.decay=options.decay;this.sustain=options.sustain;this.release=options.release;this._attackCurve=Tone.Envelope.Type.Linear;this._releaseCurve=Tone.Envelope.Type.Exponential;this._minOutput=0.00001;this._sig=this.output=new Tone.TimelineSignal();this._sig.setValueAtTime(this._minOutput,0);this.attackCurve=options.attackCurve;this.releaseCurve=options.releaseCurve};Tone.extend(Tone.Envelope);Tone.Envelope.defaults={'attack':0.01,'decay':0.1,'sustain':0.5,'release':1,'attackCurve':'linear','releaseCurve':'exponential'};Tone.Envelope.prototype._timeMult=0.25;Object.defineProperty(Tone.Envelope.prototype,'value',{get:function(){return this._sig.value}});Object.defineProperty(Tone.Envelope.prototype,'attackCurve',{get:function(){return this._attackCurve},set:function(type){if(type===Tone.Envelope.Type.Linear||type===Tone.Envelope.Type.Exponential){this._attackCurve=type}else{throw Error('attackCurve must be either "linear" or "exponential". Invalid type: ',type)}}});Object.defineProperty(Tone.Envelope.prototype,'releaseCurve',{get:function(){return this._releaseCurve},set:function(type){if(type===Tone.Envelope.Type.Linear||type===Tone.Envelope.Type.Exponential){this._releaseCurve=type}else{throw Error('releaseCurve must be either "linear" or "exponential". Invalid type: ',type)}}});Tone.Envelope.prototype.triggerAttack=function(time,velocity){var now=this.now()+this.blockTime;time=this.toSeconds(time,now);var attack=this.toSeconds(this.attack)+time;var decay=this.toSeconds(this.decay);velocity=this.defaultArg(velocity,1);if(this._attackCurve===Tone.Envelope.Type.Linear){this._sig.linearRampToValueBetween(velocity,time,attack)}else{this._sig.exponentialRampToValueBetween(velocity,time,attack)}
this._sig.setValueAtTime(velocity,attack);this._sig.exponentialRampToValueAtTime(this.sustain*velocity,attack+decay);return this};Tone.Envelope.prototype.triggerRelease=function(time){var now=this.now()+this.blockTime;time=this.toSeconds(time,now);var release=this.toSeconds(this.release);if(this._releaseCurve===Tone.Envelope.Type.Linear){this._sig.linearRampToValueBetween(this._minOutput,time,time+release)}else{this._sig.exponentialRampToValueBetween(this._minOutput,time,release+time)}
return this};Tone.Envelope.prototype.triggerAttackRelease=function(duration,time,velocity){time=this.toSeconds(time);this.triggerAttack(time,velocity);this.triggerRelease(time+this.toSeconds(duration));return this};Tone.Envelope.prototype.connect=Tone.Signal.prototype.connect;Tone.Envelope.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._sig.dispose();this._sig=null;return this};Tone.Envelope.Phase={Attack:'attack',Decay:'decay',Sustain:'sustain',Release:'release',Standby:'standby'};Tone.Envelope.Type={Linear:'linear',Exponential:'exponential'};return Tone.Envelope});Module(function(Tone){Tone.AmplitudeEnvelope=function(){Tone.Envelope.apply(this,arguments);this.input=this.output=new Tone.Gain();this._sig.connect(this.output.gain)};Tone.extend(Tone.AmplitudeEnvelope,Tone.Envelope);Tone.AmplitudeEnvelope.prototype.dispose=function(){this.input.dispose();this.input=null;Tone.Envelope.prototype.dispose.call(this);return this};return Tone.AmplitudeEnvelope});Module(function(Tone){Tone.Analyser=function(){var options=this.optionsObject(arguments,['size','type'],Tone.Analyser.defaults);this._analyser=this.input=this.context.createAnalyser();this._type=options.type;this._returnType=options.returnType;this._buffer=null;this.size=options.size;this.type=options.type;this.returnType=options.returnType;this.minDecibels=options.minDecibels;this.maxDecibels=options.maxDecibels};Tone.extend(Tone.Analyser);Tone.Analyser.defaults={'size':2048,'returnType':'byte','type':'fft','smoothing':0.8,'maxDecibels':-30,'minDecibels':-100};Tone.Analyser.Type={Waveform:'waveform',FFT:'fft'};Tone.Analyser.ReturnType={Byte:'byte',Float:'float'};Tone.Analyser.prototype.analyse=function(){if(this._type===Tone.Analyser.Type.FFT){if(this._returnType===Tone.Analyser.ReturnType.Byte){this._analyser.getByteFrequencyData(this._buffer)}else{this._analyser.getFloatFrequencyData(this._buffer)}}else if(this._type===Tone.Analyser.Type.Waveform){if(this._returnType===Tone.Analyser.ReturnType.Byte){this._analyser.getByteTimeDomainData(this._buffer)}else{this._analyser.getFloatTimeDomainData(this._buffer)}}
return this._buffer};Object.defineProperty(Tone.Analyser.prototype,'size',{get:function(){return this._analyser.frequencyBinCount},set:function(size){this._analyser.fftSize=size*2;this.type=this._type}});Object.defineProperty(Tone.Analyser.prototype,'returnType',{get:function(){return this._returnType},set:function(type){if(type===Tone.Analyser.ReturnType.Byte){this._buffer=new Uint8Array(this._analyser.frequencyBinCount)}else if(type===Tone.Analyser.ReturnType.Float){this._buffer=new Float32Array(this._analyser.frequencyBinCount)}else{throw new Error('Invalid Return Type: '+type)}
this._returnType=type}});Object.defineProperty(Tone.Analyser.prototype,'type',{get:function(){return this._type},set:function(type){if(type!==Tone.Analyser.Type.Waveform&&type!==Tone.Analyser.Type.FFT){throw new Error('Invalid Type: '+type)}
this._type=type}});Object.defineProperty(Tone.Analyser.prototype,'smoothing',{get:function(){return this._analyser.smoothingTimeConstant},set:function(val){this._analyser.smoothingTimeConstant=val}});Object.defineProperty(Tone.Analyser.prototype,'minDecibels',{get:function(){return this._analyser.minDecibels},set:function(val){this._analyser.minDecibels=val}});Object.defineProperty(Tone.Analyser.prototype,'maxDecibels',{get:function(){return this._analyser.maxDecibels},set:function(val){this._analyser.maxDecibels=val}});Tone.Analyser.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._analyser.disconnect();this._analyser=null;this._buffer=null};return Tone.Analyser});Module(function(Tone){Tone.Compressor=function(){var options=this.optionsObject(arguments,['threshold','ratio'],Tone.Compressor.defaults);this._compressor=this.input=this.output=this.context.createDynamicsCompressor();this.threshold=this._compressor.threshold;this.attack=new Tone.Param(this._compressor.attack,Tone.Type.Time);this.release=new Tone.Param(this._compressor.release,Tone.Type.Time);this.knee=this._compressor.knee;this.ratio=this._compressor.ratio;this._readOnly(['knee','release','attack','ratio','threshold']);this.set(options)};Tone.extend(Tone.Compressor);Tone.Compressor.defaults={'ratio':12,'threshold':-24,'release':0.25,'attack':0.003,'knee':30};Tone.Compressor.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['knee','release','attack','ratio','threshold']);this._compressor.disconnect();this._compressor=null;this.attack.dispose();this.attack=null;this.release.dispose();this.release=null;this.threshold=null;this.ratio=null;this.knee=null;return this};return Tone.Compressor});Module(function(Tone){Tone.Add=function(value){Tone.call(this,2,0);this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain();this._param=this.input[1]=new Tone.Signal(value);this._param.connect(this._sum)};Tone.extend(Tone.Add,Tone.Signal);Tone.Add.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._sum.disconnect();this._sum=null;this._param.dispose();this._param=null;return this};return Tone.Add});Module(function(Tone){Tone.Multiply=function(value){Tone.call(this,2,0);this._mult=this.input[0]=this.output=this.context.createGain();this._param=this.input[1]=this.output.gain;this._param.value=this.defaultArg(value,0)};Tone.extend(Tone.Multiply,Tone.Signal);Tone.Multiply.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._mult.disconnect();this._mult=null;this._param=null;return this};return Tone.Multiply});Module(function(Tone){Tone.Negate=function(){this._multiply=this.input=this.output=new Tone.Multiply(-1)};Tone.extend(Tone.Negate,Tone.SignalBase);Tone.Negate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._multiply.dispose();this._multiply=null;return this};return Tone.Negate});Module(function(Tone){Tone.Subtract=function(value){Tone.call(this,2,0);this._sum=this.input[0]=this.output=this.context.createGain();this._neg=new Tone.Negate();this._param=this.input[1]=new Tone.Signal(value);this._param.chain(this._neg,this._sum)};Tone.extend(Tone.Subtract,Tone.Signal);Tone.Subtract.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._neg.dispose();this._neg=null;this._sum.disconnect();this._sum=null;this._param.dispose();this._param=null;return this};return Tone.Subtract});Module(function(Tone){Tone.GreaterThanZero=function(){this._thresh=this.output=new Tone.WaveShaper(function(val){if(val<=0){return 0}else{return 1}});this._scale=this.input=new Tone.Multiply(10000);this._scale.connect(this._thresh)};Tone.extend(Tone.GreaterThanZero,Tone.SignalBase);Tone.GreaterThanZero.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._thresh.dispose();this._thresh=null;return this};return Tone.GreaterThanZero});Module(function(Tone){Tone.EqualZero=function(){this._scale=this.input=new Tone.Multiply(10000);this._thresh=new Tone.WaveShaper(function(val){if(val===0){return 1}else{return 0}},128);this._gtz=this.output=new Tone.GreaterThanZero();this._scale.chain(this._thresh,this._gtz)};Tone.extend(Tone.EqualZero,Tone.SignalBase);Tone.EqualZero.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._gtz.dispose();this._gtz=null;this._scale.dispose();this._scale=null;this._thresh.dispose();this._thresh=null;return this};return Tone.EqualZero});Module(function(Tone){Tone.Equal=function(value){Tone.call(this,2,0);this._sub=this.input[0]=new Tone.Subtract(value);this._equals=this.output=new Tone.EqualZero();this._sub.connect(this._equals);this.input[1]=this._sub.input[1]};Tone.extend(Tone.Equal,Tone.SignalBase);Object.defineProperty(Tone.Equal.prototype,'value',{get:function(){return this._sub.value},set:function(value){this._sub.value=value}});Tone.Equal.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._equals.dispose();this._equals=null;this._sub.dispose();this._sub=null;return this};return Tone.Equal});Module(function(Tone){Tone.Select=function(sourceCount){sourceCount=this.defaultArg(sourceCount,2);Tone.call(this,sourceCount,1);this.gate=new Tone.Signal(0);this._readOnly('gate');for(var i=0;i<sourceCount;i++){var switchGate=new SelectGate(i);this.input[i]=switchGate;this.gate.connect(switchGate.selecter);switchGate.connect(this.output)}};Tone.extend(Tone.Select,Tone.SignalBase);Tone.Select.prototype.select=function(which,time){which=Math.floor(which);this.gate.setValueAtTime(which,this.toSeconds(time));return this};Tone.Select.prototype.dispose=function(){this._writable('gate');this.gate.dispose();this.gate=null;for(var i=0;i<this.input.length;i++){this.input[i].dispose();this.input[i]=null}
Tone.prototype.dispose.call(this);return this};var SelectGate=function(num){this.selecter=new Tone.Equal(num);this.gate=this.input=this.output=this.context.createGain();this.selecter.connect(this.gate.gain)};Tone.extend(SelectGate);SelectGate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.selecter.dispose();this.gate.disconnect();this.selecter=null;this.gate=null};return Tone.Select});Module(function(Tone){Tone.IfThenElse=function(){Tone.call(this,3,0);this._selector=this.output=new Tone.Select(2);this.if=this.input[0]=this._selector.gate;this.then=this.input[1]=this._selector.input[1];this.else=this.input[2]=this._selector.input[0]};Tone.extend(Tone.IfThenElse,Tone.SignalBase);Tone.IfThenElse.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._selector.dispose();this._selector=null;this.if=null;this.then=null;this.else=null;return this};return Tone.IfThenElse});Module(function(Tone){Tone.OR=function(inputCount){inputCount=this.defaultArg(inputCount,2);Tone.call(this,inputCount,0);this._sum=this.context.createGain();this._gtz=this.output=new Tone.GreaterThanZero();for(var i=0;i<inputCount;i++){this.input[i]=this._sum}
this._sum.connect(this._gtz)};Tone.extend(Tone.OR,Tone.SignalBase);Tone.OR.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._gtz.dispose();this._gtz=null;this._sum.disconnect();this._sum=null;return this};return Tone.OR});Module(function(Tone){Tone.AND=function(inputCount){inputCount=this.defaultArg(inputCount,2);Tone.call(this,inputCount,0);this._equals=this.output=new Tone.Equal(inputCount);for(var i=0;i<inputCount;i++){this.input[i]=this._equals}};Tone.extend(Tone.AND,Tone.SignalBase);Tone.AND.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._equals.dispose();this._equals=null;return this};return Tone.AND});Module(function(Tone){Tone.NOT=Tone.EqualZero;return Tone.NOT});Module(function(Tone){Tone.GreaterThan=function(value){Tone.call(this,2,0);this._param=this.input[0]=new Tone.Subtract(value);this.input[1]=this._param.input[1];this._gtz=this.output=new Tone.GreaterThanZero();this._param.connect(this._gtz)};Tone.extend(Tone.GreaterThan,Tone.Signal);Tone.GreaterThan.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._param.dispose();this._param=null;this._gtz.dispose();this._gtz=null;return this};return Tone.GreaterThan});Module(function(Tone){Tone.LessThan=function(value){Tone.call(this,2,0);this._neg=this.input[0]=new Tone.Negate();this._gt=this.output=new Tone.GreaterThan();this._rhNeg=new Tone.Negate();this._param=this.input[1]=new Tone.Signal(value);this._neg.connect(this._gt);this._param.connect(this._rhNeg);this._rhNeg.connect(this._gt,0,1)};Tone.extend(Tone.LessThan,Tone.Signal);Tone.LessThan.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._neg.dispose();this._neg=null;this._gt.dispose();this._gt=null;this._rhNeg.dispose();this._rhNeg=null;this._param.dispose();this._param=null;return this};return Tone.LessThan});Module(function(Tone){Tone.Abs=function(){Tone.call(this,1,0);this._ltz=new Tone.LessThan(0);this._switch=this.output=new Tone.Select(2);this._negate=new Tone.Negate();this.input.connect(this._switch,0,0);this.input.connect(this._negate);this._negate.connect(this._switch,0,1);this.input.chain(this._ltz,this._switch.gate)};Tone.extend(Tone.Abs,Tone.SignalBase);Tone.Abs.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._switch.dispose();this._switch=null;this._ltz.dispose();this._ltz=null;this._negate.dispose();this._negate=null;return this};return Tone.Abs});Module(function(Tone){Tone.Max=function(max){Tone.call(this,2,0);this.input[0]=this.context.createGain();this._param=this.input[1]=new Tone.Signal(max);this._ifThenElse=this.output=new Tone.IfThenElse();this._gt=new Tone.GreaterThan();this.input[0].chain(this._gt,this._ifThenElse.if);this.input[0].connect(this._ifThenElse.then);this._param.connect(this._ifThenElse.else);this._param.connect(this._gt,0,1)};Tone.extend(Tone.Max,Tone.Signal);Tone.Max.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._param.dispose();this._ifThenElse.dispose();this._gt.dispose();this._param=null;this._ifThenElse=null;this._gt=null;return this};return Tone.Max});Module(function(Tone){Tone.Min=function(min){Tone.call(this,2,0);this.input[0]=this.context.createGain();this._ifThenElse=this.output=new Tone.IfThenElse();this._lt=new Tone.LessThan();this._param=this.input[1]=new Tone.Signal(min);this.input[0].chain(this._lt,this._ifThenElse.if);this.input[0].connect(this._ifThenElse.then);this._param.connect(this._ifThenElse.else);this._param.connect(this._lt,0,1)};Tone.extend(Tone.Min,Tone.Signal);Tone.Min.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._param.dispose();this._ifThenElse.dispose();this._lt.dispose();this._param=null;this._ifThenElse=null;this._lt=null;return this};return Tone.Min});Module(function(Tone){Tone.Modulo=function(modulus){Tone.call(this,1,1);this._shaper=new Tone.WaveShaper(Math.pow(2,16));this._multiply=new Tone.Multiply();this._subtract=this.output=new Tone.Subtract();this._modSignal=new Tone.Signal(modulus);this.input.fan(this._shaper,this._subtract);this._modSignal.connect(this._multiply,0,0);this._shaper.connect(this._multiply,0,1);this._multiply.connect(this._subtract,0,1);this._setWaveShaper(modulus)};Tone.extend(Tone.Modulo,Tone.SignalBase);Tone.Modulo.prototype._setWaveShaper=function(mod){this._shaper.setMap(function(val){var multiple=Math.floor((val+0.0001)/mod);return multiple})};Object.defineProperty(Tone.Modulo.prototype,'value',{get:function(){return this._modSignal.value},set:function(mod){this._modSignal.value=mod;this._setWaveShaper(mod)}});Tone.Modulo.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;this._multiply.dispose();this._multiply=null;this._subtract.dispose();this._subtract=null;this._modSignal.dispose();this._modSignal=null;return this};return Tone.Modulo});Module(function(Tone){Tone.AudioToGain=function(){this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return(x+1)/2})};Tone.extend(Tone.AudioToGain,Tone.SignalBase);Tone.AudioToGain.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._norm.dispose();this._norm=null;return this};return Tone.AudioToGain});Module(function(Tone){Tone.Expr=function(){var expr=this._replacements(Array.prototype.slice.call(arguments));var inputCount=this._parseInputs(expr);this._nodes=[];this.input=new Array(inputCount);for(var i=0;i<inputCount;i++){this.input[i]=this.context.createGain()}
var tree=this._parseTree(expr);var result;try{result=this._eval(tree)}catch(e){this._disposeNodes();throw new Error('Could evaluate expression: '+expr)}
this.output=result};Tone.extend(Tone.Expr,Tone.SignalBase);function applyBinary(Constructor,args,self){var op=new Constructor();self._eval(args[0]).connect(op,0,0);self._eval(args[1]).connect(op,0,1);return op}
function applyUnary(Constructor,args,self){var op=new Constructor();self._eval(args[0]).connect(op,0,0);return op}
function getNumber(arg){return arg?parseFloat(arg):undefined}
function literalNumber(arg){return arg&&arg.args?parseFloat(arg.args):undefined}
Tone.Expr._Expressions={'value':{'signal':{regexp:/^\d+\.\d+|^\d+/,method:function(arg){var sig=new Tone.Signal(getNumber(arg));return sig}},'input':{regexp:/^\$\d/,method:function(arg,self){return self.input[getNumber(arg.substr(1))]}}},'glue':{'(':{regexp:/^\(/},')':{regexp:/^\)/},',':{regexp:/^,/}},'func':{'abs':{regexp:/^abs/,method:applyUnary.bind(this,Tone.Abs)},'min':{regexp:/^min/,method:applyBinary.bind(this,Tone.Min)},'max':{regexp:/^max/,method:applyBinary.bind(this,Tone.Max)},'if':{regexp:/^if/,method:function(args,self){var op=new Tone.IfThenElse();self._eval(args[0]).connect(op.if);self._eval(args[1]).connect(op.then);self._eval(args[2]).connect(op.else);return op}},'gt0':{regexp:/^gt0/,method:applyUnary.bind(this,Tone.GreaterThanZero)},'eq0':{regexp:/^eq0/,method:applyUnary.bind(this,Tone.EqualZero)},'mod':{regexp:/^mod/,method:function(args,self){var modulus=literalNumber(args[1]);var op=new Tone.Modulo(modulus);self._eval(args[0]).connect(op);return op}},'pow':{regexp:/^pow/,method:function(args,self){var exp=literalNumber(args[1]);var op=new Tone.Pow(exp);self._eval(args[0]).connect(op);return op}},'a2g':{regexp:/^a2g/,method:function(args,self){var op=new Tone.AudioToGain();self._eval(args[0]).connect(op);return op}}},'binary':{'+':{regexp:/^\+/,precedence:1,method:applyBinary.bind(this,Tone.Add)},'-':{regexp:/^\-/,precedence:1,method:function(args,self){if(args.length===1){return applyUnary(Tone.Negate,args,self)}else{return applyBinary(Tone.Subtract,args,self)}}},'*':{regexp:/^\*/,precedence:0,method:applyBinary.bind(this,Tone.Multiply)},'>':{regexp:/^\>/,precedence:2,method:applyBinary.bind(this,Tone.GreaterThan)},'<':{regexp:/^</,precedence:2,method:applyBinary.bind(this,Tone.LessThan)},'==':{regexp:/^==/,precedence:3,method:applyBinary.bind(this,Tone.Equal)},'&&':{regexp:/^&&/,precedence:4,method:applyBinary.bind(this,Tone.AND)},'||':{regexp:/^\|\|/,precedence:5,method:applyBinary.bind(this,Tone.OR)}},'unary':{'-':{regexp:/^\-/,method:applyUnary.bind(this,Tone.Negate)},'!':{regexp:/^\!/,method:applyUnary.bind(this,Tone.NOT)}}};Tone.Expr.prototype._parseInputs=function(expr){var inputArray=expr.match(/\$\d/g);var inputMax=0;if(inputArray!==null){for(var i=0;i<inputArray.length;i++){var inputNum=parseInt(inputArray[i].substr(1))+1;inputMax=Math.max(inputMax,inputNum)}}
return inputMax};Tone.Expr.prototype._replacements=function(args){var expr=args.shift();for(var i=0;i<args.length;i++){expr=expr.replace(/\%/i,args[i])}
return expr};Tone.Expr.prototype._tokenize=function(expr){var position=-1;var tokens=[];while(expr.length>0){expr=expr.trim();var token=getNextToken(expr);tokens.push(token);expr=expr.substr(token.value.length)}
function getNextToken(expr){for(var type in Tone.Expr._Expressions){var group=Tone.Expr._Expressions[type];for(var opName in group){var op=group[opName];var reg=op.regexp;var match=expr.match(reg);if(match!==null){return{type:type,value:match[0],method:op.method}}}}
throw new SyntaxError('Unexpected token '+expr)}
return{next:function(){return tokens[++position]},peek:function(){return tokens[position+1]}}};Tone.Expr.prototype._parseTree=function(expr){var lexer=this._tokenize(expr);var isUndef=this.isUndef.bind(this);function matchSyntax(token,syn){return!isUndef(token)&&token.type==='glue'&&token.value===syn}
function matchGroup(token,groupName,prec){var ret=!1;var group=Tone.Expr._Expressions[groupName];if(!isUndef(token)){for(var opName in group){var op=group[opName];if(op.regexp.test(token.value)){if(!isUndef(prec)){if(op.precedence===prec){return!0}}else{return!0}}}}
return ret}
function parseExpression(precedence){if(isUndef(precedence)){precedence=5}
var expr;if(precedence<0){expr=parseUnary()}else{expr=parseExpression(precedence-1)}
var token=lexer.peek();while(matchGroup(token,'binary',precedence)){token=lexer.next();expr={operator:token.value,method:token.method,args:[expr,parseExpression(precedence)]};token=lexer.peek()}
return expr}
function parseUnary(){var token,expr;token=lexer.peek();if(matchGroup(token,'unary')){token=lexer.next();expr=parseUnary();return{operator:token.value,method:token.method,args:[expr]}}
return parsePrimary()}
function parsePrimary(){var token,expr;token=lexer.peek();if(isUndef(token)){throw new SyntaxError('Unexpected termination of expression')}
if(token.type==='func'){token=lexer.next();return parseFunctionCall(token)}
if(token.type==='value'){token=lexer.next();return{method:token.method,args:token.value}}
if(matchSyntax(token,'(')){lexer.next();expr=parseExpression();token=lexer.next();if(!matchSyntax(token,')')){throw new SyntaxError('Expected )')}
return expr}
throw new SyntaxError('Parse error, cannot process token '+token.value)}
function parseFunctionCall(func){var token,args=[];token=lexer.next();if(!matchSyntax(token,'(')){throw new SyntaxError('Expected ( in a function call "'+func.value+'"')}
token=lexer.peek();if(!matchSyntax(token,')')){args=parseArgumentList()}
token=lexer.next();if(!matchSyntax(token,')')){throw new SyntaxError('Expected ) in a function call "'+func.value+'"')}
return{method:func.method,args:args,name:name}}
function parseArgumentList(){var token,expr,args=[];while(!0){expr=parseExpression();if(isUndef(expr)){break}
args.push(expr);token=lexer.peek();if(!matchSyntax(token,',')){break}
lexer.next()}
return args}
return parseExpression()};Tone.Expr.prototype._eval=function(tree){if(!this.isUndef(tree)){var node=tree.method(tree.args,this);this._nodes.push(node);return node}};Tone.Expr.prototype._disposeNodes=function(){for(var i=0;i<this._nodes.length;i++){var node=this._nodes[i];if(this.isFunction(node.dispose)){node.dispose()}else if(this.isFunction(node.disconnect)){node.disconnect()}
node=null;this._nodes[i]=null}
this._nodes=null};Tone.Expr.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._disposeNodes()};return Tone.Expr});Module(function(Tone){Tone.EqualPowerGain=function(){this._eqPower=this.input=this.output=new Tone.WaveShaper(function(val){if(Math.abs(val)<0.001){return 0}else{return this.equalPowerScale(val)}}.bind(this),4096)};Tone.extend(Tone.EqualPowerGain,Tone.SignalBase);Tone.EqualPowerGain.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._eqPower.dispose();this._eqPower=null;return this};return Tone.EqualPowerGain});Module(function(Tone){Tone.CrossFade=function(initialFade){Tone.call(this,2,1);this.a=this.input[0]=this.context.createGain();this.b=this.input[1]=this.context.createGain();this.fade=new Tone.Signal(this.defaultArg(initialFade,0.5),Tone.Type.NormalRange);this._equalPowerA=new Tone.EqualPowerGain();this._equalPowerB=new Tone.EqualPowerGain();this._invert=new Tone.Expr('1 - $0');this.a.connect(this.output);this.b.connect(this.output);this.fade.chain(this._equalPowerB,this.b.gain);this.fade.chain(this._invert,this._equalPowerA,this.a.gain);this._readOnly('fade')};Tone.extend(Tone.CrossFade);Tone.CrossFade.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable('fade');this._equalPowerA.dispose();this._equalPowerA=null;this._equalPowerB.dispose();this._equalPowerB=null;this.fade.dispose();this.fade=null;this._invert.dispose();this._invert=null;this.a.disconnect();this.a=null;this.b.disconnect();this.b=null;return this};return Tone.CrossFade});Module(function(Tone){Tone.Filter=function(){Tone.call(this);var options=this.optionsObject(arguments,['frequency','type','rolloff'],Tone.Filter.defaults);this._filters=[];this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency);this.detune=new Tone.Signal(0,Tone.Type.Cents);this.gain=new Tone.Signal({'value':options.gain,'convert':!1});this.Q=new Tone.Signal(options.Q);this._type=options.type;this._rolloff=options.rolloff;this.rolloff=options.rolloff;this._readOnly(['detune','frequency','gain','Q'])};Tone.extend(Tone.Filter);Tone.Filter.defaults={'type':'lowpass','frequency':350,'rolloff':-12,'Q':1,'gain':0};Object.defineProperty(Tone.Filter.prototype,'type',{get:function(){return this._type},set:function(type){var types=['lowpass','highpass','bandpass','lowshelf','highshelf','notch','allpass','peaking'];if(types.indexOf(type)===-1){throw new Error('Tone.Filter does not have filter type '+type)}
this._type=type;for(var i=0;i<this._filters.length;i++){this._filters[i].type=type}}});Object.defineProperty(Tone.Filter.prototype,'rolloff',{get:function(){return this._rolloff},set:function(rolloff){rolloff=parseInt(rolloff,10);var possibilities=[-12,-24,-48,-96];var cascadingCount=possibilities.indexOf(rolloff);if(cascadingCount===-1){throw new Error('Filter rolloff can only be -12, -24, -48 or -96')}
cascadingCount+=1;this._rolloff=rolloff;this.input.disconnect();for(var i=0;i<this._filters.length;i++){this._filters[i].disconnect();this._filters[i]=null}
this._filters=new Array(cascadingCount);for(var count=0;count<cascadingCount;count++){var filter=this.context.createBiquadFilter();filter.type=this._type;this.frequency.connect(filter.frequency);this.detune.connect(filter.detune);this.Q.connect(filter.Q);this.gain.connect(filter.gain);this._filters[count]=filter}
var connectionChain=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,connectionChain)}});Tone.Filter.prototype.dispose=function(){Tone.prototype.dispose.call(this);for(var i=0;i<this._filters.length;i++){this._filters[i].disconnect();this._filters[i]=null}
this._filters=null;this._writable(['detune','frequency','gain','Q']);this.frequency.dispose();this.Q.dispose();this.frequency=null;this.Q=null;this.detune.dispose();this.detune=null;this.gain.dispose();this.gain=null;return this};return Tone.Filter});Module(function(Tone){Tone.MultibandSplit=function(){var options=this.optionsObject(arguments,['lowFrequency','highFrequency'],Tone.MultibandSplit.defaults);this.input=this.context.createGain();this.output=new Array(3);this.low=this.output[0]=new Tone.Filter(0,'lowpass');this._lowMidFilter=new Tone.Filter(0,'highpass');this.mid=this.output[1]=new Tone.Filter(0,'lowpass');this.high=this.output[2]=new Tone.Filter(0,'highpass');this.lowFrequency=new Tone.Signal(options.lowFrequency,Tone.Type.Frequency);this.highFrequency=new Tone.Signal(options.highFrequency,Tone.Type.Frequency);this.Q=new Tone.Signal(options.Q);this.input.fan(this.low,this.high);this.input.chain(this._lowMidFilter,this.mid);this.lowFrequency.connect(this.low.frequency);this.lowFrequency.connect(this._lowMidFilter.frequency);this.highFrequency.connect(this.mid.frequency);this.highFrequency.connect(this.high.frequency);this.Q.connect(this.low.Q);this.Q.connect(this._lowMidFilter.Q);this.Q.connect(this.mid.Q);this.Q.connect(this.high.Q);this._readOnly(['high','mid','low','highFrequency','lowFrequency'])};Tone.extend(Tone.MultibandSplit);Tone.MultibandSplit.defaults={'lowFrequency':400,'highFrequency':2500,'Q':1};Tone.MultibandSplit.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['high','mid','low','highFrequency','lowFrequency']);this.low.dispose();this.low=null;this._lowMidFilter.dispose();this._lowMidFilter=null;this.mid.dispose();this.mid=null;this.high.dispose();this.high=null;this.lowFrequency.dispose();this.lowFrequency=null;this.highFrequency.dispose();this.highFrequency=null;this.Q.dispose();this.Q=null;return this};return Tone.MultibandSplit});Module(function(Tone){Tone.EQ3=function(){var options=this.optionsObject(arguments,['low','mid','high'],Tone.EQ3.defaults);this.output=this.context.createGain();this._multibandSplit=this.input=new Tone.MultibandSplit({'lowFrequency':options.lowFrequency,'highFrequency':options.highFrequency});this._lowGain=new Tone.Gain(options.low,Tone.Type.Decibels);this._midGain=new Tone.Gain(options.mid,Tone.Type.Decibels);this._highGain=new Tone.Gain(options.high,Tone.Type.Decibels);this.low=this._lowGain.gain;this.mid=this._midGain.gain;this.high=this._highGain.gain;this.Q=this._multibandSplit.Q;this.lowFrequency=this._multibandSplit.lowFrequency;this.highFrequency=this._multibandSplit.highFrequency;this._multibandSplit.low.chain(this._lowGain,this.output);this._multibandSplit.mid.chain(this._midGain,this.output);this._multibandSplit.high.chain(this._highGain,this.output);this._readOnly(['low','mid','high','lowFrequency','highFrequency'])};Tone.extend(Tone.EQ3);Tone.EQ3.defaults={'low':0,'mid':0,'high':0,'lowFrequency':400,'highFrequency':2500};Tone.EQ3.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['low','mid','high','lowFrequency','highFrequency']);this._multibandSplit.dispose();this._multibandSplit=null;this.lowFrequency=null;this.highFrequency=null;this._lowGain.dispose();this._lowGain=null;this._midGain.dispose();this._midGain=null;this._highGain.dispose();this._highGain=null;this.low=null;this.mid=null;this.high=null;this.Q=null;return this};return Tone.EQ3});Module(function(Tone){Tone.EQMultiband=function(options){this._bands=[];this.numberOfBands=options.length;for(var i=0;i<this.numberOfBands;i++){var filter=new Tone.Filter({'type':options[i].type,'frequency':options[i].frequency,'rolloff':options[i].rolloff,'Q':options[i].Q,'gain':options[i].gain});this._bands.push(filter)}
this.input=this._bands[0];this.output=this._bands[this.numberOfBands-1];var currentUnit=this._bands[0];for(var j=1;j<this._bands.length;j++){var toUnit=this._bands[j];currentUnit.connect(toUnit);currentUnit=toUnit}};Tone.extend(Tone.EQMultiband);Tone.EQMultiband.defaults=[{'type':'lowshelf','frequency':80,'rolloff':-12,'Q':1,'gain':0},{'type':'peaking','frequency':160,'rolloff':-12,'Q':1,'gain':0},{'type':'peaking','frequency':480,'rolloff':-12,'Q':1,'gain':0},{'type':'peaking','frequency':1200,'rolloff':-12,'Q':1,'gain':0},{'type':'peaking','frequency':3000,'rolloff':-12,'Q':1,'gain':5},{'type':'highshelf','frequency':12000,'rolloff':-12,'Q':1,'gain':10}];Tone.EQMultiband.prototype.setType=function(type,band){this._bands[band-1].type=type};Tone.EQMultiband.prototype.getType=function(band){return this._bands[band-1].type};Tone.EQMultiband.prototype.setFrequency=function(freq,band){this._bands[band-1].frequency.value=freq};Tone.EQMultiband.prototype.getFrequency=function(band){return this._bands[band-1].frequency.value};Tone.EQMultiband.prototype.setQ=function(Q,band){this._bands[band-1].Q.value=Q};Tone.EQMultiband.prototype.getQ=function(band){return this._bands[band-1].Q.value};Tone.EQMultiband.prototype.setGain=function(gain,band){this._bands[band-1].gain.value=gain};Tone.EQMultiband.prototype.getGain=function(band){return this._bands[band-1].gain.value};Tone.EQMultiband.prototype.dispose=function(){Tone.prototype.dispose.call(this);for(var i=0;i<this._bands.length;i++){this._bands[i].dispose()}
this.numberOfBands=null;this._bands=null};return Tone.EQMultiband});Module(function(Tone){Tone.Scale=function(outputMin,outputMax){this._outputMin=this.defaultArg(outputMin,0);this._outputMax=this.defaultArg(outputMax,1);this._scale=this.input=new Tone.Multiply(1);this._add=this.output=new Tone.Add(0);this._scale.connect(this._add);this._setRange()};Tone.extend(Tone.Scale,Tone.SignalBase);Object.defineProperty(Tone.Scale.prototype,'min',{get:function(){return this._outputMin},set:function(min){this._outputMin=min;this._setRange()}});Object.defineProperty(Tone.Scale.prototype,'max',{get:function(){return this._outputMax},set:function(max){this._outputMax=max;this._setRange()}});Tone.Scale.prototype._setRange=function(){this._add.value=this._outputMin;this._scale.value=this._outputMax-this._outputMin};Tone.Scale.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._add.dispose();this._add=null;this._scale.dispose();this._scale=null;return this};return Tone.Scale});Module(function(Tone){Tone.ScaleExp=function(outputMin,outputMax,exponent){this._scale=this.output=new Tone.Scale(outputMin,outputMax);this._exp=this.input=new Tone.Pow(this.defaultArg(exponent,2));this._exp.connect(this._scale)};Tone.extend(Tone.ScaleExp,Tone.SignalBase);Object.defineProperty(Tone.ScaleExp.prototype,'exponent',{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}});Object.defineProperty(Tone.ScaleExp.prototype,'min',{get:function(){return this._scale.min},set:function(min){this._scale.min=min}});Object.defineProperty(Tone.ScaleExp.prototype,'max',{get:function(){return this._scale.max},set:function(max){this._scale.max=max}});Tone.ScaleExp.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._exp.dispose();this._exp=null;return this};return Tone.ScaleExp});Module(function(Tone){Tone.FeedbackCombFilter=function(){Tone.call(this);var options=this.optionsObject(arguments,['delayTime','resonance'],Tone.FeedbackCombFilter.defaults);this._delay=this.input=this.output=this.context.createDelay(1);this.delayTime=new Tone.Param({'param':this._delay.delayTime,'value':options.delayTime,'units':Tone.Type.Time});this._feedback=this.context.createGain();this.resonance=new Tone.Param({'param':this._feedback.gain,'value':options.resonance,'units':Tone.Type.NormalRange});this._delay.chain(this._feedback,this._delay);this._readOnly(['resonance','delayTime'])};Tone.extend(Tone.FeedbackCombFilter);Tone.FeedbackCombFilter.defaults={'delayTime':0.1,'resonance':0.5};Tone.FeedbackCombFilter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['resonance','delayTime']);this._delay.disconnect();this._delay=null;this.delayTime.dispose();this.delayTime=null;this.resonance.dispose();this.resonance=null;this._feedback.disconnect();this._feedback=null;return this};return Tone.FeedbackCombFilter});Module(function(Tone){Tone.Follower=function(){Tone.call(this);var options=this.optionsObject(arguments,['attack','release'],Tone.Follower.defaults);this._abs=new Tone.Abs();this._filter=this.context.createBiquadFilter();this._filter.type='lowpass';this._filter.frequency.value=0;this._filter.Q.value=-100;this._frequencyValues=new Tone.WaveShaper();this._sub=new Tone.Subtract();this._delay=this.context.createDelay();this._delay.delayTime.value=this.blockTime;this._mult=new Tone.Multiply(10000);this._attack=options.attack;this._release=options.release;this.input.chain(this._abs,this._filter,this.output);this._abs.connect(this._sub,0,1);this._filter.chain(this._delay,this._sub);this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency);this._setAttackRelease(this._attack,this._release)};Tone.extend(Tone.Follower);Tone.Follower.defaults={'attack':0.05,'release':0.5};Tone.Follower.prototype._setAttackRelease=function(attack,release){var minTime=this.blockTime;attack=this.secondsToFrequency(this.toSeconds(attack));release=this.secondsToFrequency(this.toSeconds(release));attack=Math.max(attack,minTime);release=Math.max(release,minTime);this._frequencyValues.setMap(function(val){if(val<=0){return attack}else{return release}})};Object.defineProperty(Tone.Follower.prototype,'attack',{get:function(){return this._attack},set:function(attack){this._attack=attack;this._setAttackRelease(this._attack,this._release)}});Object.defineProperty(Tone.Follower.prototype,'release',{get:function(){return this._release},set:function(release){this._release=release;this._setAttackRelease(this._attack,this._release)}});Tone.Follower.prototype.connect=Tone.Signal.prototype.connect;Tone.Follower.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._filter.disconnect();this._filter=null;this._frequencyValues.disconnect();this._frequencyValues=null;this._delay.disconnect();this._delay=null;this._sub.disconnect();this._sub=null;this._abs.dispose();this._abs=null;this._mult.dispose();this._mult=null;this._curve=null;return this};return Tone.Follower});Module(function(Tone){Tone.ScaledEnvelope=function(){var options=this.optionsObject(arguments,['attack','decay','sustain','release'],Tone.Envelope.defaults);Tone.Envelope.call(this,options);options=this.defaultArg(options,Tone.ScaledEnvelope.defaults);this._exp=this.output=new Tone.Pow(options.exponent);this._scale=this.output=new Tone.Scale(options.min,options.max);this._sig.chain(this._exp,this._scale)};Tone.extend(Tone.ScaledEnvelope,Tone.Envelope);Tone.ScaledEnvelope.defaults={'min':0,'max':1,'exponent':1};Object.defineProperty(Tone.ScaledEnvelope.prototype,'min',{get:function(){return this._scale.min},set:function(min){this._scale.min=min}});Object.defineProperty(Tone.ScaledEnvelope.prototype,'max',{get:function(){return this._scale.max},set:function(max){this._scale.max=max}});Object.defineProperty(Tone.ScaledEnvelope.prototype,'exponent',{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}});Tone.ScaledEnvelope.prototype.dispose=function(){Tone.Envelope.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._exp.dispose();this._exp=null;return this};return Tone.ScaledEnvelope});Module(function(Tone){Tone.FrequencyEnvelope=function(){var options=this.optionsObject(arguments,['attack','decay','sustain','release'],Tone.Envelope.defaults);Tone.ScaledEnvelope.call(this,options);options=this.defaultArg(options,Tone.FrequencyEnvelope.defaults);this._octaves=options.octaves;this.baseFrequency=options.baseFrequency;this.octaves=options.octaves};Tone.extend(Tone.FrequencyEnvelope,Tone.Envelope);Tone.FrequencyEnvelope.defaults={'baseFrequency':200,'octaves':4,'exponent':2};Object.defineProperty(Tone.FrequencyEnvelope.prototype,'baseFrequency',{get:function(){return this._scale.min},set:function(min){this._scale.min=this.toFrequency(min)}});Object.defineProperty(Tone.FrequencyEnvelope.prototype,'octaves',{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves;this._scale.max=this.baseFrequency*Math.pow(2,octaves)}});Object.defineProperty(Tone.FrequencyEnvelope.prototype,'exponent',{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}});Tone.FrequencyEnvelope.prototype.dispose=function(){Tone.ScaledEnvelope.prototype.dispose.call(this);return this};return Tone.FrequencyEnvelope});Module(function(Tone){Tone.Gate=function(){Tone.call(this);var options=this.optionsObject(arguments,['threshold','attack','release'],Tone.Gate.defaults);this._follower=new Tone.Follower(options.attack,options.release);this._gt=new Tone.GreaterThan(this.dbToGain(options.threshold));this.input.connect(this.output);this.input.chain(this._gt,this._follower,this.output.gain)};Tone.extend(Tone.Gate);Tone.Gate.defaults={'attack':0.1,'release':0.1,'threshold':-40};Object.defineProperty(Tone.Gate.prototype,'threshold',{get:function(){return this.gainToDb(this._gt.value)},set:function(thresh){this._gt.value=this.dbToGain(thresh)}});Object.defineProperty(Tone.Gate.prototype,'attack',{get:function(){return this._follower.attack},set:function(attackTime){this._follower.attack=attackTime}});Object.defineProperty(Tone.Gate.prototype,'release',{get:function(){return this._follower.release},set:function(releaseTime){this._follower.release=releaseTime}});Tone.Gate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._follower.dispose();this._gt.dispose();this._follower=null;this._gt=null;return this};return Tone.Gate});Module(function(Tone){Tone.TimelineState=function(initial){Tone.Timeline.call(this);this._initial=initial};Tone.extend(Tone.TimelineState,Tone.Timeline);Tone.TimelineState.prototype.getStateAtTime=function(time){var event=this.getEvent(time);if(event!==null){return event.state}else{return this._initial}};Tone.TimelineState.prototype.setStateAtTime=function(state,time){this.addEvent({'state':state,'time':this.toSeconds(time)})};return Tone.TimelineState});Module(function(Tone){Tone.Clock=function(){var options=this.optionsObject(arguments,['callback','frequency'],Tone.Clock.defaults);this.callback=options.callback;this._lookAhead='auto';this._computedLookAhead=1/60;this._threshold=0.5;this._nextTick=-1;this._lastUpdate=0;this._loopID=-1;this.frequency=new Tone.TimelineSignal(options.frequency,Tone.Type.Frequency);this.ticks=0;this._state=new Tone.TimelineState(Tone.State.Stopped);this._boundLoop=this._loop.bind(this);this._readOnly('frequency');this._loop()};Tone.extend(Tone.Clock);Tone.Clock.defaults={'callback':Tone.noOp,'frequency':1,'lookAhead':'auto'};Object.defineProperty(Tone.Clock.prototype,'state',{get:function(){return this._state.getStateAtTime(this.now())}});Object.defineProperty(Tone.Clock.prototype,'lookAhead',{get:function(){return this._lookAhead},set:function(val){if(val==='auto'){this._lookAhead='auto'}else{this._lookAhead=this.toSeconds(val)}}});Tone.Clock.prototype.start=function(time,offset){time=this.toSeconds(time);if(this._state.getStateAtTime(time)!==Tone.State.Started){this._state.addEvent({'state':Tone.State.Started,'time':time,'offset':offset})}
return this};Tone.Clock.prototype.stop=function(time){time=this.toSeconds(time);if(this._state.getStateAtTime(time)!==Tone.State.Stopped){this._state.setStateAtTime(Tone.State.Stopped,time)}
return this};Tone.Clock.prototype.pause=function(time){time=this.toSeconds(time);if(this._state.getStateAtTime(time)===Tone.State.Started){this._state.setStateAtTime(Tone.State.Paused,time)}
return this};Tone.Clock.prototype._loop=function(time){this._loopID=requestAnimationFrame(this._boundLoop);if(this._lookAhead==='auto'){if(!this.isUndef(time)){var diff=(time-this._lastUpdate)/1000;this._lastUpdate=time;if(diff<this._threshold){this._computedLookAhead=(9*this._computedLookAhead+diff)/10}}}else{this._computedLookAhead=this._lookAhead}
var now=this.now();var lookAhead=this._computedLookAhead*2;var event=this._state.getEvent(now+lookAhead);var state=Tone.State.Stopped;if(event){state=event.state;if(this._nextTick===-1&&state===Tone.State.Started){this._nextTick=event.time;if(!this.isUndef(event.offset)){this.ticks=event.offset}}}
if(state===Tone.State.Started){while(now+lookAhead>this._nextTick){if(now>this._nextTick+this._threshold){this._nextTick=now}
var tickTime=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick);this.callback(tickTime);this.ticks++}}else if(state===Tone.State.Stopped){this._nextTick=-1;this.ticks=0}};Tone.Clock.prototype.getStateAtTime=function(time){return this._state.getStateAtTime(time)};Tone.Clock.prototype.dispose=function(){cancelAnimationFrame(this._loopID);Tone.TimelineState.prototype.dispose.call(this);this._writable('frequency');this.frequency.dispose();this.frequency=null;this._boundLoop=Tone.noOp;this._nextTick=Infinity;this.callback=null;this._state.dispose();this._state=null};return Tone.Clock});Module(function(Tone){Tone.Emitter=function(){this._events={}};Tone.extend(Tone.Emitter);Tone.Emitter.prototype.on=function(event,callback){var events=event.split(/\W+/);for(var i=0;i<events.length;i++){var eventName=events[i];if(!this._events.hasOwnProperty(eventName)){this._events[eventName]=[]}
this._events[eventName].push(callback)}
return this};Tone.Emitter.prototype.off=function(event,callback){var events=event.split(/\W+/);for(var ev=0;ev<events.length;ev++){event=events[ev];if(this._events.hasOwnProperty(event)){if(Tone.prototype.isUndef(callback)){this._events[event]=[]}else{var eventList=this._events[event];for(var i=0;i<eventList.length;i++){if(eventList[i]===callback){eventList.splice(i,1)}}}}}
return this};Tone.Emitter.prototype.trigger=function(event){if(this._events){var args=Array.prototype.slice.call(arguments,1);if(this._events.hasOwnProperty(event)){var eventList=this._events[event];for(var i=0,len=eventList.length;i<len;i++){eventList[i].apply(this,args)}}}
return this};Tone.Emitter.mixin=function(object){var functions=['on','off','trigger'];object._events={};for(var i=0;i<functions.length;i++){var func=functions[i];var emitterFunc=Tone.Emitter.prototype[func];object[func]=emitterFunc}};Tone.Emitter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._events=null;return this};return Tone.Emitter});Module(function(Tone){Tone.IntervalTimeline=function(){this._root=null;this._length=0};Tone.extend(Tone.IntervalTimeline);Tone.IntervalTimeline.prototype.addEvent=function(event){if(this.isUndef(event.time)||this.isUndef(event.duration)){throw new Error('events must have time and duration parameters')}
var node=new IntervalNode(event.time,event.time+event.duration,event);if(this._root===null){this._root=node}else{this._root.insert(node)}
this._length++;while(node!==null){node.updateHeight();node.updateMax();this._rebalance(node);node=node.parent}
return this};Tone.IntervalTimeline.prototype.removeEvent=function(event){if(this._root!==null){var results=[];this._root.search(event.time,results);for(var i=0;i<results.length;i++){var node=results[i];if(node.event===event){this._removeNode(node);this._length--;break}}}
return this};Object.defineProperty(Tone.IntervalTimeline.prototype,'length',{get:function(){return this._length}});Tone.IntervalTimeline.prototype.cancel=function(after){after=this.toSeconds(after);this.forEachAfter(after,function(event){this.removeEvent(event)}.bind(this));return this};Tone.IntervalTimeline.prototype._setRoot=function(node){this._root=node;if(this._root!==null){this._root.parent=null}};Tone.IntervalTimeline.prototype._replaceNodeInParent=function(node,replacement){if(node.parent!==null){if(node.isLeftChild()){node.parent.left=replacement}else{node.parent.right=replacement}
this._rebalance(node.parent)}else{this._setRoot(replacement)}};Tone.IntervalTimeline.prototype._removeNode=function(node){if(node.left===null&&node.right===null){this._replaceNodeInParent(node,null)}else if(node.right===null){this._replaceNodeInParent(node,node.left)}else if(node.left===null){this._replaceNodeInParent(node,node.right)}else{var balance=node.getBalance();var replacement,temp;if(balance>0){if(node.left.right===null){replacement=node.left;replacement.right=node.right;temp=replacement}else{replacement=node.left.right;while(replacement.right!==null){replacement=replacement.right}
replacement.parent.right=replacement.left;temp=replacement.parent;replacement.left=node.left;replacement.right=node.right}}else{if(node.right.left===null){replacement=node.right;replacement.left=node.left;temp=replacement}else{replacement=node.right.left;while(replacement.left!==null){replacement=replacement.left}
replacement.parent=replacement.parent;replacement.parent.left=replacement.right;temp=replacement.parent;replacement.left=node.left;replacement.right=node.right}}
if(node.parent!==null){if(node.isLeftChild()){node.parent.left=replacement}else{node.parent.right=replacement}}else{this._setRoot(replacement)}
this._rebalance(temp)}
node.dispose()};Tone.IntervalTimeline.prototype._rotateLeft=function(node){var parent=node.parent;var isLeftChild=node.isLeftChild();var pivotNode=node.right;node.right=pivotNode.left;pivotNode.left=node;if(parent!==null){if(isLeftChild){parent.left=pivotNode}else{parent.right=pivotNode}}else{this._setRoot(pivotNode)}};Tone.IntervalTimeline.prototype._rotateRight=function(node){var parent=node.parent;var isLeftChild=node.isLeftChild();var pivotNode=node.left;node.left=pivotNode.right;pivotNode.right=node;if(parent!==null){if(isLeftChild){parent.left=pivotNode}else{parent.right=pivotNode}}else{this._setRoot(pivotNode)}};Tone.IntervalTimeline.prototype._rebalance=function(node){var balance=node.getBalance();if(balance>1){if(node.left.getBalance()<0){this._rotateLeft(node.left)}else{this._rotateRight(node)}}else if(balance<-1){if(node.right.getBalance()>0){this._rotateRight(node.right)}else{this._rotateLeft(node)}}};Tone.IntervalTimeline.prototype.getEvent=function(time){if(this._root!==null){var results=[];this._root.search(time,results);if(results.length>0){var max=results[0];for(var i=1;i<results.length;i++){if(results[i].low>max.low){max=results[i]}}
return max.event}}
return null};Tone.IntervalTimeline.prototype.forEach=function(callback){if(this._root!==null){var allNodes=[];if(this._root!==null){this._root.traverse(function(node){allNodes.push(node)})}
for(var i=0;i<allNodes.length;i++){var ev=allNodes[i].event;if(ev){callback(ev)}}}
return this};Tone.IntervalTimeline.prototype.forEachOverlap=function(time,callback){time=this.toSeconds(time);if(this._root!==null){var results=[];this._root.search(time,results);for(var i=results.length-1;i>=0;i--){var ev=results[i].event;if(ev){callback(ev)}}}
return this};Tone.IntervalTimeline.prototype.forEachAfter=function(time,callback){time=this.toSeconds(time);if(this._root!==null){var results=[];this._root.searchAfter(time,results);for(var i=results.length-1;i>=0;i--){var ev=results[i].event;if(ev){callback(ev)}}}
return this};Tone.IntervalTimeline.prototype.dispose=function(){var allNodes=[];if(this._root!==null){this._root.traverse(function(node){allNodes.push(node)})}
for(var i=0;i<allNodes.length;i++){allNodes[i].dispose()}
allNodes=null;this._root=null;return this};var IntervalNode=function(low,high,event){this.event=event;this.low=low;this.high=high;this.max=this.high;this._left=null;this._right=null;this.parent=null;this.height=0};IntervalNode.prototype.insert=function(node){if(node.low<=this.low){if(this.left===null){this.left=node}else{this.left.insert(node)}}else{if(this.right===null){this.right=node}else{this.right.insert(node)}}};IntervalNode.prototype.search=function(point,results){if(point>this.max){return}
if(this.left!==null){this.left.search(point,results)}
if(this.low<=point&&this.high>=point){results.push(this)}
if(this.low>point){return}
if(this.right!==null){this.right.search(point,results)}};IntervalNode.prototype.searchAfter=function(point,results){if(this.low>=point){results.push(this);if(this.left!==null){this.left.searchAfter(point,results)}}
if(this.right!==null){this.right.searchAfter(point,results)}};IntervalNode.prototype.traverse=function(callback){callback(this);if(this.left!==null){this.left.traverse(callback)}
if(this.right!==null){this.right.traverse(callback)}};IntervalNode.prototype.updateHeight=function(){if(this.left!==null&&this.right!==null){this.height=Math.max(this.left.height,this.right.height)+1}else if(this.right!==null){this.height=this.right.height+1}else if(this.left!==null){this.height=this.left.height+1}else{this.height=0}};IntervalNode.prototype.updateMax=function(){this.max=this.high;if(this.left!==null){this.max=Math.max(this.max,this.left.max)}
if(this.right!==null){this.max=Math.max(this.max,this.right.max)}};IntervalNode.prototype.getBalance=function(){var balance=0;if(this.left!==null&&this.right!==null){balance=this.left.height-this.right.height}else if(this.left!==null){balance=this.left.height+1}else if(this.right!==null){balance=-(this.right.height+1)}
return balance};IntervalNode.prototype.isLeftChild=function(){return this.parent!==null&&this.parent.left===this};Object.defineProperty(IntervalNode.prototype,'left',{get:function(){return this._left},set:function(node){this._left=node;if(node!==null){node.parent=this}
this.updateHeight();this.updateMax()}});Object.defineProperty(IntervalNode.prototype,'right',{get:function(){return this._right},set:function(node){this._right=node;if(node!==null){node.parent=this}
this.updateHeight();this.updateMax()}});IntervalNode.prototype.dispose=function(){this.parent=null;this._left=null;this._right=null;this.event=null};return Tone.IntervalTimeline});Module(function(Tone){Tone.Transport=function(){Tone.Emitter.call(this);this.loop=!1;this._loopStart=0;this._loopEnd=0;this._ppq=TransportConstructor.defaults.PPQ;this._clock=new Tone.Clock({'callback':this._processTick.bind(this),'frequency':0});this.bpm=this._clock.frequency;this.bpm._toUnits=this._toUnits.bind(this);this.bpm._fromUnits=this._fromUnits.bind(this);this.bpm.units=Tone.Type.BPM;this.bpm.value=TransportConstructor.defaults.bpm;this._readOnly('bpm');this._timeSignature=TransportConstructor.defaults.timeSignature;this._scheduledEvents={};this._eventID=0;this._timeline=new Tone.Timeline();this._repeatedEvents=new Tone.IntervalTimeline();this._onceEvents=new Tone.Timeline();this._syncedSignals=[];var swingSeconds=this.notationToSeconds(TransportConstructor.defaults.swingSubdivision,TransportConstructor.defaults.bpm,TransportConstructor.defaults.timeSignature);this._swingTicks=swingSeconds/(60/TransportConstructor.defaults.bpm)*this._ppq;this._swingAmount=0};Tone.extend(Tone.Transport,Tone.Emitter);Tone.Transport.defaults={'bpm':120,'swing':0,'swingSubdivision':'16n','timeSignature':4,'loopStart':0,'loopEnd':'4m','PPQ':48};Tone.Transport.prototype._processTick=function(tickTime){if(this._swingAmount>0&&this._clock.ticks%this._ppq!==0&&this._clock.ticks%this._swingTicks===0){tickTime+=this.ticksToSeconds(this._swingTicks)*this._swingAmount}
if(this.loop){if(this._clock.ticks===this._loopEnd){this.ticks=this._loopStart;this.trigger('loop',tickTime)}}
var ticks=this._clock.ticks;this._timeline.forEachAtTime(ticks,function(event){event.callback(tickTime)});this._repeatedEvents.forEachOverlap(ticks,function(event){if((ticks-event.time)%event.interval===0){event.callback(tickTime)}});this._onceEvents.forEachBefore(ticks,function(event){event.callback(tickTime)});this._onceEvents.cancelBefore(ticks)};Tone.Transport.prototype.schedule=function(callback,time){var event={'time':this.toTicks(time),'callback':callback};var id=this._eventID++;this._scheduledEvents[id.toString()]={'event':event,'timeline':this._timeline};this._timeline.addEvent(event);return id};Tone.Transport.prototype.scheduleRepeat=function(callback,interval,startTime,duration){if(interval<=0){throw new Error('repeat events must have an interval larger than 0')}
var event={'time':this.toTicks(startTime),'duration':this.toTicks(this.defaultArg(duration,Infinity)),'interval':this.toTicks(interval),'callback':callback};var id=this._eventID++;this._scheduledEvents[id.toString()]={'event':event,'timeline':this._repeatedEvents};this._repeatedEvents.addEvent(event);return id};Tone.Transport.prototype.scheduleOnce=function(callback,time){var event={'time':this.toTicks(time),'callback':callback};var id=this._eventID++;this._scheduledEvents[id.toString()]={'event':event,'timeline':this._onceEvents};this._onceEvents.addEvent(event);return id};Tone.Transport.prototype.clear=function(eventId){if(this._scheduledEvents.hasOwnProperty(eventId)){var item=this._scheduledEvents[eventId.toString()];item.timeline.removeEvent(item.event);delete this._scheduledEvents[eventId.toString()]}
return this};Tone.Transport.prototype.cancel=function(after){after=this.defaultArg(after,0);after=this.toTicks(after);this._timeline.cancel(after);this._onceEvents.cancel(after);this._repeatedEvents.cancel(after);return this};Tone.Transport.prototype.quantize=function(time,subdivision){subdivision=this.defaultArg(subdivision,'4n');var tickTime=this.toTicks(time);subdivision=this.toTicks(subdivision);var remainingTicks=subdivision-tickTime%subdivision;if(remainingTicks===subdivision){remainingTicks=0}
var now=this.now();if(this.state===Tone.State.Started){now=this._clock._nextTick}
return this.toSeconds(time,now)+this.ticksToSeconds(remainingTicks)};Object.defineProperty(Tone.Transport.prototype,'state',{get:function(){return this._clock.getStateAtTime(this.now())}});Tone.Transport.prototype.start=function(time,offset){time=this.toSeconds(time);if(!this.isUndef(offset)){offset=this.toTicks(offset)}else{offset=this.defaultArg(offset,this._clock.ticks)}
this._clock.start(time,offset);this.trigger('start',time,this.ticksToSeconds(offset));return this};Tone.Transport.prototype.stop=function(time){time=this.toSeconds(time);this._clock.stop(time);this.trigger('stop',time);return this};Tone.Transport.prototype.pause=function(time){time=this.toSeconds(time);this._clock.pause(time);this.trigger('pause',time);return this};Object.defineProperty(Tone.Transport.prototype,'timeSignature',{get:function(){return this._timeSignature},set:function(timeSig){if(this.isArray(timeSig)){timeSig=timeSig[0]/timeSig[1]*4}
this._timeSignature=timeSig}});Object.defineProperty(Tone.Transport.prototype,'loopStart',{get:function(){return this.ticksToSeconds(this._loopStart)},set:function(startPosition){this._loopStart=this.toTicks(startPosition)}});Object.defineProperty(Tone.Transport.prototype,'loopEnd',{get:function(){return this.ticksToSeconds(this._loopEnd)},set:function(endPosition){this._loopEnd=this.toTicks(endPosition)}});Tone.Transport.prototype.setLoopPoints=function(startPosition,endPosition){this.loopStart=startPosition;this.loopEnd=endPosition;return this};Object.defineProperty(Tone.Transport.prototype,'swing',{get:function(){return this._swingAmount*2},set:function(amount){this._swingAmount=amount*0.5}});Object.defineProperty(Tone.Transport.prototype,'swingSubdivision',{get:function(){return this.toNotation(this._swingTicks+'i')},set:function(subdivision){this._swingTicks=this.toTicks(subdivision)}});Object.defineProperty(Tone.Transport.prototype,'position',{get:function(){var quarters=this.ticks/this._ppq;var measures=Math.floor(quarters/this._timeSignature);var sixteenths=quarters%1*4;if(sixteenths%1>0){sixteenths=sixteenths.toFixed(3)}
quarters=Math.floor(quarters)%this._timeSignature;var progress=[measures,quarters,sixteenths];return progress.join(':')},set:function(progress){var ticks=this.toTicks(progress);this.ticks=ticks}});Object.defineProperty(Tone.Transport.prototype,'progress',{get:function(){if(this.loop){return(this.ticks-this._loopStart)/(this._loopEnd-this._loopStart)}else{return 0}}});Object.defineProperty(Tone.Transport.prototype,'ticks',{get:function(){return this._clock.ticks},set:function(t){this._clock.ticks=t}});Object.defineProperty(Tone.Transport.prototype,'PPQ',{get:function(){return this._ppq},set:function(ppq){this._ppq=ppq;this.bpm.value=this.bpm.value}});Tone.Transport.prototype._fromUnits=function(bpm){return 1/(60/bpm/this.PPQ)};Tone.Transport.prototype._toUnits=function(freq){return freq/this.PPQ*60};Tone.Transport.prototype.syncSignal=function(signal,ratio){if(!ratio){if(signal._param.value!==0){ratio=signal._param.value/this.bpm._param.value}else{ratio=0}}
var ratioSignal=new Tone.Gain(ratio);this.bpm.chain(ratioSignal,signal._param);this._syncedSignals.push({'ratio':ratioSignal,'signal':signal,'initial':signal._param.value});signal._param.value=0;return this};Tone.Transport.prototype.unsyncSignal=function(signal){for(var i=this._syncedSignals.length-1;i>=0;i--){var syncedSignal=this._syncedSignals[i];if(syncedSignal.signal===signal){syncedSignal.ratio.dispose();syncedSignal.signal._param.value=syncedSignal.initial;this._syncedSignals.splice(i,1)}}
return this};Tone.Transport.prototype.dispose=function(){Tone.Emitter.prototype.dispose.call(this);this._clock.dispose();this._clock=null;this._writable('bpm');this.bpm=null;this._timeline.dispose();this._timeline=null;this._onceEvents.dispose();this._onceEvents=null;this._repeatedEvents.dispose();this._repeatedEvents=null;return this};Tone.Transport.prototype.setInterval=function(callback,interval){console.warn('This method is deprecated. Use Tone.Transport.scheduleRepeat instead.');return Tone.Transport.scheduleRepeat(callback,interval)};Tone.Transport.prototype.clearInterval=function(id){console.warn('This method is deprecated. Use Tone.Transport.clear instead.');return Tone.Transport.clear(id)};Tone.Transport.prototype.setTimeout=function(callback,timeout){console.warn('This method is deprecated. Use Tone.Transport.scheduleOnce instead.');return Tone.Transport.scheduleOnce(callback,timeout)};Tone.Transport.prototype.clearTimeout=function(id){console.warn('This method is deprecated. Use Tone.Transport.clear instead.');return Tone.Transport.clear(id)};Tone.Transport.prototype.setTimeline=function(callback,time){console.warn('This method is deprecated. Use Tone.Transport.schedule instead.');return Tone.Transport.schedule(callback,time)};Tone.Transport.prototype.clearTimeline=function(id){console.warn('This method is deprecated. Use Tone.Transport.clear instead.');return Tone.Transport.clear(id)};var TransportConstructor=Tone.Transport;Tone._initAudioContext(function(){if(typeof Tone.Transport==='function'){Tone.Transport=new Tone.Transport()}else{Tone.Transport.stop();var prevSettings=Tone.Transport.get();Tone.Transport.dispose();TransportConstructor.call(Tone.Transport);Tone.Transport.set(prevSettings)}});return Tone.Transport});Module(function(Tone){Tone.Volume=function(){var options=this.optionsObject(arguments,['volume'],Tone.Volume.defaults);this.output=this.input=new Tone.Gain(options.volume,Tone.Type.Decibels);this.volume=this.output.gain;this._readOnly('volume')};Tone.extend(Tone.Volume);Tone.Volume.defaults={'volume':0};Tone.Volume.prototype.dispose=function(){this.input.dispose();Tone.prototype.dispose.call(this);this._writable('volume');this.volume.dispose();this.volume=null;return this};return Tone.Volume});Module(function(Tone){Tone.Source=function(options){Tone.call(this);options=this.defaultArg(options,Tone.Source.defaults);this._volume=this.output=new Tone.Volume(options.volume);this.volume=this._volume.volume;this._readOnly('volume');this._state=new Tone.TimelineState(Tone.State.Stopped);this._syncStart=function(time,offset){time=this.toSeconds(time);time+=this.toSeconds(this._startDelay);this.start(time,offset)}.bind(this);this._syncStop=this.stop.bind(this);this._startDelay=0;this._volume.output.output.channelCount=2;this._volume.output.output.channelCountMode='explicit'};Tone.extend(Tone.Source);Tone.Source.defaults={'volume':0};Object.defineProperty(Tone.Source.prototype,'state',{get:function(){return this._state.getStateAtTime(this.now())}});Tone.Source.prototype.start=function(time){time=this.toSeconds(time);if(this._state.getStateAtTime(time)!==Tone.State.Started||this.retrigger){this._state.setStateAtTime(Tone.State.Started,time);if(this._start){this._start.apply(this,arguments)}}
return this};Tone.Source.prototype.stop=function(time){time=this.toSeconds(time);if(this._state.getStateAtTime(time)===Tone.State.Started){this._state.setStateAtTime(Tone.State.Stopped,time);if(this._stop){this._stop.apply(this,arguments)}}
return this};Tone.Source.prototype.sync=function(delay){this._startDelay=this.defaultArg(delay,0);Tone.Transport.on('start',this._syncStart);Tone.Transport.on('stop pause',this._syncStop);return this};Tone.Source.prototype.unsync=function(){this._startDelay=0;Tone.Transport.off('start',this._syncStart);Tone.Transport.off('stop pause',this._syncStop);return this};Tone.Source.prototype.dispose=function(){this.stop();Tone.prototype.dispose.call(this);this.unsync();this._writable('volume');this._volume.dispose();this._volume=null;this.volume=null;this._state.dispose();this._state=null;this._syncStart=null;this._syncStart=null};return Tone.Source});Module(function(Tone){Tone.Oscillator=function(){var options=this.optionsObject(arguments,['frequency','type'],Tone.Oscillator.defaults);Tone.Source.call(this,options);this._oscillator=null;this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency);this.detune=new Tone.Signal(options.detune,Tone.Type.Cents);this._wave=null;this._partials=this.defaultArg(options.partials,[1]);this._phase=options.phase;this._type=null;this.type=options.type;this.phase=this._phase;this._readOnly(['frequency','detune'])};Tone.extend(Tone.Oscillator,Tone.Source);Tone.Oscillator.defaults={'type':'sine','frequency':440,'detune':0,'phase':0,'partials':[]};Tone.Oscillator.Type={Sine:'sine',Triangle:'triangle',Sawtooth:'sawtooth',Square:'square',Custom:'custom'};Tone.Oscillator.prototype._start=function(time){this._oscillator=this.context.createOscillator();this._oscillator.setPeriodicWave(this._wave);this._oscillator.connect(this.output);this.frequency.connect(this._oscillator.frequency);this.detune.connect(this._oscillator.detune);this._oscillator.start(this.toSeconds(time))};Tone.Oscillator.prototype._stop=function(time){if(this._oscillator){this._oscillator.stop(this.toSeconds(time));this._oscillator=null}
return this};Tone.Oscillator.prototype.syncFrequency=function(){Tone.Transport.syncSignal(this.frequency);return this};Tone.Oscillator.prototype.unsyncFrequency=function(){Tone.Transport.unsyncSignal(this.frequency);return this};Object.defineProperty(Tone.Oscillator.prototype,'type',{get:function(){return this._type},set:function(type){var coefs=this._getRealImaginary(type,this._phase);var periodicWave=this.context.createPeriodicWave(coefs[0],coefs[1]);this._wave=periodicWave;if(this._oscillator!==null){this._oscillator.setPeriodicWave(this._wave)}
this._type=type}});Tone.Oscillator.prototype._getRealImaginary=function(type,phase){var fftSize=4096;var periodicWaveSize=fftSize/2;var real=new Float32Array(periodicWaveSize);var imag=new Float32Array(periodicWaveSize);var partialCount=1;if(type===Tone.Oscillator.Type.Custom){partialCount=this._partials.length+1;periodicWaveSize=partialCount}else{var partial=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(type);if(partial){partialCount=parseInt(partial[2])+1;type=partial[1];partialCount=Math.max(partialCount,2);periodicWaveSize=partialCount}}
for(var n=1;n<periodicWaveSize;++n){var piFactor=2/(n*Math.PI);var b;switch(type){case Tone.Oscillator.Type.Sine:b=n<=partialCount?1:0;break;case Tone.Oscillator.Type.Square:b=n&1?2*piFactor:0;break;case Tone.Oscillator.Type.Sawtooth:b=piFactor*(n&1?1:-1);break;case Tone.Oscillator.Type.Triangle:if(n&1){b=2*(piFactor*piFactor)*(n-1>>1&1?-1:1)}else{b=0}
break;case Tone.Oscillator.Type.Custom:b=this._partials[n-1];break;default:throw new Error('invalid oscillator type: '+type)}
if(b!==0){real[n]=-b*Math.sin(phase*n);imag[n]=b*Math.cos(phase*n)}else{real[n]=0;imag[n]=0}}
return[real,imag]};Tone.Oscillator.prototype._inverseFFT=function(real,imag,phase){var sum=0;var len=real.length;for(var i=0;i<len;i++){sum+=real[i]*Math.cos(i*phase)+imag[i]*Math.sin(i*phase)}
return sum};Tone.Oscillator.prototype._getInitialValue=function(){var coefs=this._getRealImaginary(this._type,0);var real=coefs[0];var imag=coefs[1];var maxValue=0;var twoPi=Math.PI*2;for(var i=0;i<8;i++){maxValue=Math.max(this._inverseFFT(real,imag,i/8*twoPi),maxValue)}
return-this._inverseFFT(real,imag,this._phase)/maxValue};Object.defineProperty(Tone.Oscillator.prototype,'partials',{get:function(){if(this._type!==Tone.Oscillator.Type.Custom){return[]}else{return this._partials}},set:function(partials){this._partials=partials;this.type=Tone.Oscillator.Type.Custom}});Object.defineProperty(Tone.Oscillator.prototype,'phase',{get:function(){return this._phase*(180/Math.PI)},set:function(phase){this._phase=phase*Math.PI/180;this.type=this._type}});Tone.Oscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);if(this._oscillator!==null){this._oscillator.disconnect();this._oscillator=null}
this._wave=null;this._writable(['frequency','detune']);this.frequency.dispose();this.frequency=null;this.detune.dispose();this.detune=null;this._partials=null;return this};return Tone.Oscillator});Module(function(Tone){Tone.LFO=function(){var options=this.optionsObject(arguments,['frequency','min','max'],Tone.LFO.defaults);this._oscillator=new Tone.Oscillator({'frequency':options.frequency,'type':options.type});this.frequency=this._oscillator.frequency;this.amplitude=this._oscillator.volume;this.amplitude.units=Tone.Type.NormalRange;this.amplitude.value=options.amplitude;this._stoppedSignal=new Tone.Signal(0,Tone.Type.AudioRange);this._stoppedValue=0;this._a2g=new Tone.AudioToGain();this._scaler=this.output=new Tone.Scale(options.min,options.max);this._units=Tone.Type.Default;this.units=options.units;this._oscillator.chain(this._a2g,this._scaler);this._stoppedSignal.connect(this._a2g);this._readOnly(['amplitude','frequency']);this.phase=options.phase};Tone.extend(Tone.LFO,Tone.Oscillator);Tone.LFO.defaults={'type':'sine','min':0,'max':1,'phase':0,'frequency':'4n','amplitude':1,'units':Tone.Type.Default};Tone.LFO.prototype.start=function(time){time=this.toSeconds(time);this._stoppedSignal.setValueAtTime(0,time);this._oscillator.start(time);return this};Tone.LFO.prototype.stop=function(time){time=this.toSeconds(time);this._stoppedSignal.setValueAtTime(this._stoppedValue,time);this._oscillator.stop(time);return this};Tone.LFO.prototype.sync=function(delay){this._oscillator.sync(delay);this._oscillator.syncFrequency();return this};Tone.LFO.prototype.unsync=function(){this._oscillator.unsync();this._oscillator.unsyncFrequency();return this};Object.defineProperty(Tone.LFO.prototype,'min',{get:function(){return this._toUnits(this._scaler.min)},set:function(min){min=this._fromUnits(min);this._scaler.min=min}});Object.defineProperty(Tone.LFO.prototype,'max',{get:function(){return this._toUnits(this._scaler.max)},set:function(max){max=this._fromUnits(max);this._scaler.max=max}});Object.defineProperty(Tone.LFO.prototype,'type',{get:function(){return this._oscillator.type},set:function(type){this._oscillator.type=type;this._stoppedValue=this._oscillator._getInitialValue();this._stoppedSignal.value=this._stoppedValue}});Object.defineProperty(Tone.LFO.prototype,'phase',{get:function(){return this._oscillator.phase},set:function(phase){this._oscillator.phase=phase;this._stoppedValue=this._oscillator._getInitialValue();this._stoppedSignal.value=this._stoppedValue}});Object.defineProperty(Tone.LFO.prototype,'units',{get:function(){return this._units},set:function(val){var currentMin=this.min;var currentMax=this.max;this._units=val;this.min=currentMin;this.max=currentMax}});Object.defineProperty(Tone.LFO.prototype,'state',{get:function(){return this._oscillator.state}});Tone.LFO.prototype.connect=function(node){if(node.constructor===Tone.Signal||node.constructor===Tone.Param||node.constructor===Tone.TimelineSignal){this.convert=node.convert;this.units=node.units}
Tone.Signal.prototype.connect.apply(this,arguments);return this};Tone.LFO.prototype._fromUnits=Tone.Param.prototype._fromUnits;Tone.LFO.prototype._toUnits=Tone.Param.prototype._toUnits;Tone.LFO.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['amplitude','frequency']);this._oscillator.dispose();this._oscillator=null;this._stoppedSignal.dispose();this._stoppedSignal=null;this._scaler.dispose();this._scaler=null;this._a2g.dispose();this._a2g=null;this.frequency=null;this.amplitude=null;return this};return Tone.LFO});Module(function(Tone){Tone.Limiter=function(){var options=this.optionsObject(arguments,['threshold'],Tone.Limiter.defaults);this._compressor=this.input=this.output=new Tone.Compressor({'attack':0.001,'decay':0.001,'threshold':options.threshold});this.threshold=this._compressor.threshold;this._readOnly('threshold')};Tone.extend(Tone.Limiter);Tone.Limiter.defaults={'threshold':-12};Tone.Limiter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._compressor.dispose();this._compressor=null;this._writable('threshold');this.threshold=null;return this};return Tone.Limiter});Module(function(Tone){Tone.LowpassCombFilter=function(){Tone.call(this);var options=this.optionsObject(arguments,['delayTime','resonance','dampening'],Tone.LowpassCombFilter.defaults);this._delay=this.input=this.context.createDelay(1);this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time);this._lowpass=this.output=this.context.createBiquadFilter();this._lowpass.Q.value=0;this._lowpass.type='lowpass';this.dampening=new Tone.Param({'param':this._lowpass.frequency,'units':Tone.Type.Frequency,'value':options.dampening});this._feedback=this.context.createGain();this.resonance=new Tone.Param({'param':this._feedback.gain,'units':Tone.Type.NormalRange,'value':options.resonance});this._delay.chain(this._lowpass,this._feedback,this._delay);this.delayTime.connect(this._delay.delayTime);this._readOnly(['dampening','resonance','delayTime'])};Tone.extend(Tone.LowpassCombFilter);Tone.LowpassCombFilter.defaults={'delayTime':0.1,'resonance':0.5,'dampening':3000};Tone.LowpassCombFilter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['dampening','resonance','delayTime']);this.dampening.dispose();this.dampening=null;this.resonance.dispose();this.resonance=null;this._delay.disconnect();this._delay=null;this._lowpass.disconnect();this._lowpass=null;this._feedback.disconnect();this._feedback=null;this.delayTime.dispose();this.delayTime=null;return this};return Tone.LowpassCombFilter});Module(function(Tone){Tone.Merge=function(){Tone.call(this,2,0);this.left=this.input[0]=this.context.createGain();this.right=this.input[1]=this.context.createGain();this._merger=this.output=this.context.createChannelMerger(2);this.left.connect(this._merger,0,0);this.right.connect(this._merger,0,1);this.left.channelCount=1;this.right.channelCount=1;this.left.channelCountMode='explicit';this.right.channelCountMode='explicit'};Tone.extend(Tone.Merge);Tone.Merge.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.left.disconnect();this.left=null;this.right.disconnect();this.right=null;this._merger.disconnect();this._merger=null;return this};return Tone.Merge});Module(function(Tone){Tone.Meter=function(){var options=this.optionsObject(arguments,['channels','smoothing'],Tone.Meter.defaults);Tone.call(this);this._channels=options.channels;this.smoothing=options.smoothing;this.clipMemory=options.clipMemory;this.clipLevel=options.clipLevel;this._volume=new Array(this._channels);this._values=new Array(this._channels);for(var i=0;i<this._channels;i++){this._volume[i]=0;this._values[i]=0}
this._lastClip=new Array(this._channels);for(var j=0;j<this._lastClip.length;j++){this._lastClip[j]=0}
this._jsNode=this.context.createScriptProcessor(options.bufferSize,this._channels,1);this._jsNode.onaudioprocess=this._onprocess.bind(this);this._jsNode.noGC();this.input.connect(this.output);this.input.connect(this._jsNode)};Tone.extend(Tone.Meter);Tone.Meter.defaults={'smoothing':0.8,'bufferSize':1024,'clipMemory':0.5,'clipLevel':0.9,'channels':1};Tone.Meter.prototype._onprocess=function(event){var bufferSize=this._jsNode.bufferSize;var smoothing=this.smoothing;for(var channel=0;channel<this._channels;channel++){var input=event.inputBuffer.getChannelData(channel);var sum=0;var total=0;var x;for(var i=0;i<bufferSize;i++){x=input[i];total+=x;sum+=x*x}
var average=total/bufferSize;var rms=Math.sqrt(sum/bufferSize);if(rms>0.9){this._lastClip[channel]=Date.now()}
this._volume[channel]=Math.max(rms,this._volume[channel]*smoothing);this._values[channel]=average}};Tone.Meter.prototype.getLevel=function(channel){channel=this.defaultArg(channel,0);var vol=this._volume[channel];if(vol<0.00001){return 0}else{return vol}};Tone.Meter.prototype.getValue=function(channel){channel=this.defaultArg(channel,0);return this._values[channel]};Tone.Meter.prototype.getDb=function(channel){return this.gainToDb(this.getLevel(channel))};Tone.Meter.prototype.isClipped=function(channel){channel=this.defaultArg(channel,0);return Date.now()-this._lastClip[channel]<this._clipMemory*1000};Tone.Meter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._jsNode.disconnect();this._jsNode.onaudioprocess=null;this._jsNode=null;this._volume=null;this._values=null;this._lastClip=null;return this};return Tone.Meter});Module(function(Tone){Tone.Split=function(){Tone.call(this,0,2);this._splitter=this.input=this.context.createChannelSplitter(2);this.left=this.output[0]=this.context.createGain();this.right=this.output[1]=this.context.createGain();this._splitter.connect(this.left,0,0);this._splitter.connect(this.right,1,0)};Tone.extend(Tone.Split);Tone.Split.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._splitter.disconnect();this.left.disconnect();this.right.disconnect();this.left=null;this.right=null;this._splitter=null;return this};return Tone.Split});Module(function(Tone){Tone.MidSideSplit=function(){Tone.call(this,0,2);this._split=this.input=new Tone.Split();this.mid=this.output[0]=new Tone.Expr('($0 + $1) * $2');this.side=this.output[1]=new Tone.Expr('($0 - $1) * $2');this._split.connect(this.mid,0,0);this._split.connect(this.mid,1,1);this._split.connect(this.side,0,0);this._split.connect(this.side,1,1);sqrtTwo.connect(this.mid,0,2);sqrtTwo.connect(this.side,0,2)};Tone.extend(Tone.MidSideSplit);var sqrtTwo=null;Tone._initAudioContext(function(){sqrtTwo=new Tone.Signal(1/Math.sqrt(2))});Tone.MidSideSplit.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.mid.dispose();this.mid=null;this.side.dispose();this.side=null;this._split.dispose();this._split=null;return this};return Tone.MidSideSplit});Module(function(Tone){Tone.MidSideMerge=function(){Tone.call(this,2,0);this.mid=this.input[0]=this.context.createGain();this._left=new Tone.Expr('($0 + $1) * $2');this.side=this.input[1]=this.context.createGain();this._right=new Tone.Expr('($0 - $1) * $2');this._merge=this.output=new Tone.Merge();this.mid.connect(this._left,0,0);this.side.connect(this._left,0,1);this.mid.connect(this._right,0,0);this.side.connect(this._right,0,1);this._left.connect(this._merge,0,0);this._right.connect(this._merge,0,1);sqrtTwo.connect(this._left,0,2);sqrtTwo.connect(this._right,0,2)};Tone.extend(Tone.MidSideMerge);var sqrtTwo=null;Tone._initAudioContext(function(){sqrtTwo=new Tone.Signal(1/Math.sqrt(2))});Tone.MidSideMerge.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.mid.disconnect();this.mid=null;this.side.disconnect();this.side=null;this._left.dispose();this._left=null;this._right.dispose();this._right=null;this._merge.dispose();this._merge=null;return this};return Tone.MidSideMerge});Module(function(Tone){Tone.MidSideCompressor=function(options){options=this.defaultArg(options,Tone.MidSideCompressor.defaults);this._midSideSplit=this.input=new Tone.MidSideSplit();this._midSideMerge=this.output=new Tone.MidSideMerge();this.mid=new Tone.Compressor(options.mid);this.side=new Tone.Compressor(options.side);this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid);this._midSideSplit.side.chain(this.side,this._midSideMerge.side);this._readOnly(['mid','side'])};Tone.extend(Tone.MidSideCompressor);Tone.MidSideCompressor.defaults={'mid':{'ratio':3,'threshold':-24,'release':0.03,'attack':0.02,'knee':16},'side':{'ratio':6,'threshold':-30,'release':0.25,'attack':0.03,'knee':10}};Tone.MidSideCompressor.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['mid','side']);this.mid.dispose();this.mid=null;this.side.dispose();this.side=null;this._midSideSplit.dispose();this._midSideSplit=null;this._midSideMerge.dispose();this._midSideMerge=null;return this};return Tone.MidSideCompressor});Module(function(Tone){Tone.Mono=function(){Tone.call(this,1,0);this._merge=this.output=new Tone.Merge();this.input.connect(this._merge,0,0);this.input.connect(this._merge,0,1);this.input.gain.value=this.dbToGain(-10)};Tone.extend(Tone.Mono);Tone.Mono.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._merge.dispose();this._merge=null;return this};return Tone.Mono});Module(function(Tone){Tone.MultibandCompressor=function(options){options=this.defaultArg(arguments,Tone.MultibandCompressor.defaults);this._splitter=this.input=new Tone.MultibandSplit({'lowFrequency':options.lowFrequency,'highFrequency':options.highFrequency});this.lowFrequency=this._splitter.lowFrequency;this.highFrequency=this._splitter.highFrequency;this.output=this.context.createGain();this.low=new Tone.Compressor(options.low);this.mid=new Tone.Compressor(options.mid);this.high=new Tone.Compressor(options.high);this._splitter.low.chain(this.low,this.output);this._splitter.mid.chain(this.mid,this.output);this._splitter.high.chain(this.high,this.output);this._readOnly(['high','mid','low','highFrequency','lowFrequency'])};Tone.extend(Tone.MultibandCompressor);Tone.MultibandCompressor.defaults={'low':Tone.Compressor.defaults,'mid':Tone.Compressor.defaults,'high':Tone.Compressor.defaults,'lowFrequency':250,'highFrequency':2000};Tone.MultibandCompressor.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._splitter.dispose();this._writable(['high','mid','low','highFrequency','lowFrequency']);this.low.dispose();this.mid.dispose();this.high.dispose();this._splitter=null;this.low=null;this.mid=null;this.high=null;this.lowFrequency=null;this.highFrequency=null;return this};return Tone.MultibandCompressor});Module(function(Tone){Tone.GainToAudio=function(){this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return Math.abs(x)*2-1})};Tone.extend(Tone.GainToAudio,Tone.SignalBase);Tone.GainToAudio.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._norm.dispose();this._norm=null;return this};return Tone.GainToAudio});Module(function(Tone){Tone.Panner=function(initialPan){Tone.call(this);this._hasStereoPanner=this.isFunction(this.context.createStereoPanner);if(this._hasStereoPanner){this._panner=this.input=this.output=this.context.createStereoPanner();this.pan=new Tone.Signal(0,Tone.Type.NormalRange);this._scalePan=new Tone.GainToAudio();this.pan.chain(this._scalePan,this._panner.pan)}else{this._crossFade=new Tone.CrossFade();this._merger=this.output=new Tone.Merge();this._splitter=this.input=new Tone.Split();this.pan=this._crossFade.fade;this._splitter.connect(this._crossFade,0,0);this._splitter.connect(this._crossFade,1,1);this._crossFade.a.connect(this._merger,0,0);this._crossFade.b.connect(this._merger,0,1)}
this.pan.value=this.defaultArg(initialPan,0.5);this._readOnly('pan')};Tone.extend(Tone.Panner);Tone.Panner.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable('pan');if(this._hasStereoPanner){this._panner.disconnect();this._panner=null;this.pan.dispose();this.pan=null;this._scalePan.dispose();this._scalePan=null}else{this._crossFade.dispose();this._crossFade=null;this._splitter.dispose();this._splitter=null;this._merger.dispose();this._merger=null;this.pan=null}
return this};return Tone.Panner});Module(function(Tone){Tone.PanVol=function(){var options=this.optionsObject(arguments,['pan','volume'],Tone.PanVol.defaults);this._panner=this.input=new Tone.Panner(options.pan);this.pan=this._panner.pan;this._volume=this.output=new Tone.Volume(options.volume);this.volume=this._volume.volume;this._panner.connect(this._volume);this._readOnly(['pan','volume'])};Tone.extend(Tone.PanVol);Tone.PanVol.defaults={'pan':0.5,'volume':0};Tone.PanVol.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(['pan','volume']);this._panner.dispose();this._panner=null;this.pan=null;this._volume.dispose();this._volume=null;this.volume=null;return this};return Tone.PanVol});Module(function(Tone){Tone.SimpleEnvelope=function(){var options=this.optionsObject(arguments,['attack','decay','sustain','release'],Tone.SimpleEnvelope.defaults);this.attack=options.attack;this.decay=options.decay;this.sustain=options.sustain;this.release=options.release;this._minOutput=0.00001;this._attackCurve=Tone.SimpleEnvelope.Type.Linear;this._decayCurve=Tone.SimpleEnvelope.Type.Exponential;this._releaseCurve=Tone.SimpleEnvelope.Type.Exponential;this._sig=this.output=new Tone.Signal();this._sig.setValueAtTime(0,0);this.attackCurve=options.attackCurve;this.decayCurve=options.decayCurve;this.releaseCurve=options.releaseCurve;this.input=this.output=new Tone.Gain();this._sig.connect(this.output.gain)};Tone.extend(Tone.SimpleEnvelope);Tone.SimpleEnvelope.defaults={'attack':0.01,'decay':0.1,'sustain':0.5,'release':1,'attackCurve':'linear','decayCurve':'exponential','releaseCurve':'exponential'};Tone.SimpleEnvelope.prototype._timeMult=0.25;Object.defineProperty(Tone.SimpleEnvelope.prototype,'value',{get:function(){return this._sig.value}});Object.defineProperty(Tone.SimpleEnvelope.prototype,'attackCurve',{get:function(){return this._attackCurve},set:function(type){if(type===Tone.SimpleEnvelope.Type.Linear||type===Tone.SimpleEnvelope.Type.Exponential){this._attackCurve=type}else{throw Error('attackCurve must be either "linear" or "exponential". Invalid type: ',type)}}});Object.defineProperty(Tone.SimpleEnvelope.prototype,'decayCurve',{get:function(){return this._decayCurve},set:function(type){if(type===Tone.SimpleEnvelope.Type.Linear||type===Tone.SimpleEnvelope.Type.Exponential){this._decayCurve=type}else{throw Error('decayCurve must be either "linear" or "exponential". Invalid type: ',type)}}});Object.defineProperty(Tone.SimpleEnvelope.prototype,'releaseCurve',{get:function(){return this._releaseCurve},set:function(type){if(type===Tone.SimpleEnvelope.Type.Linear||type===Tone.SimpleEnvelope.Type.Exponential){this._releaseCurve=type}else{throw Error('releaseCurve must be either "linear" or "exponential". Invalid type: ',type)}}});Tone.SimpleEnvelope.prototype.triggerAttack=function(time,velocity){time=this.defaultArg(time,0)+Tone.context.currentTime;var attack=this.toSeconds(this.attack);var decay=this.toSeconds(this.decay)*this._timeMult;velocity=this.defaultArg(velocity,1);this._sig.cancelScheduledValues(time);this._sig.setValueAtTime(this._sig.value,time);if(this._attackCurve===Tone.SimpleEnvelope.Type.Linear){this._sig.linearRampToValueAtTime(velocity,time+attack)}else{this._sig.exponentialRampToValueAtTime(velocity,time+attack)}
if(this._decayCurve===Tone.SimpleEnvelope.Type.Linear){this._sig.linearRampToValueAtTime(this.sustain*velocity,time+attack+decay)}else{this._sig.exponentialRampToValueAtTime(this.sustain*velocity,time+attack+decay)}
return this};Tone.SimpleEnvelope.prototype.triggerRelease=function(time){time=this.defaultArg(time,0)+Tone.context.currentTime;var release=this.toSeconds(this.release)*this._timeMult;this._sig.cancelScheduledValues(time);this._sig.setValueAtTime(this._sig.value,time);if(this._releaseCurve===Tone.SimpleEnvelope.Type.Linear){this._sig.linearRampToValueAtTime(this._minOutput,time+release)}else{this._sig.exponentialRampToValueAtTime(this._minOutput,time+release)}
this._sig.exponentialRampToValueAtTime(this._minOutput,time+release);return this};Tone.SimpleEnvelope.prototype.triggerAttackRelease=function(duration,time,velocity){this.triggerAttack(time,velocity);this.triggerRelease(time+this.toSeconds(duration));return this};Tone.SimpleEnvelope.prototype.connect=Tone.Signal.prototype.connect;Tone.SimpleEnvelope.prototype.dispose=function(){this.input.dispose();this.input=null;Tone.prototype.dispose.call(this);this._sig.dispose();this._sig=null;return this};Tone.SimpleEnvelope.Type={Linear:'linear',Exponential:'exponential'};return Tone.SimpleEnvelope});Module(function(Tone){Tone.CtrlInterpolate=function(){var options=this.optionsObject(arguments,['values','index'],Tone.CtrlInterpolate.defaults);this.values=options.values;this.index=options.index};Tone.extend(Tone.CtrlInterpolate);Tone.CtrlInterpolate.defaults={'index':0,'values':[]};Object.defineProperty(Tone.CtrlInterpolate.prototype,'value',{get:function(){var index=this.index;index=Math.min(index,this.values.length-1);var lowerPosition=Math.floor(index);var lower=this.values[lowerPosition];var upper=this.values[Math.ceil(index)];return this._interpolate(index-lowerPosition,lower,upper)}});Tone.CtrlInterpolate.prototype._interpolate=function(index,lower,upper){if(this.isArray(lower)){var retArray=[];for(var i=0;i<lower.length;i++){retArray[i]=this._interpolate(index,lower[i],upper[i])}
return retArray}else if(this.isObject(lower)){var retObj={};for(var attr in lower){retObj[attr]=this._interpolate(index,lower[attr],upper[attr])}
return retObj}else{lower=this._toNumber(lower);upper=this._toNumber(upper);return(1-index)*lower+index*upper}};Tone.CtrlInterpolate.prototype._toNumber=function(val){if(this.isNumber(val)){return val}else if(this.isNote(val)){return this.toFrequency(val)}else{return this.toSeconds(val)}};Tone.CtrlInterpolate.prototype.dispose=function(){this.values=null};return Tone.CtrlInterpolate});Module(function(Tone){Tone.CtrlMarkov=function(values,initial){this.values=this.defaultArg(values,{});this.value=this.defaultArg(initial,Object.keys(this.values)[0])};Tone.extend(Tone.CtrlMarkov);Tone.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var next=this.values[this.value];if(this.isArray(next)){var distribution=this._getProbDistribution(next);var rand=Math.random();var total=0;for(var i=0;i<distribution.length;i++){var dist=distribution[i];if(rand>total&&rand<total+dist){var chosen=next[i];if(this.isObject(chosen)){this.value=chosen.value}else{this.value=chosen}}
total+=dist}}else{this.value=next}}
return this.value};Tone.CtrlMarkov.prototype._getProbDistribution=function(options){var distribution=[];var total=0;var needsNormalizing=!1;for(var i=0;i<options.length;i++){var option=options[i];if(this.isObject(option)){needsNormalizing=!0;distribution[i]=option.probability}else{distribution[i]=1/options.length}
total+=distribution[i]}
if(needsNormalizing){for(var j=0;j<distribution.length;j++){distribution[j]=distribution[j]/total}}
return distribution};Tone.CtrlMarkov.prototype.dispose=function(){this.values=null};return Tone.CtrlMarkov});Module(function(Tone){Tone.CtrlPattern=function(){var options=this.optionsObject(arguments,['values','type'],Tone.CtrlPattern.defaults);this.values=options.values;this.index=0;this._type=null;this._shuffled=null;this._direction=null;this.type=options.type};Tone.extend(Tone.CtrlPattern);Tone.CtrlPattern.Type={Up:'up',Down:'down',UpDown:'upDown',DownUp:'downUp',AlternateUp:'alternateUp',AlternateDown:'alternateDown',Random:'random',RandomWalk:'randomWalk',RandomOnce:'randomOnce'};Tone.CtrlPattern.defaults={'type':Tone.CtrlPattern.Type.Up,'values':[]};Object.defineProperty(Tone.CtrlPattern.prototype,'value',{get:function(){if(this.values.length===0){return}else if(this.values.length===1){return this.values[0]}
this.index=Math.min(this.index,this.values.length-1);var val=this.values[this.index];if(this.type===Tone.CtrlPattern.Type.RandomOnce){if(this.values.length!==this._shuffled.length){this._shuffleValues()}
val=this.values[this._shuffled[this.index]]}
return val}});Object.defineProperty(Tone.CtrlPattern.prototype,'type',{get:function(){return this._type},set:function(type){this._type=type;this._shuffled=null;if(this._type===Tone.CtrlPattern.Type.Up||this._type===Tone.CtrlPattern.Type.UpDown||this._type===Tone.CtrlPattern.Type.RandomOnce||this._type===Tone.CtrlPattern.Type.AlternateUp){this.index=0}else if(this._type===Tone.CtrlPattern.Type.Down||this._type===Tone.CtrlPattern.Type.DownUp||this._type===Tone.CtrlPattern.Type.AlternateDown){this.index=this.values.length-1}
if(this._type===Tone.CtrlPattern.Type.UpDown||this._type===Tone.CtrlPattern.Type.AlternateUp){this._direction=Tone.CtrlPattern.Type.Up}else if(this._type===Tone.CtrlPattern.Type.DownUp||this._type===Tone.CtrlPattern.Type.AlternateDown){this._direction=Tone.CtrlPattern.Type.Down}
if(this._type===Tone.CtrlPattern.Type.RandomOnce){this._shuffleValues()}else if(this._type===Tone.CtrlPattern.Random){this.index=Math.floor(Math.random()*this.values.length)}}});Tone.CtrlPattern.prototype.next=function(){var type=this.type;if(type===Tone.CtrlPattern.Type.Up){this.index++;if(this.index>=this.values.length){this.index=0}}else if(type===Tone.CtrlPattern.Type.Down){this.index--;if(this.index<0){this.index=this.values.length-1}}else if(type===Tone.CtrlPattern.Type.UpDown||type===Tone.CtrlPattern.Type.DownUp){if(this._direction===Tone.CtrlPattern.Type.Up){this.index++}else{this.index--}
if(this.index<0){this.index=1;this._direction=Tone.CtrlPattern.Type.Up}else if(this.index>=this.values.length){this.index=this.values.length-2;this._direction=Tone.CtrlPattern.Type.Down}}else if(type===Tone.CtrlPattern.Type.Random){this.index=Math.floor(Math.random()*this.values.length)}else if(type===Tone.CtrlPattern.Type.RandomWalk){if(Math.random()<0.5){this.index--;this.index=Math.max(this.index,0)}else{this.index++;this.index=Math.min(this.index,this.values.length-1)}}else if(type===Tone.CtrlPattern.Type.RandomOnce){this.index++;if(this.index>=this.values.length){this.index=0;this._shuffleValues()}}else if(type===Tone.CtrlPattern.Type.AlternateUp){if(this._direction===Tone.CtrlPattern.Type.Up){this.index+=2;this._direction=Tone.CtrlPattern.Type.Down}else{this.index-=1;this._direction=Tone.CtrlPattern.Type.Up}
if(this.index>=this.values.length){this.index=0;this._direction=Tone.CtrlPattern.Type.Up}}else if(type===Tone.CtrlPattern.Type.AlternateDown){if(this._direction===Tone.CtrlPattern.Type.Up){this.index+=1;this._direction=Tone.CtrlPattern.Type.Down}else{this.index-=2;this._direction=Tone.CtrlPattern.Type.Up}
if(this.index<0){this.index=this.values.length-1;this._direction=Tone.CtrlPattern.Type.Down}}
return this.value};Tone.CtrlPattern.prototype._shuffleValues=function(){var copy=[];this._shuffled=[];for(var i=0;i<this.values.length;i++){copy[i]=i}
while(copy.length>0){var randVal=copy.splice(Math.floor(copy.length*Math.random()),1);this._shuffled.push(randVal[0])}};Tone.CtrlPattern.prototype.dispose=function(){this._shuffled=null;this.values=null};return Tone.CtrlPattern});Module(function(Tone){Tone.CtrlRandom=function(){var options=this.optionsObject(arguments,['min','max'],Tone.CtrlRandom.defaults);this.min=options.min;this.max=options.max;this.integer=options.integer};Tone.extend(Tone.CtrlRandom);Tone.CtrlRandom.defaults={'min':0,'max':1,'integer':!1};Object.defineProperty(Tone.CtrlRandom.prototype,'value',{get:function(){var min=this.toSeconds(this.min);var max=this.toSeconds(this.max);var rand=Math.random();var val=rand*min+(1-rand)*max;if(this.integer){val=Math.floor(val)}
return val}});return Tone.CtrlRandom});Module(function(Tone){Tone.Buffer=function(){var options=this.optionsObject(arguments,['url','onload'],Tone.Buffer.defaults);this._buffer=null;this._reversed=options.reverse;this.url=undefined;this.loaded=!1;this.onload=options.onload.bind(this,this);if(options.url instanceof AudioBuffer||options.url instanceof Tone.Buffer){this.set(options.url);this.onload(this)}else if(this.isString(options.url)){this.url=options.url;Tone.Buffer._addToQueue(options.url,this)}};Tone.extend(Tone.Buffer);Tone.Buffer.defaults={'url':undefined,'onload':Tone.noOp,'reverse':!1};Tone.Buffer.prototype.set=function(buffer){if(buffer instanceof Tone.Buffer){this._buffer=buffer.get()}else{this._buffer=buffer}
this.loaded=!0;return this};Tone.Buffer.prototype.get=function(){return this._buffer};Tone.Buffer.prototype.load=function(url,callback){this.url=url;this.onload=this.defaultArg(callback,this.onload);Tone.Buffer._addToQueue(url,this);return this};Tone.Buffer.prototype.dispose=function(){Tone.prototype.dispose.call(this);Tone.Buffer._removeFromQueue(this);this._buffer=null;this.onload=Tone.Buffer.defaults.onload;return this};Object.defineProperty(Tone.Buffer.prototype,'duration',{get:function(){if(this._buffer){return this._buffer.duration}else{return 0}}});Tone.Buffer.prototype._reverse=function(){if(this.loaded){for(var i=0;i<this._buffer.numberOfChannels;i++){Array.prototype.reverse.call(this._buffer.getChannelData(i))}}
return this};Object.defineProperty(Tone.Buffer.prototype,'reverse',{get:function(){return this._reversed},set:function(rev){if(this._reversed!==rev){this._reversed=rev;this._reverse()}}});Tone.Emitter.mixin(Tone.Buffer);Tone.Buffer._queue=[];Tone.Buffer._currentDownloads=[];Tone.Buffer._totalDownloads=0;Tone.Buffer.MAX_SIMULTANEOUS_DOWNLOADS=6;Tone.Buffer._addToQueue=function(url,buffer){Tone.Buffer._queue.push({url:url,Buffer:buffer,progress:0,xhr:null});this._totalDownloads++;Tone.Buffer._next()};Tone.Buffer._removeFromQueue=function(buffer){var i;for(i=0;i<Tone.Buffer._queue.length;i++){var q=Tone.Buffer._queue[i];if(q.Buffer===buffer){Tone.Buffer._queue.splice(i,1)}}
for(i=0;i<Tone.Buffer._currentDownloads.length;i++){var dl=Tone.Buffer._currentDownloads[i];if(dl.Buffer===buffer){Tone.Buffer._currentDownloads.splice(i,1);dl.xhr.abort();dl.xhr.onprogress=null;dl.xhr.onload=null;dl.xhr.onerror=null}}};Tone.Buffer._next=function(){if(Tone.Buffer._queue.length>0){if(Tone.Buffer._currentDownloads.length<Tone.Buffer.MAX_SIMULTANEOUS_DOWNLOADS){var next=Tone.Buffer._queue.shift();Tone.Buffer._currentDownloads.push(next);next.xhr=Tone.Buffer.load(next.url,function(buffer){var index=Tone.Buffer._currentDownloads.indexOf(next);Tone.Buffer._currentDownloads.splice(index,1);next.Buffer.set(buffer);if(next.Buffer._reversed){next.Buffer._reverse()}
next.Buffer.onload(next.Buffer);Tone.Buffer._onprogress();Tone.Buffer._next()});next.xhr.onprogress=function(event){next.progress=event.loaded/event.total;Tone.Buffer._onprogress()};next.xhr.onerror=function(e){Tone.Buffer.trigger('error',e)}}}else if(Tone.Buffer._currentDownloads.length===0){Tone.Buffer.trigger('load');Tone.Buffer._totalDownloads=0}};Tone.Buffer._onprogress=function(){var curretDownloadsProgress=0;var currentDLLen=Tone.Buffer._currentDownloads.length;var inprogress=0;if(currentDLLen>0){for(var i=0;i<currentDLLen;i++){var dl=Tone.Buffer._currentDownloads[i];curretDownloadsProgress+=dl.progress}
inprogress=curretDownloadsProgress}
var currentDownloadProgress=currentDLLen-inprogress;var completed=Tone.Buffer._totalDownloads-Tone.Buffer._queue.length-currentDownloadProgress;Tone.Buffer.trigger('progress',completed/Tone.Buffer._totalDownloads)};Tone.Buffer.load=function(url,callback){var request=new XMLHttpRequest();request.open('GET',url,!0);request.responseType='arraybuffer';request.onload=function(){Tone.context.decodeAudioData(request.response,function(buff){if(!buff){throw new Error('could not decode audio data:'+url)}
callback(buff)})};request.send();return request};Object.defineProperty(Tone.Buffer,'onload',{set:function(cb){console.warn('Tone.Buffer.onload is deprecated, use Tone.Buffer.on(\'load\', callback)');Tone.Buffer.on('load',cb)}});Object.defineProperty(Tone.Buffer,'onprogress',{set:function(cb){console.warn('Tone.Buffer.onprogress is deprecated, use Tone.Buffer.on(\'progress\', callback)');Tone.Buffer.on('progress',cb)}});Object.defineProperty(Tone.Buffer,'onerror',{set:function(cb){console.warn('Tone.Buffer.onerror is deprecated, use Tone.Buffer.on(\'error\', callback)');Tone.Buffer.on('error',cb)}});return Tone.Buffer});Module(function(Tone){var Buses={};Tone.prototype.send=function(channelName,amount){if(!Buses.hasOwnProperty(channelName)){Buses[channelName]=this.context.createGain()}
var sendKnob=this.context.createGain();sendKnob.gain.value=this.dbToGain(this.defaultArg(amount,1));this.output.chain(sendKnob,Buses[channelName]);return sendKnob};Tone.prototype.receive=function(channelName,input){if(!Buses.hasOwnProperty(channelName)){Buses[channelName]=this.context.createGain()}
if(this.isUndef(input)){input=this.input}
Buses[channelName].connect(input);return this};return Tone});Module(function(Tone){Tone.Delay=function(){var options=this.optionsObject(arguments,['delayTime','maxDelay'],Tone.Delay.defaults);this._delayNode=this.input=this.output=this.context.createDelay(this.toSeconds(options.maxDelay));this.delayTime=new Tone.Param({'param':this._delayNode.delayTime,'units':Tone.Type.Time,'value':options.delayTime});this._readOnly('delayTime')};Tone.extend(Tone.Delay);Tone.Delay.defaults={'maxDelay':1,'delayTime':0};Tone.Delay.prototype.dispose=function(){Tone.Param.prototype.dispose.call(this);this._delayNode.disconnect();this._delayNode=null;this._writable('delayTime');this.delayTime=null;return this};return Tone.Delay});Module(function(Tone){Tone.Master=function(){Tone.call(this);this._unmutedVolume=1;this._muted=!1;this._volume=this.output=new Tone.Volume();this.volume=this._volume.volume;this._readOnly('volume');this.input.chain(this.output,this.context.destination)};Tone.extend(Tone.Master);Tone.Master.defaults={'volume':0,'mute':!1};Object.defineProperty(Tone.Master.prototype,'mute',{get:function(){return this._muted},set:function(mute){if(!this._muted&&mute){this._unmutedVolume=this.volume.value;this.volume.value=-Infinity}else if(this._muted&&!mute){this.volume.value=this._unmutedVolume}
this._muted=mute}});Tone.Master.prototype.chain=function(){this.input.disconnect();this.input.chain.apply(this.input,arguments);arguments[arguments.length-1].connect(this.output)};Tone.Master.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable('volume');this._volume.dispose();this._volume=null;this.volume=null};Tone.prototype.toMaster=function(){this.connect(Tone.Master);return this};AudioNode.prototype.toMaster=function(){this.connect(Tone.Master);return this};var MasterConstructor=Tone.Master;Tone._initAudioContext(function(){if(!Tone.prototype.isUndef(Tone.Master)){Tone.Master=new MasterConstructor()}else{MasterConstructor.prototype.dispose.call(Tone.Master);MasterConstructor.call(Tone.Master)}});return Tone.Master});Module(function(Tone){Tone.Note=function(channel,time,value){this.value=value;this._channel=channel;this._timelineID=Tone.Transport.setTimeline(this._trigger.bind(this),time)};Tone.Note.prototype._trigger=function(time){channelCallbacks(this._channel,time,this.value)};Tone.Note.prototype.dispose=function(){Tone.Transport.clearTimeline(this._timelineID);this.value=null;return this};var NoteChannels={};function channelCallbacks(channel,time,value){if(NoteChannels.hasOwnProperty(channel)){var callbacks=NoteChannels[channel];for(var i=0,len=callbacks.length;i<len;i++){var callback=callbacks[i];if(Array.isArray(value)){callback.apply(window,[time].concat(value))}else{callback(time,value)}}}}
Tone.Note.route=function(channel,callback){if(NoteChannels.hasOwnProperty(channel)){NoteChannels[channel].push(callback)}else{NoteChannels[channel]=[callback]}};Tone.Note.unroute=function(channel,callback){if(NoteChannels.hasOwnProperty(channel)){var channelCallback=NoteChannels[channel];var index=channelCallback.indexOf(callback);if(index!==-1){NoteChannels[channel].splice(index,1)}}};Tone.Note.parseScore=function(score){var notes=[];for(var inst in score){var part=score[inst];if(inst==='tempo'){Tone.Transport.bpm.value=part}else if(inst==='timeSignature'){Tone.Transport.timeSignature=part[0]/(part[1]/4)}else if(Array.isArray(part)){for(var i=0;i<part.length;i++){var noteDescription=part[i];var note;if(Array.isArray(noteDescription)){var time=noteDescription[0];var value=noteDescription.slice(1);note=new Tone.Note(inst,time,value)}else if(typeof noteDescription==='object'){note=new Tone.Note(inst,noteDescription.time,noteDescription)}else{note=new Tone.Note(inst,noteDescription)}
notes.push(note)}}else{throw new TypeError('score parts must be Arrays')}}
return notes};return Tone.Note});Module(function(Tone){Tone.Event=function(){var options=this.optionsObject(arguments,['callback','value'],Tone.Event.defaults);this._loop=options.loop;this.callback=options.callback;this.value=options.value;this._loopStart=this.toTicks(options.loopStart);this._loopEnd=this.toTicks(options.loopEnd);this._state=new Tone.TimelineState(Tone.State.Stopped);this._playbackRate=1;this._startOffset=0;this.probability=options.probability;this.humanize=options.humanize;this.mute=options.mute;this.playbackRate=options.playbackRate};Tone.extend(Tone.Event);Tone.Event.defaults={'callback':Tone.noOp,'loop':!1,'loopEnd':'1m','loopStart':0,'playbackRate':1,'value':null,'probability':1,'mute':!1,'humanize':!1};Tone.Event.prototype._rescheduleEvents=function(after){after=this.defaultArg(after,-1);this._state.forEachFrom(after,function(event){var duration;if(event.state===Tone.State.Started){if(!this.isUndef(event.id)){Tone.Transport.clear(event.id)}
var startTick=event.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){duration=Infinity;if(this.isNumber(this._loop)){duration=(this._loop-1)*this._getLoopDuration()}
var nextEvent=this._state.getEventAfter(startTick);if(nextEvent!==null){duration=Math.min(duration,nextEvent.time-startTick)}
if(duration!==Infinity){this._state.setStateAtTime(Tone.State.Stopped,startTick+duration+1);duration+='i'}
event.id=Tone.Transport.scheduleRepeat(this._tick.bind(this),this._getLoopDuration().toString()+'i',startTick+'i',duration)}else{event.id=Tone.Transport.schedule(this._tick.bind(this),startTick+'i')}}}.bind(this));return this};Object.defineProperty(Tone.Event.prototype,'state',{get:function(){return this._state.getStateAtTime(Tone.Transport.ticks)}});Object.defineProperty(Tone.Event.prototype,'startOffset',{get:function(){return this._startOffset},set:function(offset){this._startOffset=offset}});Tone.Event.prototype.start=function(time){time=this.toTicks(time);if(this._state.getStateAtTime(time)===Tone.State.Stopped){this._state.addEvent({'state':Tone.State.Started,'time':time,'id':undefined});this._rescheduleEvents(time)}
return this};Tone.Event.prototype.stop=function(time){this.cancel(time);time=this.toTicks(time);if(this._state.getStateAtTime(time)===Tone.State.Started){this._state.setStateAtTime(Tone.State.Stopped,time);var previousEvent=this._state.getEventBefore(time);var reschedulTime=time;if(previousEvent!==null){reschedulTime=previousEvent.time}
this._rescheduleEvents(reschedulTime)}
return this};Tone.Event.prototype.cancel=function(time){time=this.defaultArg(time,-Infinity);time=this.toTicks(time);this._state.forEachFrom(time,function(event){Tone.Transport.clear(event.id)});this._state.cancel(time);return this};Tone.Event.prototype._tick=function(time){if(!this.mute&&this._state.getStateAtTime(Tone.Transport.ticks)===Tone.State.Started){if(this.probability<1&&Math.random()>this.probability){return}
if(this.humanize){var variation=0.02;if(!this.isBoolean(this.humanize)){variation=this.toSeconds(this.humanize)}
time+=(Math.random()*2-1)*variation}
this.callback(time,this.value)}};Tone.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)};Object.defineProperty(Tone.Event.prototype,'loop',{get:function(){return this._loop},set:function(loop){this._loop=loop;this._rescheduleEvents()}});Object.defineProperty(Tone.Event.prototype,'playbackRate',{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate;this._rescheduleEvents()}});Object.defineProperty(Tone.Event.prototype,'loopEnd',{get:function(){return this.toNotation(this._loopEnd+'i')},set:function(loopEnd){this._loopEnd=this.toTicks(loopEnd);if(this._loop){this._rescheduleEvents()}}});Object.defineProperty(Tone.Event.prototype,'loopStart',{get:function(){return this.toNotation(this._loopStart+'i')},set:function(loopStart){this._loopStart=this.toTicks(loopStart);if(this._loop){this._rescheduleEvents()}}});Object.defineProperty(Tone.Event.prototype,'progress',{get:function(){if(this._loop){var ticks=Tone.Transport.ticks;var lastEvent=this._state.getEvent(ticks);if(lastEvent!==null&&lastEvent.state===Tone.State.Started){var loopDuration=this._getLoopDuration();var progress=(ticks-lastEvent.time)%loopDuration;return progress/loopDuration}else{return 0}}else{return 0}}});Tone.Event.prototype.dispose=function(){this.cancel();this._state.dispose();this._state=null;this.callback=null;this.value=null};return Tone.Event});Module(function(Tone){Tone.Loop=function(){var options=this.optionsObject(arguments,['callback','interval'],Tone.Loop.defaults);this._event=new Tone.Event({'callback':this._tick.bind(this),'loop':!0,'loopEnd':options.interval,'playbackRate':options.playbackRate,'probability':options.probability});this.callback=options.callback;this.iterations=options.iterations};Tone.extend(Tone.Loop);Tone.Loop.defaults={'interval':'4n','callback':Tone.noOp,'playbackRate':1,'iterations':Infinity,'probability':!0,'mute':!1};Tone.Loop.prototype.start=function(time){this._event.start(time);return this};Tone.Loop.prototype.stop=function(time){this._event.stop(time);return this};Tone.Loop.prototype.cancel=function(time){this._event.cancel(time);return this};Tone.Loop.prototype._tick=function(time){this.callback(time)};Object.defineProperty(Tone.Loop.prototype,'state',{get:function(){return this._event.state}});Object.defineProperty(Tone.Loop.prototype,'progress',{get:function(){return this._event.progress}});Object.defineProperty(Tone.Loop.prototype,'interval',{get:function(){return this._event.loopEnd},set:function(interval){this._event.loopEnd=interval}});Object.defineProperty(Tone.Loop.prototype,'playbackRate',{get:function(){return this._event.playbackRate},set:function(rate){this._event.playbackRate=rate}});Object.defineProperty(Tone.Loop.prototype,'humanize',{get:function(){return this._event.humanize},set:function(variation){this._event.humanize=variation}});Object.defineProperty(Tone.Loop.prototype,'probability',{get:function(){return this._event.probability},set:function(prob){this._event.probability=prob}});Object.defineProperty(Tone.Loop.prototype,'mute',{get:function(){return this._event.mute},set:function(mute){this._event.mute=mute}});Object.defineProperty(Tone.Loop.prototype,'iterations',{get:function(){if(this._event.loop===!0){return Infinity}else{return this._event.loop}
return this._pattern.index},set:function(iters){if(iters===Infinity){this._event.loop=!0}else{this._event.loop=iters}}});Tone.Loop.prototype.dispose=function(){this._event.dispose();this._event=null;this.callback=null};return Tone.Loop});Module(function(Tone){Tone.Part=function(){var options=this.optionsObject(arguments,['callback','events'],Tone.Part.defaults);this._loop=options.loop;this._loopStart=this.toTicks(options.loopStart);this._loopEnd=this.toTicks(options.loopEnd);this._playbackRate=options.playbackRate;this._probability=options.probability;this._humanize=options.humanize;this._startOffset=0;this._state=new Tone.TimelineState(Tone.State.Stopped);this._events=[];this.callback=options.callback;this.mute=options.mute;var events=this.defaultArg(options.events,[]);if(!this.isUndef(options.events)){for(var i=0;i<events.length;i++){if(Array.isArray(events[i])){this.add(events[i][0],events[i][1])}else{this.add(events[i])}}}};Tone.extend(Tone.Part,Tone.Event);Tone.Part.defaults={'callback':Tone.noOp,'loop':!1,'loopEnd':'1m','loopStart':0,'playbackRate':1,'probability':1,'humanize':!1,'mute':!1};Tone.Part.prototype.start=function(time,offset){var ticks=this.toTicks(time);if(this._state.getStateAtTime(ticks)!==Tone.State.Started){offset=this.defaultArg(offset,0);offset=this.toTicks(offset);this._state.addEvent({'state':Tone.State.Started,'time':ticks,'offset':offset});this._forEach(function(event){this._startNote(event,ticks,offset)})}
return this};Tone.Part.prototype._startNote=function(event,ticks,offset){ticks-=offset;if(this._loop){if(event.startOffset>=this._loopStart&&event.startOffset<this._loopEnd){if(event.startOffset<offset){ticks+=this._getLoopDuration()}
event.start(ticks+'i')}}else{if(event.startOffset>=offset){event.start(ticks+'i')}}};Object.defineProperty(Tone.Part.prototype,'startOffset',{get:function(){return this._startOffset},set:function(offset){this._startOffset=offset;this._forEach(function(event){event.startOffset+=this._startOffset})}});Tone.Part.prototype.stop=function(time){var ticks=this.toTicks(time);if(this._state.getStateAtTime(ticks)===Tone.State.Started){this._state.setStateAtTime(Tone.State.Stopped,ticks);this._forEach(function(event){event.stop(time)})}
return this};Tone.Part.prototype.at=function(time,value){time=this.toTicks(time);var tickTime=this.ticksToSeconds(1);for(var i=0;i<this._events.length;i++){var event=this._events[i];if(Math.abs(time-event.startOffset)<tickTime){if(!this.isUndef(value)){event.value=value}
return event}}
if(!this.isUndef(value)){this.add(time+'i',value);return this._events[this._events.length-1]}else{return null}};Tone.Part.prototype.add=function(time,value){if(this.isObject(time)&&time.hasOwnProperty('time')){value=time;time=value.time;delete value.time}
time=this.toTicks(time);var event;if(value instanceof Tone.Event){event=value;event.callback=this._tick.bind(this)}else{event=new Tone.Event({'callback':this._tick.bind(this),'value':value})}
event.startOffset=time;event.set({'loopEnd':this.loopEnd,'loopStart':this.loopStart,'loop':this.loop,'humanize':this.humanize,'playbackRate':this.playbackRate,'probability':this.probability});this._events.push(event);this._restartEvent(event);return this};Tone.Part.prototype._restartEvent=function(event){var stateEvent=this._state.getEvent(this.now());if(stateEvent&&stateEvent.state===Tone.State.Started){this._startNote(event,stateEvent.time,stateEvent.offset)}};Tone.Part.prototype.remove=function(time,value){if(this.isObject(time)&&time.hasOwnProperty('time')){value=time;time=value.time}
time=this.toTicks(time);for(var i=this._events.length-1;i>=0;i--){var event=this._events[i];if(event instanceof Tone.Part){event.remove(time,value)}else{if(event.startOffset===time){if(this.isUndef(value)||!this.isUndef(value)&&event.value===value){this._events.splice(i,1);event.dispose()}}}}
return this};Tone.Part.prototype.removeAll=function(){this._forEach(function(event){event.dispose()});this._events=[];return this};Tone.Part.prototype.cancel=function(after){this._forEach(function(event){event.cancel(after)});this._state.cancel(after);return this};Tone.Part.prototype._forEach=function(callback,ctx){ctx=this.defaultArg(ctx,this);for(var i=this._events.length-1;i>=0;i--){var e=this._events[i];if(e instanceof Tone.Part){e._forEach(callback,ctx)}else{callback.call(ctx,e)}}
return this};Tone.Part.prototype._setAll=function(attr,value){this._forEach(function(event){event[attr]=value})};Tone.Part.prototype._tick=function(time,value){if(!this.mute){this.callback(time,value)}};Tone.Part.prototype._testLoopBoundries=function(event){if(event.startOffset<this._loopStart||event.startOffset>=this._loopEnd){event.cancel()}else{if(event.state===Tone.State.Stopped){this._restartEvent(event)}}};Object.defineProperty(Tone.Part.prototype,'probability',{get:function(){return this._probability},set:function(prob){this._probability=prob;this._setAll('probability',prob)}});Object.defineProperty(Tone.Part.prototype,'humanize',{get:function(){return this._humanize},set:function(variation){this._humanize=variation;this._setAll('humanize',variation)}});Object.defineProperty(Tone.Part.prototype,'loop',{get:function(){return this._loop},set:function(loop){this._loop=loop;this._forEach(function(event){event._loopStart=this._loopStart;event._loopEnd=this._loopEnd;event.loop=loop;this._testLoopBoundries(event)})}});Object.defineProperty(Tone.Part.prototype,'loopEnd',{get:function(){return this.toNotation(this._loopEnd+'i')},set:function(loopEnd){this._loopEnd=this.toTicks(loopEnd);if(this._loop){this._forEach(function(event){event.loopEnd=this.loopEnd;this._testLoopBoundries(event)})}}});Object.defineProperty(Tone.Part.prototype,'loopStart',{get:function(){return this.toNotation(this._loopStart+'i')},set:function(loopStart){this._loopStart=this.toTicks(loopStart);if(this._loop){this._forEach(function(event){event.loopStart=this.loopStart;this._testLoopBoundries(event)})}}});Object.defineProperty(Tone.Part.prototype,'playbackRate',{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate;this._setAll('playbackRate',rate)}});Object.defineProperty(Tone.Part.prototype,'length',{get:function(){return this._events.length}});Tone.Part.prototype.dispose=function(){this.removeAll();this._state.dispose();this._state=null;this.callback=null;this._events=null;return this};return Tone.Part});Module(function(Tone){Tone.Pattern=function(){var options=this.optionsObject(arguments,['callback','events','pattern'],Tone.Pattern.defaults);Tone.Loop.call(this,options);this._pattern=new Tone.CtrlPattern({'values':options.events,'type':options.pattern,'index':options.index})};Tone.extend(Tone.Pattern,Tone.Loop);Tone.Pattern.defaults={'pattern':Tone.CtrlPattern.Type.Up,'events':[]};Tone.Pattern.prototype._tick=function(time){this.callback(time,this._pattern.value);this._pattern.next()};Object.defineProperty(Tone.Pattern.prototype,'index',{get:function(){return this._pattern.index},set:function(i){this._pattern.index=i}});Object.defineProperty(Tone.Pattern.prototype,'events',{get:function(){return this._pattern.values},set:function(vals){this._pattern.values=vals}});Object.defineProperty(Tone.Pattern.prototype,'value',{get:function(){return this._pattern.value}});Object.defineProperty(Tone.Pattern.prototype,'pattern',{get:function(){return this._pattern.type},set:function(pattern){this._pattern.type=pattern}});Tone.Pattern.prototype.dispose=function(){Tone.Loop.prototype.dispose.call(this);this._pattern.dispose();this._pattern=null};return Tone.Pattern});Module(function(Tone){Tone.Sequence=function(){var options=this.optionsObject(arguments,['callback','events','subdivision'],Tone.Sequence.defaults);var events=options.events;delete options.events;Tone.Part.call(this,options);this._subdivision=this.toTicks(options.subdivision);if(this.isUndef(options.loopEnd)&&!this.isUndef(events)){this._loopEnd=events.length*this._subdivision}
this._loop=!0;if(!this.isUndef(events)){for(var i=0;i<events.length;i++){this.add(i,events[i])}}};Tone.extend(Tone.Sequence,Tone.Part);Tone.Sequence.defaults={'subdivision':'4n'};Object.defineProperty(Tone.Sequence.prototype,'subdivision',{get:function(){return this.toNotation(this._subdivision+'i')}});Tone.Sequence.prototype.at=function(index,value){if(this.isArray(value)){this.remove(index)}
return Tone.Part.prototype.at.call(this,this._indexTime(index),value)};Tone.Sequence.prototype.add=function(index,value){if(value===null){return this}
if(this.isArray(value)){var subSubdivision=Math.round(this._subdivision/value.length)+'i';value=new Tone.Sequence(this._tick.bind(this),value,subSubdivision)}
Tone.Part.prototype.add.call(this,this._indexTime(index),value);return this};Tone.Sequence.prototype.remove=function(index,value){Tone.Part.prototype.remove.call(this,this._indexTime(index),value);return this};Tone.Sequence.prototype._indexTime=function(index){if(this.isTicks(index)){return index}else{return index*this._subdivision+this.startOffset+'i'}};Tone.Sequence.prototype.dispose=function(){Tone.Part.prototype.dispose.call(this);return this};return Tone.Sequence});Module(function(Tone){Tone.Effect=function(){Tone.call(this);var options=this.optionsObject(arguments,['wet'],Tone.Effect.defaults);this._dryWet=new Tone.CrossFade(options.wet);this.wet=this._dryWet.fade;this.effectSend=this.context.createGain();this.effectReturn=this.context.createGain();this.input.connect(this._dryWet.a);this.input.connect(this.effectSend);this.effectReturn.connect(this._dryWet.b);this._dryWet.connect(this.output);this._readOnly(['wet'])};Tone.extend(Tone.Effect);Tone.Effect.defaults={'wet':1};Tone.Effect.prototype.connectEffect=function(effect){this.effectSend.chain(effect,this.effectReturn);return this};Tone.Effect.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._dryWet.dispose();this._dryWet=null;this.effectSend.disconnect();this.effectSend=null;this.effectReturn.disconnect();this.effectReturn=null;this._writable(['wet']);this.wet=null;return this};return Tone.Effect});Module(function(Tone){Tone.AutoFilter=function(){var options=this.optionsObject(arguments,['frequency','baseFrequency','octaves'],Tone.AutoFilter.defaults);Tone.Effect.call(this,options);this._lfo=new Tone.LFO({'frequency':options.frequency,'amplitude':options.depth});this.depth=this._lfo.amplitude;this.frequency=this._lfo.frequency;this.filter=new Tone.Filter(options.filter);this._octaves=0;this.connectEffect(this.filter);this._lfo.connect(this.filter.frequency);this.type=options.type;this._readOnly(['frequency','depth']);this.octaves=options.octaves;this.baseFrequency=options.baseFrequency};Tone.extend(Tone.AutoFilter,Tone.Effect);Tone.AutoFilter.defaults={'frequency':1,'type':'sine','depth':1,'baseFrequency':200,'octaves':2.6,'filter':{'type':'lowpass','rolloff':-12,'Q':1}};Tone.AutoFilter.prototype.start=function(time){this._lfo.start(time);return this};Tone.AutoFilter.prototype.stop=function(time){this._lfo.stop(time);return this};Tone.AutoFilter.prototype.sync=function(delay){this._lfo.sync(delay);return this};Tone.AutoFilter.prototype.unsync=function(){this._lfo.unsync();return this};Object.defineProperty(Tone.AutoFilter.prototype,'type',{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}});Object.defineProperty(Tone.AutoFilter.prototype,'baseFrequency',{get:function(){return this._lfo.min},set:function(freq){this._lfo.min=this.toFrequency(freq)}});Object.defineProperty(Tone.AutoFilter.prototype,'octaves',{get:function(){return this._octaves},set:function(oct){this._octaves=oct;this._lfo.max=this.baseFrequency*Math.pow(2,oct)}});Tone.AutoFilter.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._lfo.dispose();this._lfo=null;this.filter.dispose();this.filter=null;this._writable(['frequency','depth']);this.frequency=null;this.depth=null;return this};return Tone.AutoFilter});Module(function(Tone){Tone.AutoPanner=function(){var options=this.optionsObject(arguments,['frequency'],Tone.AutoPanner.defaults);Tone.Effect.call(this,options);this._lfo=new Tone.LFO({'frequency':options.frequency,'amplitude':options.depth,'min':0,'max':1});this.depth=this._lfo.amplitude;this._panner=new Tone.Panner();this.frequency=this._lfo.frequency;this.connectEffect(this._panner);this._lfo.connect(this._panner.pan);this.type=options.type;this._readOnly(['depth','frequency'])};Tone.extend(Tone.AutoPanner,Tone.Effect);Tone.AutoPanner.defaults={'frequency':1,'type':'sine','depth':1};Tone.AutoPanner.prototype.start=function(time){this._lfo.start(time);return this};Tone.AutoPanner.prototype.stop=function(time){this._lfo.stop(time);return this};Tone.AutoPanner.prototype.sync=function(delay){this._lfo.sync(delay);return this};Tone.AutoPanner.prototype.unsync=function(){this._lfo.unsync();return this};Object.defineProperty(Tone.AutoPanner.prototype,'type',{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}});Tone.AutoPanner.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._lfo.dispose();this._lfo=null;this._panner.dispose();this._panner=null;this._writable(['depth','frequency']);this.frequency=null;this.depth=null;return this};return Tone.AutoPanner});Module(function(Tone){Tone.AutoWah=function(){var options=this.optionsObject(arguments,['baseFrequency','octaves','sensitivity'],Tone.AutoWah.defaults);Tone.Effect.call(this,options);this.follower=new Tone.Follower(options.follower);this._sweepRange=new Tone.ScaleExp(0,1,0.5);this._baseFrequency=options.baseFrequency;this._octaves=options.octaves;this._inputBoost=this.context.createGain();this._bandpass=new Tone.Filter({'rolloff':-48,'frequency':0,'Q':options.Q});this._peaking=new Tone.Filter(0,'peaking');this._peaking.gain.value=options.gain;this.gain=this._peaking.gain;this.Q=this._bandpass.Q;this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange);this._sweepRange.connect(this._bandpass.frequency);this._sweepRange.connect(this._peaking.frequency);this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn);this._setSweepRange();this.sensitivity=options.sensitivity;this._readOnly(['gain','Q'])};Tone.extend(Tone.AutoWah,Tone.Effect);Tone.AutoWah.defaults={'baseFrequency':100,'octaves':6,'sensitivity':0,'Q':2,'gain':2,'follower':{'attack':0.3,'release':0.5}};Object.defineProperty(Tone.AutoWah.prototype,'octaves',{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves;this._setSweepRange()}});Object.defineProperty(Tone.AutoWah.prototype,'baseFrequency',{get:function(){return this._baseFrequency},set:function(baseFreq){this._baseFrequency=baseFreq;this._setSweepRange()}});Object.defineProperty(Tone.AutoWah.prototype,'sensitivity',{get:function(){return this.gainToDb(1/this._inputBoost.gain.value)},set:function(sensitivy){this._inputBoost.gain.value=1/this.dbToGain(sensitivy)}});Tone.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency;this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)};Tone.AutoWah.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this.follower.dispose();this.follower=null;this._sweepRange.dispose();this._sweepRange=null;this._bandpass.dispose();this._bandpass=null;this._peaking.dispose();this._peaking=null;this._inputBoost.disconnect();this._inputBoost=null;this._writable(['gain','Q']);this.gain=null;this.Q=null;return this};return Tone.AutoWah});Module(function(Tone){Tone.BitCrusher=function(){var options=this.optionsObject(arguments,['bits'],Tone.BitCrusher.defaults);Tone.Effect.call(this,options);var invStepSize=1/Math.pow(2,options.bits-1);this._subtract=new Tone.Subtract();this._modulo=new Tone.Modulo(invStepSize);this._bits=options.bits;this.effectSend.fan(this._subtract,this._modulo);this._modulo.connect(this._subtract,0,1);this._subtract.connect(this.effectReturn)};Tone.extend(Tone.BitCrusher,Tone.Effect);Tone.BitCrusher.defaults={'bits':4};Object.defineProperty(Tone.BitCrusher.prototype,'bits',{get:function(){return this._bits},set:function(bits){this._bits=bits;var invStepSize=1/Math.pow(2,bits-1);this._modulo.value=invStepSize}});Tone.BitCrusher.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._subtract.dispose();this._subtract=null;this._modulo.dispose();this._modulo=null;return this};return Tone.BitCrusher});Module(function(Tone){Tone.Chebyshev=function(){var options=this.optionsObject(arguments,['order'],Tone.Chebyshev.defaults);Tone.Effect.call(this,options);this._shaper=new Tone.WaveShaper(4096);this._order=options.order;this.connectEffect(this._shaper);this.order=options.order;this.oversample=options.oversample};Tone.extend(Tone.Chebyshev,Tone.Effect);Tone.Chebyshev.defaults={'order':1,'oversample':'none'};Tone.Chebyshev.prototype._getCoefficient=function(x,degree,memo){if(memo.hasOwnProperty(degree)){return memo[degree]}else if(degree===0){memo[degree]=0}else if(degree===1){memo[degree]=x}else{memo[degree]=2*x*this._getCoefficient(x,degree-1,memo)-this._getCoefficient(x,degree-2,memo)}
return memo[degree]};Object.defineProperty(Tone.Chebyshev.prototype,'order',{get:function(){return this._order},set:function(order){this._order=order;var curve=new Array(4096);var len=curve.length;for(var i=0;i<len;++i){var x=i*2/len-1;if(x===0){curve[i]=0}else{curve[i]=this._getCoefficient(x,order,{})}}
this._shaper.curve=curve}});Object.defineProperty(Tone.Chebyshev.prototype,'oversample',{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}});Tone.Chebyshev.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;return this};return Tone.Chebyshev});Module(function(Tone){Tone.StereoEffect=function(){Tone.call(this);var options=this.optionsObject(arguments,['wet'],Tone.Effect.defaults);this._dryWet=new Tone.CrossFade(options.wet);this.wet=this._dryWet.fade;this._split=new Tone.Split();this.effectSendL=this._split.left;this.effectSendR=this._split.right;this._merge=new Tone.Merge();this.effectReturnL=this._merge.left;this.effectReturnR=this._merge.right;this.input.connect(this._split);this.input.connect(this._dryWet,0,0);this._merge.connect(this._dryWet,0,1);this._dryWet.connect(this.output);this._readOnly(['wet'])};Tone.extend(Tone.StereoEffect,Tone.Effect);Tone.StereoEffect.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._dryWet.dispose();this._dryWet=null;this._split.dispose();this._split=null;this._merge.dispose();this._merge=null;this.effectSendL=null;this.effectSendR=null;this.effectReturnL=null;this.effectReturnR=null;this._writable(['wet']);this.wet=null;return this};return Tone.StereoEffect});Module(function(Tone){Tone.FeedbackEffect=function(){var options=this.optionsObject(arguments,['feedback']);options=this.defaultArg(options,Tone.FeedbackEffect.defaults);Tone.Effect.call(this,options);this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange);this._feedbackGain=this.context.createGain();this.effectReturn.chain(this._feedbackGain,this.effectSend);this.feedback.connect(this._feedbackGain.gain);this._readOnly(['feedback'])};Tone.extend(Tone.FeedbackEffect,Tone.Effect);Tone.FeedbackEffect.defaults={'feedback':0.125};Tone.FeedbackEffect.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._writable(['feedback']);this.feedback.dispose();this.feedback=null;this._feedbackGain.disconnect();this._feedbackGain=null;return this};return Tone.FeedbackEffect});Module(function(Tone){Tone.StereoXFeedbackEffect=function(){var options=this.optionsObject(arguments,['feedback'],Tone.FeedbackEffect.defaults);Tone.StereoEffect.call(this,options);this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange);this._feedbackLR=this.context.createGain();this._feedbackRL=this.context.createGain();this.effectReturnL.chain(this._feedbackLR,this.effectSendR);this.effectReturnR.chain(this._feedbackRL,this.effectSendL);this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain);this._readOnly(['feedback'])};Tone.extend(Tone.StereoXFeedbackEffect,Tone.FeedbackEffect);Tone.StereoXFeedbackEffect.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);this._writable(['feedback']);this.feedback.dispose();this.feedback=null;this._feedbackLR.disconnect();this._feedbackLR=null;this._feedbackRL.disconnect();this._feedbackRL=null;return this};return Tone.StereoXFeedbackEffect});Module(function(Tone){Tone.Chorus=function(){var options=this.optionsObject(arguments,['frequency','delayTime','depth'],Tone.Chorus.defaults);Tone.StereoXFeedbackEffect.call(this,options);this._depth=options.depth;this._delayTime=options.delayTime/1000;this._lfoL=new Tone.LFO({'frequency':options.frequency,'min':0,'max':1});this._lfoR=new Tone.LFO({'frequency':options.frequency,'min':0,'max':1,'phase':180});this._delayNodeL=this.context.createDelay();this._delayNodeR=this.context.createDelay();this.frequency=this._lfoL.frequency;this.effectSendL.chain(this._delayNodeL,this.effectReturnL);this.effectSendR.chain(this._delayNodeR,this.effectReturnR);this.effectSendL.connect(this.effectReturnL);this.effectSendR.connect(this.effectReturnR);this._lfoL.connect(this._delayNodeL.delayTime);this._lfoR.connect(this._delayNodeR.delayTime);this._lfoL.start();this._lfoR.start();this._lfoL.frequency.connect(this._lfoR.frequency);this.depth=this._depth;this.frequency.value=options.frequency;this.type=options.type;this._readOnly(['frequency']);this.spread=options.spread};Tone.extend(Tone.Chorus,Tone.StereoXFeedbackEffect);Tone.Chorus.defaults={'frequency':1.5,'delayTime':3.5,'depth':0.7,'feedback':0.1,'type':'sine','spread':180};Object.defineProperty(Tone.Chorus.prototype,'depth',{get:function(){return this._depth},set:function(depth){this._depth=depth;var deviation=this._delayTime*depth;this._lfoL.min=Math.max(this._delayTime-deviation,0);this._lfoL.max=this._delayTime+deviation;this._lfoR.min=Math.max(this._delayTime-deviation,0);this._lfoR.max=this._delayTime+deviation}});Object.defineProperty(Tone.Chorus.prototype,'delayTime',{get:function(){return this._delayTime*1000},set:function(delayTime){this._delayTime=delayTime/1000;this.depth=this._depth}});Object.defineProperty(Tone.Chorus.prototype,'type',{get:function(){return this._lfoL.type},set:function(type){this._lfoL.type=type;this._lfoR.type=type}});Object.defineProperty(Tone.Chorus.prototype,'spread',{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(spread){this._lfoL.phase=90-spread/2;this._lfoR.phase=spread/2+90}});Tone.Chorus.prototype.dispose=function(){Tone.StereoXFeedbackEffect.prototype.dispose.call(this);this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;this._delayNodeL.disconnect();this._delayNodeL=null;this._delayNodeR.disconnect();this._delayNodeR=null;this._writable('frequency');this.frequency=null;return this};return Tone.Chorus});Module(function(Tone){Tone.Convolver=function(){var options=this.optionsObject(arguments,['url'],Tone.Convolver.defaults);Tone.Effect.call(this,options);this._convolver=this.context.createConvolver();this._buffer=new Tone.Buffer(options.url,function(buffer){this.buffer=buffer;options.onload()}.bind(this));this.connectEffect(this._convolver)};Tone.extend(Tone.Convolver,Tone.Effect);Tone.Convolver.defaults={'url':'','onload':Tone.noOp};Object.defineProperty(Tone.Convolver.prototype,'buffer',{get:function(){return this._buffer.get()},set:function(buffer){this._buffer.set(buffer);this._convolver.buffer=this._buffer.get()}});Tone.Convolver.prototype.load=function(url,callback){this._buffer.load(url,function(buff){this.buffer=buff;if(callback){callback()}}.bind(this));return this};Tone.Convolver.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._convolver.disconnect();this._convolver=null;this._buffer.dispose();this._buffer=null;return this};return Tone.Convolver});Module(function(Tone){Tone.Distortion=function(){var options=this.optionsObject(arguments,['distortion'],Tone.Distortion.defaults);Tone.Effect.call(this,options);this._shaper=new Tone.WaveShaper(4096);this._distortion=options.distortion;this.connectEffect(this._shaper);this.distortion=options.distortion;this.oversample=options.oversample};Tone.extend(Tone.Distortion,Tone.Effect);Tone.Distortion.defaults={'distortion':0.4,'oversample':'none'};Object.defineProperty(Tone.Distortion.prototype,'distortion',{get:function(){return this._distortion},set:function(amount){this._distortion=amount;var k=amount*100;var deg=Math.PI/180;this._shaper.setMap(function(x){if(Math.abs(x)<0.001){return 0}else{return(3+k)*x*20*deg/(Math.PI+k*Math.abs(x))}})}});Object.defineProperty(Tone.Distortion.prototype,'oversample',{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}});Tone.Distortion.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;return this};return Tone.Distortion});Module(function(Tone){Tone.FeedbackDelay=function(){var options=this.optionsObject(arguments,['delayTime','feedback'],Tone.FeedbackDelay.defaults);Tone.FeedbackEffect.call(this,options);this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time);this._delayNode=this.context.createDelay(4);this.connectEffect(this._delayNode);this.delayTime.connect(this._delayNode.delayTime);this._readOnly(['delayTime'])};Tone.extend(Tone.FeedbackDelay,Tone.FeedbackEffect);Tone.FeedbackDelay.defaults={'delayTime':0.25};Tone.FeedbackDelay.prototype.dispose=function(){Tone.FeedbackEffect.prototype.dispose.call(this);this.delayTime.dispose();this._delayNode.disconnect();this._delayNode=null;this._writable(['delayTime']);this.delayTime=null;return this};return Tone.FeedbackDelay});Module(function(Tone){var combFilterTunings=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100];var allpassFilterFrequencies=[225,556,441,341];Tone.Freeverb=function(){var options=this.optionsObject(arguments,['roomSize','dampening'],Tone.Freeverb.defaults);Tone.StereoEffect.call(this,options);this.roomSize=new Tone.Signal(options.roomSize,Tone.Type.NormalRange);this.dampening=new Tone.Signal(options.dampening,Tone.Type.Frequency);this._dampeningScale=new Tone.ScaleExp(100,8000,0.5);this._combFilters=[];this._allpassFiltersL=[];this._allpassFiltersR=[];for(var l=0;l<allpassFilterFrequencies.length;l++){var allpassL=this.context.createBiquadFilter();allpassL.type='allpass';allpassL.frequency.value=allpassFilterFrequencies[l];this._allpassFiltersL.push(allpassL)}
for(var r=0;r<allpassFilterFrequencies.length;r++){var allpassR=this.context.createBiquadFilter();allpassR.type='allpass';allpassR.frequency.value=allpassFilterFrequencies[r];this._allpassFiltersR.push(allpassR)}
for(var c=0;c<combFilterTunings.length;c++){var lfpf=new Tone.LowpassCombFilter(combFilterTunings[c]);if(c<combFilterTunings.length/2){this.effectSendL.chain(lfpf,this._allpassFiltersL[0])}else{this.effectSendR.chain(lfpf,this._allpassFiltersR[0])}
this.roomSize.connect(lfpf.resonance);this._dampeningScale.connect(lfpf.dampening);this._combFilters.push(lfpf)}
this.connectSeries.apply(this,this._allpassFiltersL);this.connectSeries.apply(this,this._allpassFiltersR);this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL);this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR);this.dampening.connect(this._dampeningScale);this._readOnly(['roomSize','dampening'])};Tone.extend(Tone.Freeverb,Tone.StereoEffect);Tone.Freeverb.defaults={'roomSize':0.7,'dampening':0.5};Tone.Freeverb.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);for(var al=0;al<this._allpassFiltersL.length;al++){this._allpassFiltersL[al].disconnect();this._allpassFiltersL[al]=null}
this._allpassFiltersL=null;for(var ar=0;ar<this._allpassFiltersR.length;ar++){this._allpassFiltersR[ar].disconnect();this._allpassFiltersR[ar]=null}
this._allpassFiltersR=null;for(var cf=0;cf<this._combFilters.length;cf++){this._combFilters[cf].dispose();this._combFilters[cf]=null}
this._combFilters=null;this._writable(['roomSize','dampening']);this.roomSize.dispose();this.roomSize=null;this.dampening.dispose();this.dampening=null;return this};return Tone.Freeverb});Module(function(Tone){var combFilterDelayTimes=[1687/25000,1601/25000,2053/25000,2251/25000];var combFilterResonances=[0.773,0.802,0.753,0.733];var allpassFilterFreqs=[347,113,37];Tone.JCReverb=function(){var options=this.optionsObject(arguments,['roomSize'],Tone.JCReverb.defaults);Tone.StereoEffect.call(this,options);this.roomSize=new Tone.Signal(options.roomSize,Tone.Type.NormalRange);this._scaleRoomSize=new Tone.Scale(-0.733,0.197);this._allpassFilters=[];this._feedbackCombFilters=[];for(var af=0;af<allpassFilterFreqs.length;af++){var allpass=this.context.createBiquadFilter();allpass.type='allpass';allpass.frequency.value=allpassFilterFreqs[af];this._allpassFilters.push(allpass)}
for(var cf=0;cf<combFilterDelayTimes.length;cf++){var fbcf=new Tone.FeedbackCombFilter(combFilterDelayTimes[cf],0.1);this._scaleRoomSize.connect(fbcf.resonance);fbcf.resonance.value=combFilterResonances[cf];this._allpassFilters[this._allpassFilters.length-1].connect(fbcf);if(cf<combFilterDelayTimes.length/2){fbcf.connect(this.effectReturnL)}else{fbcf.connect(this.effectReturnR)}
this._feedbackCombFilters.push(fbcf)}
this.roomSize.connect(this._scaleRoomSize);this.connectSeries.apply(this,this._allpassFilters);this.effectSendL.connect(this._allpassFilters[0]);this.effectSendR.connect(this._allpassFilters[0]);this._readOnly(['roomSize'])};Tone.extend(Tone.JCReverb,Tone.StereoEffect);Tone.JCReverb.defaults={'roomSize':0.5};Tone.JCReverb.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);for(var apf=0;apf<this._allpassFilters.length;apf++){this._allpassFilters[apf].disconnect();this._allpassFilters[apf]=null}
this._allpassFilters=null;for(var fbcf=0;fbcf<this._feedbackCombFilters.length;fbcf++){this._feedbackCombFilters[fbcf].dispose();this._feedbackCombFilters[fbcf]=null}
this._feedbackCombFilters=null;this._writable(['roomSize']);this.roomSize.dispose();this.roomSize=null;this._scaleRoomSize.dispose();this._scaleRoomSize=null;return this};return Tone.JCReverb});Module(function(Tone){Tone.MidSideEffect=function(){Tone.Effect.apply(this,arguments);this._midSideSplit=new Tone.MidSideSplit();this._midSideMerge=new Tone.MidSideMerge();this.midSend=this._midSideSplit.mid;this.sideSend=this._midSideSplit.side;this.midReturn=this._midSideMerge.mid;this.sideReturn=this._midSideMerge.side;this.effectSend.connect(this._midSideSplit);this._midSideMerge.connect(this.effectReturn)};Tone.extend(Tone.MidSideEffect,Tone.Effect);Tone.MidSideEffect.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._midSideSplit.dispose();this._midSideSplit=null;this._midSideMerge.dispose();this._midSideMerge=null;this.midSend=null;this.sideSend=null;this.midReturn=null;this.sideReturn=null;return this};return Tone.MidSideEffect});Module(function(Tone){Tone.Phaser=function(){var options=this.optionsObject(arguments,['frequency','octaves','baseFrequency'],Tone.Phaser.defaults);Tone.StereoEffect.call(this,options);this._lfoL=new Tone.LFO(options.frequency,0,1);this._lfoR=new Tone.LFO(options.frequency,0,1);this._lfoR.phase=180;this._baseFrequency=options.baseFrequency;this._octaves=options.octaves;this.Q=new Tone.Signal(options.Q,Tone.Type.Positive);this._filtersL=this._makeFilters(options.stages,this._lfoL,this.Q);this._filtersR=this._makeFilters(options.stages,this._lfoR,this.Q);this.frequency=this._lfoL.frequency;this.frequency.value=options.frequency;this.effectSendL.connect(this._filtersL[0]);this.effectSendR.connect(this._filtersR[0]);this._filtersL[options.stages-1].connect(this.effectReturnL);this._filtersR[options.stages-1].connect(this.effectReturnR);this._lfoL.frequency.connect(this._lfoR.frequency);this.baseFrequency=options.baseFrequency;this.octaves=options.octaves;this._lfoL.start();this._lfoR.start();this._readOnly(['frequency','Q'])};Tone.extend(Tone.Phaser,Tone.StereoEffect);Tone.Phaser.defaults={'frequency':0.5,'octaves':3,'stages':10,'Q':10,'baseFrequency':350};Tone.Phaser.prototype._makeFilters=function(stages,connectToFreq,Q){var filters=new Array(stages);for(var i=0;i<stages;i++){var filter=this.context.createBiquadFilter();filter.type='allpass';Q.connect(filter.Q);connectToFreq.connect(filter.frequency);filters[i]=filter}
this.connectSeries.apply(this,filters);return filters};Object.defineProperty(Tone.Phaser.prototype,'octaves',{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves;var max=this._baseFrequency*Math.pow(2,octaves);this._lfoL.max=max;this._lfoR.max=max}});Object.defineProperty(Tone.Phaser.prototype,'baseFrequency',{get:function(){return this._baseFrequency},set:function(freq){this._baseFrequency=freq;this._lfoL.min=freq;this._lfoR.min=freq;this.octaves=this._octaves}});Tone.Phaser.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);this._writable(['frequency','Q']);this.Q.dispose();this.Q=null;this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;for(var i=0;i<this._filtersL.length;i++){this._filtersL[i].disconnect();this._filtersL[i]=null}
this._filtersL=null;for(var j=0;j<this._filtersR.length;j++){this._filtersR[j].disconnect();this._filtersR[j]=null}
this._filtersR=null;this.frequency=null;return this};return Tone.Phaser});Module(function(Tone){Tone.PingPongDelay=function(){var options=this.optionsObject(arguments,['delayTime','feedback'],Tone.PingPongDelay.defaults);Tone.StereoXFeedbackEffect.call(this,options);this._leftDelay=this.context.createDelay(options.maxDelayTime);this._rightDelay=this.context.createDelay(options.maxDelayTime);this._rightPreDelay=this.context.createDelay(options.maxDelayTime);this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time);this.effectSendL.chain(this._leftDelay,this.effectReturnL);this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR);this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime);this._feedbackLR.disconnect();this._feedbackLR.connect(this._rightDelay);this._readOnly(['delayTime'])};Tone.extend(Tone.PingPongDelay,Tone.StereoXFeedbackEffect);Tone.PingPongDelay.defaults={'delayTime':0.25,'maxDelayTime':1};Tone.PingPongDelay.prototype.dispose=function(){Tone.StereoXFeedbackEffect.prototype.dispose.call(this);this._leftDelay.disconnect();this._leftDelay=null;this._rightDelay.disconnect();this._rightDelay=null;this._rightPreDelay.disconnect();this._rightPreDelay=null;this._writable(['delayTime']);this.delayTime.dispose();this.delayTime=null;return this};return Tone.PingPongDelay});Module(function(Tone){Tone.PitchShift=function(){var options=this.optionsObject(arguments,['pitch'],Tone.PitchShift.defaults);Tone.FeedbackEffect.call(this,options);this._frequency=new Tone.Signal(0);this._delayA=new Tone.Delay(0,1);this._lfoA=new Tone.LFO({'min':0,'max':0.1,'type':'sawtooth'}).connect(this._delayA.delayTime);this._delayB=new Tone.Delay(0,1);this._lfoB=new Tone.LFO({'min':0,'max':0.1,'type':'sawtooth','phase':180}).connect(this._delayB.delayTime);this._crossFade=new Tone.CrossFade();this._crossFadeLFO=new Tone.LFO({'min':0,'max':1,'type':'triangle','phase':90}).connect(this._crossFade.fade);this._feedbackDelay=new Tone.Delay(options.delayTime);this.delayTime=this._feedbackDelay.delayTime;this._readOnly('delayTime');this._pitch=options.pitch;this._windowSize=options.windowSize;this._delayA.connect(this._crossFade.a);this._delayB.connect(this._crossFade.b);this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency);this.effectSend.fan(this._delayA,this._delayB);this._crossFade.chain(this._feedbackDelay,this.effectReturn);var now=this.now();this._lfoA.start(now);this._lfoB.start(now);this._crossFadeLFO.start(now);this.windowSize=this._windowSize};Tone.extend(Tone.PitchShift,Tone.FeedbackEffect);Tone.PitchShift.defaults={'pitch':0,'windowSize':0.1,'delayTime':0,'feedback':0};Object.defineProperty(Tone.PitchShift.prototype,'pitch',{get:function(){return this._pitch},set:function(interval){this._pitch=interval;var factor=0;if(interval<0){this._lfoA.min=0;this._lfoA.max=this._windowSize;this._lfoB.min=0;this._lfoB.max=this._windowSize;factor=this.intervalToFrequencyRatio(interval-1)+1}else{this._lfoA.min=this._windowSize;this._lfoA.max=0;this._lfoB.min=this._windowSize;this._lfoB.max=0;factor=this.intervalToFrequencyRatio(interval)-1}
this._frequency.value=factor*(1.2/this._windowSize)}});Object.defineProperty(Tone.PitchShift.prototype,'windowSize',{get:function(){return this._windowSize},set:function(size){this._windowSize=this.toSeconds(size);this.pitch=this._pitch}});Tone.PitchShift.prototype.dispose=function(){Tone.FeedbackEffect.prototype.dispose.call(this);this._frequency.dispose();this._frequency=null;this._delayA.disconnect();this._delayA=null;this._delayB.disconnect();this._delayB=null;this._lfoA.dispose();this._lfoA=null;this._lfoB.dispose();this._lfoB=null;this._crossFade.dispose();this._crossFade=null;this._crossFadeLFO.dispose();this._crossFadeLFO=null;this._writable('delayTime');this._feedbackDelay.dispose();this._feedbackDelay=null;this.delayTime=null;return this};return Tone.PitchShift});Module(function(Tone){Tone.StereoFeedbackEffect=function(){var options=this.optionsObject(arguments,['feedback'],Tone.FeedbackEffect.defaults);Tone.StereoEffect.call(this,options);this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange);this._feedbackL=this.context.createGain();this._feedbackR=this.context.createGain();this.effectReturnL.chain(this._feedbackL,this.effectSendL);this.effectReturnR.chain(this._feedbackR,this.effectSendR);this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain);this._readOnly(['feedback'])};Tone.extend(Tone.StereoFeedbackEffect,Tone.FeedbackEffect);Tone.StereoFeedbackEffect.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);this._writable(['feedback']);this.feedback.dispose();this.feedback=null;this._feedbackL.disconnect();this._feedbackL=null;this._feedbackR.disconnect();this._feedbackR=null;return this};return Tone.StereoFeedbackEffect});Module(function(Tone){Tone.StereoWidener=function(){var options=this.optionsObject(arguments,['width'],Tone.StereoWidener.defaults);Tone.MidSideEffect.call(this,options);this.width=new Tone.Signal(options.width,Tone.Type.NormalRange);this._midMult=new Tone.Expr('$0 * ($1 * (1 - $2))');this._sideMult=new Tone.Expr('$0 * ($1 * $2)');this._two=new Tone.Signal(2);this._two.connect(this._midMult,0,1);this.width.connect(this._midMult,0,2);this._two.connect(this._sideMult,0,1);this.width.connect(this._sideMult,0,2);this.midSend.chain(this._midMult,this.midReturn);this.sideSend.chain(this._sideMult,this.sideReturn);this._readOnly(['width'])};Tone.extend(Tone.StereoWidener,Tone.MidSideEffect);Tone.StereoWidener.defaults={'width':0.5};Tone.StereoWidener.prototype.dispose=function(){Tone.MidSideEffect.prototype.dispose.call(this);this._writable(['width']);this.width.dispose();this.width=null;this._midMult.dispose();this._midMult=null;this._sideMult.dispose();this._sideMult=null;this._two.dispose();this._two=null;return this};return Tone.StereoWidener});Module(function(Tone){Tone.Tremolo=function(){var options=this.optionsObject(arguments,['frequency','depth'],Tone.Tremolo.defaults);Tone.StereoEffect.call(this,options);this._lfoL=new Tone.LFO({'phase':options.spread,'min':1,'max':0});this._lfoR=new Tone.LFO({'phase':options.spread,'min':1,'max':0});this._amplitudeL=new Tone.Gain();this._amplitudeR=new Tone.Gain();this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency);this.depth=new Tone.Signal(options.depth,Tone.Type.NormalRange);this._readOnly(['frequency','depth']);this.effectSendL.chain(this._amplitudeL,this.effectReturnL);this.effectSendR.chain(this._amplitudeR,this.effectReturnR);this._lfoL.connect(this._amplitudeL.gain);this._lfoR.connect(this._amplitudeR.gain);this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency);this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude);this.type=options.type;this.spread=options.spread};Tone.extend(Tone.Tremolo,Tone.StereoEffect);Tone.Tremolo.defaults={'frequency':10,'type':'sine','depth':0.5,'spread':180};Tone.Tremolo.prototype.start=function(time){this._lfoL.start(time);this._lfoR.start(time);return this};Tone.Tremolo.prototype.stop=function(time){this._lfoL.stop(time);this._lfoR.stop(time);return this};Tone.Tremolo.prototype.sync=function(delay){this._lfoL.sync(delay);this._lfoR.sync(delay);return this};Tone.Tremolo.prototype.unsync=function(){this._lfoL.unsync();this._lfoR.unsync();return this};Object.defineProperty(Tone.Tremolo.prototype,'type',{get:function(){return this._lfoL.type},set:function(type){this._lfoL.type=type;this._lfoR.type=type}});Object.defineProperty(Tone.Tremolo.prototype,'spread',{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(spread){this._lfoL.phase=90-spread/2;this._lfoR.phase=spread/2+90}});Tone.Tremolo.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);this._writable(['frequency','depth']);this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;this._amplitudeL.dispose();this._amplitudeL=null;this._amplitudeR.dispose();this._amplitudeR=null;this.frequency=null;this.depth=null;return this};return Tone.Tremolo});Module(function(Tone){Tone.Vibrato=function(){var options=this.optionsObject(arguments,['frequency','depth'],Tone.Vibrato.defaults);Tone.Effect.call(this,options);this._delayNode=new Tone.Delay(0,options.maxDelay);this._lfo=new Tone.LFO({'type':options.type,'min':0,'max':options.maxDelay,'frequency':options.frequency,'phase':-90}).start().connect(this._delayNode.delayTime);this.frequency=this._lfo.frequency;this.depth=this._lfo.amplitude;this.depth.value=options.depth;this._readOnly(['frequency','depth']);this.effectSend.chain(this._delayNode,this.effectReturn)};Tone.extend(Tone.Vibrato,Tone.Effect);Tone.Vibrato.defaults={'maxDelay':0.005,'frequency':5,'depth':0.1,'type':'sine'};Object.defineProperty(Tone.Vibrato.prototype,'type',{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}});Tone.Vibrato.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._delayNode.dispose();this._delayNode=null;this._lfo.dispose();this._lfo=null;this._writable(['frequency','depth']);this.frequency=null;this.depth=null};return Tone.Vibrato});Module(function(Tone){Tone.PulseOscillator=function(){var options=this.optionsObject(arguments,['frequency','width'],Tone.Oscillator.defaults);Tone.Source.call(this,options);this.width=new Tone.Signal(options.width,Tone.Type.NormalRange);this._widthGate=this.context.createGain();this._sawtooth=new Tone.Oscillator({frequency:options.frequency,detune:options.detune,type:'sawtooth',phase:options.phase});this.frequency=this._sawtooth.frequency;this.detune=this._sawtooth.detune;this._thresh=new Tone.WaveShaper(function(val){if(val<0){return-1}else{return 1}});this._sawtooth.chain(this._thresh,this.output);this.width.chain(this._widthGate,this._thresh);this._readOnly(['width','frequency','detune'])};Tone.extend(Tone.PulseOscillator,Tone.Oscillator);Tone.PulseOscillator.defaults={'frequency':440,'detune':0,'phase':0,'width':0.2};Tone.PulseOscillator.prototype._start=function(time){time=this.toSeconds(time);this._sawtooth.start(time);this._widthGate.gain.setValueAtTime(1,time)};Tone.PulseOscillator.prototype._stop=function(time){time=this.toSeconds(time);this._sawtooth.stop(time);this._widthGate.gain.setValueAtTime(0,time)};Object.defineProperty(Tone.PulseOscillator.prototype,'phase',{get:function(){return this._sawtooth.phase},set:function(phase){this._sawtooth.phase=phase}});Object.defineProperty(Tone.PulseOscillator.prototype,'type',{get:function(){return'pulse'}});Object.defineProperty(Tone.PulseOscillator.prototype,'partials',{get:function(){return[]}});Tone.PulseOscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);this._sawtooth.dispose();this._sawtooth=null;this._writable(['width','frequency','detune']);this.width.dispose();this.width=null;this._widthGate.disconnect();this._widthGate=null;this._widthGate=null;this._thresh.disconnect();this._thresh=null;this.frequency=null;this.detune=null;return this};return Tone.PulseOscillator});Module(function(Tone){Tone.PWMOscillator=function(){var options=this.optionsObject(arguments,['frequency','modulationFrequency'],Tone.PWMOscillator.defaults);Tone.Source.call(this,options);this._pulse=new Tone.PulseOscillator(options.modulationFrequency);this._pulse._sawtooth.type='sine';this._modulator=new Tone.Oscillator({'frequency':options.frequency,'detune':options.detune,'phase':options.phase});this._scale=new Tone.Multiply(1.01);this.frequency=this._modulator.frequency;this.detune=this._modulator.detune;this.modulationFrequency=this._pulse.frequency;this._modulator.chain(this._scale,this._pulse.width);this._pulse.connect(this.output);this._readOnly(['modulationFrequency','frequency','detune'])};Tone.extend(Tone.PWMOscillator,Tone.Oscillator);Tone.PWMOscillator.defaults={'frequency':440,'detune':0,'phase':0,'modulationFrequency':0.4};Tone.PWMOscillator.prototype._start=function(time){time=this.toSeconds(time);this._modulator.start(time);this._pulse.start(time)};Tone.PWMOscillator.prototype._stop=function(time){time=this.toSeconds(time);this._modulator.stop(time);this._pulse.stop(time)};Object.defineProperty(Tone.PWMOscillator.prototype,'type',{get:function(){return'pwm'}});Object.defineProperty(Tone.PWMOscillator.prototype,'partials',{get:function(){return[]}});Object.defineProperty(Tone.PWMOscillator.prototype,'phase',{get:function(){return this._modulator.phase},set:function(phase){this._modulator.phase=phase}});Tone.PWMOscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);this._pulse.dispose();this._pulse=null;this._scale.dispose();this._scale=null;this._modulator.dispose();this._modulator=null;this._writable(['modulationFrequency','frequency','detune']);this.frequency=null;this.detune=null;this.modulationFrequency=null;return this};return Tone.PWMOscillator});Module(function(Tone){Tone.OmniOscillator=function(){var options=this.optionsObject(arguments,['frequency','type'],Tone.OmniOscillator.defaults);Tone.Source.call(this,options);this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency);this.detune=new Tone.Signal(options.detune,Tone.Type.Cents);this._sourceType=undefined;this._oscillator=null;this.type=options.type;this.phase=options.phase;this._readOnly(['frequency','detune']);if(this.isArray(options.partials)){this.partials=options.partials}};Tone.extend(Tone.OmniOscillator,Tone.Oscillator);Tone.OmniOscillator.defaults={'frequency':440,'detune':0,'type':'sine','phase':0,'width':0.4,'modulationFrequency':0.4};var OmniOscType={PulseOscillator:'PulseOscillator',PWMOscillator:'PWMOscillator',Oscillator:'Oscillator'};Tone.OmniOscillator.prototype._start=function(time){this._oscillator.start(time)};Tone.OmniOscillator.prototype._stop=function(time){this._oscillator.stop(time)};Object.defineProperty(Tone.OmniOscillator.prototype,'type',{get:function(){return this._oscillator.type},set:function(type){if(type.indexOf('sine')===0||type.indexOf('square')===0||type.indexOf('triangle')===0||type.indexOf('sawtooth')===0||type===Tone.Oscillator.Type.Custom){if(this._sourceType!==OmniOscType.Oscillator){this._sourceType=OmniOscType.Oscillator;this._createNewOscillator(Tone.Oscillator)}
this._oscillator.type=type}else if(type==='pwm'){if(this._sourceType!==OmniOscType.PWMOscillator){this._sourceType=OmniOscType.PWMOscillator;this._createNewOscillator(Tone.PWMOscillator)}}else if(type==='pulse'){if(this._sourceType!==OmniOscType.PulseOscillator){this._sourceType=OmniOscType.PulseOscillator;this._createNewOscillator(Tone.PulseOscillator)}}else{throw new Error('Tone.OmniOscillator does not support type '+type)}}});Object.defineProperty(Tone.OmniOscillator.prototype,'partials',{get:function(){return this._oscillator.partials},set:function(partials){if(this._sourceType!==OmniOscType.Oscillator){this.type=Tone.Oscillator.Type.Custom}
this._oscillator.partials=partials}});Tone.OmniOscillator.prototype._createNewOscillator=function(OscillatorConstructor){var now=this.now()+this.blockTime;if(this._oscillator!==null){var oldOsc=this._oscillator;oldOsc.stop(now);setTimeout(function(){oldOsc.dispose();oldOsc=null},this.blockTime*1000)}
this._oscillator=new OscillatorConstructor();this.frequency.connect(this._oscillator.frequency);this.detune.connect(this._oscillator.detune);this._oscillator.connect(this.output);if(this.state===Tone.State.Started){this._oscillator.start(now)}};Object.defineProperty(Tone.OmniOscillator.prototype,'phase',{get:function(){return this._oscillator.phase},set:function(phase){this._oscillator.phase=phase}});Object.defineProperty(Tone.OmniOscillator.prototype,'width',{get:function(){if(this._sourceType===OmniOscType.PulseOscillator){return this._oscillator.width}}});Object.defineProperty(Tone.OmniOscillator.prototype,'modulationFrequency',{get:function(){if(this._sourceType===OmniOscType.PWMOscillator){return this._oscillator.modulationFrequency}}});Tone.OmniOscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);this._writable(['frequency','detune']);this.detune.dispose();this.detune=null;this.frequency.dispose();this.frequency=null;this._oscillator.dispose();this._oscillator=null;this._sourceType=null;return this};return Tone.OmniOscillator});Module(function(Tone){Tone.Instrument=function(options){options=this.defaultArg(options,Tone.Instrument.defaults);this._volume=this.output=new Tone.Volume(options.volume);this.volume=this._volume.volume;this._readOnly('volume')};Tone.extend(Tone.Instrument);Tone.Instrument.defaults={'volume':0};Tone.Instrument.prototype.triggerAttack=Tone.noOp;Tone.Instrument.prototype.triggerRelease=Tone.noOp;Tone.Instrument.prototype.triggerAttackRelease=function(note,duration,time,velocity){time=this.toSeconds(time);duration=this.toSeconds(duration);this.triggerAttack(note,time,velocity);this.triggerRelease(time+duration);return this};Tone.Instrument.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._volume.dispose();this._volume=null;this._writable(['volume']);this.volume=null;return this};return Tone.Instrument});Module(function(Tone){Tone.Monophonic=function(options){options=this.defaultArg(options,Tone.Monophonic.defaults);Tone.Instrument.call(this,options);this.portamento=options.portamento};Tone.extend(Tone.Monophonic,Tone.Instrument);Tone.Monophonic.defaults={'portamento':0};Tone.Monophonic.prototype.triggerAttack=function(note,time,velocity){time=this.toSeconds(time);this._triggerEnvelopeAttack(time,velocity);this.setNote(note,time);return this};Tone.Monophonic.prototype.triggerRelease=function(time){this._triggerEnvelopeRelease(time);return this};Tone.Monophonic.prototype._triggerEnvelopeAttack=function(){};Tone.Monophonic.prototype._triggerEnvelopeRelease=function(){};Tone.Monophonic.prototype.setNote=function(note,time){time=this.toSeconds(time);if(this.portamento>0){var currentNote=this.frequency.value;this.frequency.setValueAtTime(currentNote,time);var portTime=this.toSeconds(this.portamento);this.frequency.exponentialRampToValueAtTime(note,time+portTime)}else{this.frequency.setValueAtTime(note,time)}
return this};return Tone.Monophonic});Module(function(Tone){Tone.MonoSynth=function(options){options=this.defaultArg(options,Tone.MonoSynth.defaults);Tone.Monophonic.call(this,options);this.oscillator=new Tone.OmniOscillator(options.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.filter=new Tone.Filter(options.filter);this.filterEnvelope=new Tone.FrequencyEnvelope(options.filterEnvelope);this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.oscillator.chain(this.filter,this.envelope,this.output);this.oscillator.start();this.filterEnvelope.connect(this.filter.frequency);this._readOnly(['oscillator','frequency','detune','filter','filterEnvelope','envelope'])};Tone.extend(Tone.MonoSynth,Tone.Monophonic);Tone.MonoSynth.defaults={'frequency':'C4','detune':0,'oscillator':{'type':'square'},'filter':{'Q':6,'type':'lowpass','rolloff':-24},'envelope':{'attack':0.005,'decay':0.1,'sustain':0.9,'release':1},'filterEnvelope':{'attack':0.06,'decay':0.2,'sustain':0.5,'release':2,'baseFrequency':200,'octaves':7,'exponent':2}};Tone.MonoSynth.prototype._triggerEnvelopeAttack=function(time,velocity){this.envelope.triggerAttack(time,velocity);this.filterEnvelope.triggerAttack(time);return this};Tone.MonoSynth.prototype._triggerEnvelopeRelease=function(time){this.envelope.triggerRelease(time);this.filterEnvelope.triggerRelease(time);return this};Tone.MonoSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(['oscillator','frequency','detune','filter','filterEnvelope','envelope']);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;this.filterEnvelope.dispose();this.filterEnvelope=null;this.filter.dispose();this.filter=null;this.frequency=null;this.detune=null;return this};return Tone.MonoSynth});Module(function(Tone){Tone.AMSynth=function(options){options=this.defaultArg(options,Tone.AMSynth.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.MonoSynth(options.carrier);this.carrier.volume.value=-10;this.modulator=new Tone.MonoSynth(options.modulator);this.modulator.volume.value=-10;this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this._modulationScale=new Tone.AudioToGain();this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.modulator.chain(this._modulationScale,this._modulationNode.gain);this.carrier.chain(this._modulationNode,this.output);this._readOnly(['carrier','modulator','frequency','harmonicity'])};Tone.extend(Tone.AMSynth,Tone.Monophonic);Tone.AMSynth.defaults={'harmonicity':3,'carrier':{'volume':-10,'oscillator':{'type':'sine'},'envelope':{'attack':0.01,'decay':0.01,'sustain':1,'release':0.5},'filterEnvelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5,'baseFrequency':20000,'octaves':0},'filter':{'Q':6,'type':'lowpass','rolloff':-24}},'modulator':{'volume':-10,'oscillator':{'type':'square'},'envelope':{'attack':2,'decay':0,'sustain':1,'release':0.5},'filterEnvelope':{'attack':4,'decay':0.2,'sustain':0.5,'release':0.5,'baseFrequency':20,'octaves':6},'filter':{'Q':6,'type':'lowpass','rolloff':-24}}};Tone.AMSynth.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);this.carrier.filterEnvelope.triggerAttack(time);this.modulator.filterEnvelope.triggerAttack(time);return this};Tone.AMSynth.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.AMSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(['carrier','modulator','frequency','harmonicity']);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationScale.dispose();this._modulationScale=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.AMSynth});Module(function(Tone){Tone.DrumSynth=function(options){options=this.defaultArg(options,Tone.DrumSynth.defaults);Tone.Instrument.call(this,options);this.oscillator=new Tone.Oscillator(options.oscillator).start();this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.octaves=options.octaves;this.pitchDecay=options.pitchDecay;this.oscillator.chain(this.envelope,this.output);this._readOnly(['oscillator','envelope'])};Tone.extend(Tone.DrumSynth,Tone.Instrument);Tone.DrumSynth.defaults={'pitchDecay':0.05,'octaves':10,'oscillator':{'type':'sine'},'envelope':{'attack':0.001,'decay':0.4,'sustain':0.01,'release':1.4,'attackCurve':'exponential'}};Tone.DrumSynth.prototype.triggerAttack=function(note,time,velocity){time=this.toSeconds(time);note=this.toFrequency(note);var maxNote=note*this.octaves;this.oscillator.frequency.setValueAtTime(maxNote,time);this.oscillator.frequency.exponentialRampToValueAtTime(note,time+this.toSeconds(this.pitchDecay));this.envelope.triggerAttack(time,velocity);return this};Tone.DrumSynth.prototype.triggerRelease=function(time){this.envelope.triggerRelease(time);return this};Tone.DrumSynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._writable(['oscillator','envelope']);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;return this};return Tone.DrumSynth});Module(function(Tone){Tone.DuoSynth=function(options){options=this.defaultArg(options,Tone.DuoSynth.defaults);Tone.Monophonic.call(this,options);this.voice0=new Tone.MonoSynth(options.voice0);this.voice0.volume.value=-10;this.voice1=new Tone.MonoSynth(options.voice1);this.voice1.volume.value=-10;this._vibrato=new Tone.LFO(options.vibratoRate,-50,50);this._vibrato.start();this.vibratoRate=this._vibrato.frequency;this._vibratoGain=this.context.createGain();this.vibratoAmount=new Tone.Param({'param':this._vibratoGain.gain,'units':Tone.Type.Positive,'value':options.vibratoAmount});this._vibratoDelay=this.toSeconds(options.vibratoDelay);this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this.frequency.connect(this.voice0.frequency);this.frequency.chain(this.harmonicity,this.voice1.frequency);this._vibrato.connect(this._vibratoGain);this._vibratoGain.fan(this.voice0.detune,this.voice1.detune);this.voice0.connect(this.output);this.voice1.connect(this.output);this._readOnly(['voice0','voice1','frequency','vibratoAmount','vibratoRate'])};Tone.extend(Tone.DuoSynth,Tone.Monophonic);Tone.DuoSynth.defaults={'vibratoAmount':0.5,'vibratoRate':5,'vibratoDelay':1,'harmonicity':1.5,'voice0':{'volume':-10,'portamento':0,'oscillator':{'type':'sine'},'filterEnvelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5},'envelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5}},'voice1':{'volume':-10,'portamento':0,'oscillator':{'type':'sine'},'filterEnvelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5},'envelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5}}};Tone.DuoSynth.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.voice0.envelope.triggerAttack(time,velocity);this.voice1.envelope.triggerAttack(time,velocity);this.voice0.filterEnvelope.triggerAttack(time);this.voice1.filterEnvelope.triggerAttack(time);return this};Tone.DuoSynth.prototype._triggerEnvelopeRelease=function(time){this.voice0.triggerRelease(time);this.voice1.triggerRelease(time);return this};Tone.DuoSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(['voice0','voice1','frequency','vibratoAmount','vibratoRate']);this.voice0.dispose();this.voice0=null;this.voice1.dispose();this.voice1=null;this.frequency.dispose();this.frequency=null;this._vibrato.dispose();this._vibrato=null;this._vibratoGain.disconnect();this._vibratoGain=null;this.harmonicity.dispose();this.harmonicity=null;this.vibratoAmount.dispose();this.vibratoAmount=null;this.vibratoRate=null;return this};return Tone.DuoSynth});Module(function(Tone){Tone.FMSynth=function(options){options=this.defaultArg(options,Tone.FMSynth.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.MonoSynth(options.carrier);this.carrier.volume.value=-10;this.modulator=new Tone.MonoSynth(options.modulator);this.modulator.volume.value=-10;this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this.modulationIndex=new Tone.Multiply(options.modulationIndex);this.modulationIndex.units=Tone.Type.Positive;this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this.modulator.connect(this._modulationNode.gain);this._modulationNode.gain.value=0;this._modulationNode.connect(this.carrier.frequency);this.carrier.connect(this.output);this._readOnly(['carrier','modulator','frequency','harmonicity','modulationIndex'])};Tone.extend(Tone.FMSynth,Tone.Monophonic);Tone.FMSynth.defaults={'harmonicity':3,'modulationIndex':10,'carrier':{'volume':-10,'portamento':0,'oscillator':{'type':'sine'},'envelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5},'filterEnvelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5,'baseFrequency':200,'octaves':8}},'modulator':{'volume':-10,'portamento':0,'oscillator':{'type':'triangle'},'envelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5},'filterEnvelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5,'baseFrequency':600,'octaves':5}}};Tone.FMSynth.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);this.carrier.filterEnvelope.triggerAttack(time);this.modulator.filterEnvelope.triggerAttack(time);return this};Tone.FMSynth.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.FMSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(['carrier','modulator','frequency','harmonicity','modulationIndex']);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.modulationIndex.dispose();this.modulationIndex=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.FMSynth});Module(function(Tone){Tone.Noise=function(){var options=this.optionsObject(arguments,['type'],Tone.Noise.defaults);Tone.Source.call(this,options);this._source=null;this._buffer=null;this._playbackRate=options.playbackRate;this.type=options.type};Tone.extend(Tone.Noise,Tone.Source);Tone.Noise.defaults={'type':'white','playbackRate':1};Object.defineProperty(Tone.Noise.prototype,'type',{get:function(){if(this._buffer===_whiteNoise){return'white'}else if(this._buffer===_brownNoise){return'brown'}else if(this._buffer===_pinkNoise){return'pink'}},set:function(type){if(this.type!==type){switch(type){case 'white':this._buffer=_whiteNoise;break;case 'pink':this._buffer=_pinkNoise;break;case 'brown':this._buffer=_brownNoise;break;default:throw new Error('invalid noise type: '+type)}
if(this.state===Tone.State.Started){var now=this.now()+this.blockTime;this._stop(now);this._start(now)}}}});Object.defineProperty(Tone.Noise.prototype,'playbackRate',{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate;if(this._source){this._source.playbackRate.value=rate}}});Tone.Noise.prototype._start=function(time){this._source=this.context.createBufferSource();this._source.buffer=this._buffer;this._source.loop=!0;this._source.playbackRate.value=this._playbackRate;this._source.connect(this.output);this._source.start(this.toSeconds(time))};Tone.Noise.prototype._stop=function(time){if(this._source){this._source.stop(this.toSeconds(time))}};Tone.Noise.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);if(this._source!==null){this._source.disconnect();this._source=null}
this._buffer=null;return this};var _pinkNoise=null,_brownNoise=null,_whiteNoise=null;Tone._initAudioContext(function(audioContext){var sampleRate=audioContext.sampleRate;var bufferLength=sampleRate*4;_pinkNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum);var b0,b1,b2,b3,b4,b5,b6;b0=b1=b2=b3=b4=b5=b6=0;for(var i=0;i<bufferLength;i++){var white=Math.random()*2-1;b0=0.99886*b0+white*0.0555179;b1=0.99332*b1+white*0.0750759;b2=0.969*b2+white*0.153852;b3=0.8665*b3+white*0.3104856;b4=0.55*b4+white*0.5329522;b5=-0.7616*b5-white*0.016898;channel[i]=b0+b1+b2+b3+b4+b5+b6+white*0.5362;channel[i]*=0.11;b6=white*0.115926}}
return buffer}();_brownNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum);var lastOut=0;for(var i=0;i<bufferLength;i++){var white=Math.random()*2-1;channel[i]=(lastOut+0.02*white)/1.02;lastOut=channel[i];channel[i]*=3.5}}
return buffer}();_whiteNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum);for(var i=0;i<bufferLength;i++){channel[i]=Math.random()*2-1}}
return buffer}()});return Tone.Noise});Module(function(Tone){Tone.NoiseSynth=function(options){options=this.defaultArg(options,Tone.NoiseSynth.defaults);Tone.Instrument.call(this,options);this.noise=new Tone.Noise();this.filter=new Tone.Filter(options.filter);this.filterEnvelope=new Tone.FrequencyEnvelope(options.filterEnvelope);this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.noise.chain(this.filter,this.envelope,this.output);this.noise.start();this.filterEnvelope.connect(this.filter.frequency);this._readOnly(['noise','filter','filterEnvelope','envelope'])};Tone.extend(Tone.NoiseSynth,Tone.Instrument);Tone.NoiseSynth.defaults={'noise':{'type':'white'},'filter':{'Q':6,'type':'highpass','rolloff':-24},'envelope':{'attack':0.005,'decay':0.1,'sustain':0},'filterEnvelope':{'attack':0.06,'decay':0.2,'sustain':0,'release':2,'baseFrequency':20,'octaves':5}};Tone.NoiseSynth.prototype.triggerAttack=function(time,velocity){this.envelope.triggerAttack(time,velocity);this.filterEnvelope.triggerAttack(time);return this};Tone.NoiseSynth.prototype.triggerRelease=function(time){this.envelope.triggerRelease(time);this.filterEnvelope.triggerRelease(time);return this};Tone.NoiseSynth.prototype.triggerAttackRelease=function(duration,time,velocity){time=this.toSeconds(time);duration=this.toSeconds(duration);this.triggerAttack(time,velocity);this.triggerRelease(time+duration);return this};Tone.NoiseSynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._writable(['noise','filter','filterEnvelope','envelope']);this.noise.dispose();this.noise=null;this.envelope.dispose();this.envelope=null;this.filterEnvelope.dispose();this.filterEnvelope=null;this.filter.dispose();this.filter=null;return this};return Tone.NoiseSynth});Module(function(Tone){Tone.PluckSynth=function(options){options=this.defaultArg(options,Tone.PluckSynth.defaults);Tone.Instrument.call(this,options);this._noise=new Tone.Noise('pink');this.attackNoise=1;this._lfcf=new Tone.LowpassCombFilter({'resonance':options.resonance,'dampening':options.dampening});this.resonance=this._lfcf.resonance;this.dampening=this._lfcf.dampening;this._noise.connect(this._lfcf);this._lfcf.connect(this.output);this._readOnly(['resonance','dampening'])};Tone.extend(Tone.PluckSynth,Tone.Instrument);Tone.PluckSynth.defaults={'attackNoise':1,'dampening':4000,'resonance':0.9};Tone.PluckSynth.prototype.triggerAttack=function(note,time){note=this.toFrequency(note);time=this.toSeconds(time);var delayAmount=1/note;this._lfcf.delayTime.setValueAtTime(delayAmount,time);this._noise.start(time);this._noise.stop(time+delayAmount*this.attackNoise);return this};Tone.PluckSynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._noise.dispose();this._lfcf.dispose();this._noise=null;this._lfcf=null;this._writable(['resonance','dampening']);this.dampening=null;this.resonance=null;return this};return Tone.PluckSynth});Module(function(Tone){Tone.PolySynth=function(){Tone.Instrument.call(this);var options=this.optionsObject(arguments,['polyphony','voice'],Tone.PolySynth.defaults);this.voices=new Array(options.polyphony);this.stealVoices=!0;this._freeVoices=[];this._activeVoices={};for(var i=0;i<options.polyphony;i++){var v=new options.voice(arguments[2],arguments[3]);this.voices[i]=v;v.connect(this.output)}
this._freeVoices=this.voices.slice(0)};Tone.extend(Tone.PolySynth,Tone.Instrument);Tone.PolySynth.defaults={'polyphony':4,'voice':Tone.MonoSynth};Tone.PolySynth.prototype.triggerAttack=function(notes,time,velocity){if(!Array.isArray(notes)){notes=[notes]}
for(var i=0;i<notes.length;i++){var val=notes[i];var stringified=JSON.stringify(val);if(this._activeVoices.hasOwnProperty(stringified)){this._activeVoices[stringified].triggerAttack(val,time,velocity)}else if(this._freeVoices.length>0){var voice=this._freeVoices.shift();voice.triggerAttack(val,time,velocity);this._activeVoices[stringified]=voice}else if(this.stealVoices){for(var voiceName in this._activeVoices){this._activeVoices[voiceName].triggerAttack(val,time,velocity);break}}}
return this};Tone.PolySynth.prototype.triggerAttackRelease=function(notes,duration,time,velocity){time=this.toSeconds(time);this.triggerAttack(notes,time,velocity);this.triggerRelease(notes,time+this.toSeconds(duration));return this};Tone.PolySynth.prototype.triggerRelease=function(notes,time){if(!Array.isArray(notes)){notes=[notes]}
for(var i=0;i<notes.length;i++){var stringified=JSON.stringify(notes[i]);var voice=this._activeVoices[stringified];if(voice){voice.triggerRelease(time);this._freeVoices.push(voice);delete this._activeVoices[stringified];voice=null}}
return this};Tone.PolySynth.prototype.set=function(params,value,rampTime){for(var i=0;i<this.voices.length;i++){this.voices[i].set(params,value,rampTime)}
return this};Tone.PolySynth.prototype.get=function(params){return this.voices[0].get(params)};Tone.PolySynth.prototype.releaseAll=function(time){for(var i=0;i<this.voices.length;i++){this.voices[i].triggerRelease(time)}
return this};Tone.PolySynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);for(var i=0;i<this.voices.length;i++){this.voices[i].dispose();this.voices[i]=null}
this.voices=null;this._activeVoices=null;this._freeVoices=null;return this};return Tone.PolySynth});Module(function(Tone){Tone.Player=function(url){var options;if(url instanceof Tone.Buffer){url=url.get();options=Tone.Player.defaults}else{options=this.optionsObject(arguments,['url','onload'],Tone.Player.defaults)}
Tone.Source.call(this,options);this._source=null;this.autostart=options.autostart;this._buffer=new Tone.Buffer({'url':options.url,'onload':this._onload.bind(this,options.onload),'reverse':options.reverse});if(url instanceof AudioBuffer){this._buffer.set(url)}
this._loop=options.loop;this._loopStart=options.loopStart;this._loopEnd=options.loopEnd;this._playbackRate=options.playbackRate;this.retrigger=options.retrigger};Tone.extend(Tone.Player,Tone.Source);Tone.Player.defaults={'onload':Tone.noOp,'playbackRate':1,'loop':!1,'autostart':!1,'loopStart':0,'loopEnd':0,'retrigger':!1,'reverse':!1};Tone.Player.prototype.load=function(url,callback){this._buffer.load(url,this._onload.bind(this,callback));return this};Tone.Player.prototype._onload=function(callback){callback(this);if(this.autostart){this.start()}};Tone.Player.prototype._start=function(startTime,offset,duration){if(this._buffer.loaded&&this._buffer._buffer){if(this._loop){offset=this.defaultArg(offset,this._loopStart)}else{offset=this.defaultArg(offset,0)}
offset=this.toSeconds(offset);duration=this.defaultArg(duration,this._buffer.duration-offset);startTime=this.toSeconds(startTime);duration=this.toSeconds(duration);this._source=this.context.createBufferSource();this._source.buffer=this._buffer.get();if(this._loop){this._source.loop=this._loop;this._source.loopStart=this.toSeconds(this._loopStart);this._source.loopEnd=this.toSeconds(this._loopEnd);duration=65536}else{this._state.setStateAtTime(Tone.State.Stopped,startTime+duration)}
this._source.playbackRate.value=this._playbackRate;this._source.connect(this.output);if(this._loop){this._source.start(startTime,offset)}else{this._source.start(startTime,offset,duration)}}else{console.log('tried to start Player before the buffer was loaded')}
return this};Tone.Player.prototype._stop=function(time){if(this._source){this._source.stop(this.toSeconds(time));this._source=null}
return this};Tone.Player.prototype.setLoopPoints=function(loopStart,loopEnd){this.loopStart=loopStart;this.loopEnd=loopEnd;return this};Object.defineProperty(Tone.Player.prototype,'loopStart',{get:function(){return this._loopStart},set:function(loopStart){this._loopStart=loopStart;if(this._source){this._source.loopStart=this.toSeconds(loopStart)}}});Object.defineProperty(Tone.Player.prototype,'loopEnd',{get:function(){return this._loopEnd},set:function(loopEnd){this._loopEnd=loopEnd;if(this._source){this._source.loopEnd=this.toSeconds(loopEnd)}}});Object.defineProperty(Tone.Player.prototype,'buffer',{get:function(){return this._buffer},set:function(buffer){this._buffer.set(buffer)}});Object.defineProperty(Tone.Player.prototype,'loop',{get:function(){return this._loop},set:function(loop){this._loop=loop;if(this._source){this._source.loop=loop}}});Object.defineProperty(Tone.Player.prototype,'playbackRate',{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate;if(this._source){this._source.playbackRate.value=rate}}});Object.defineProperty(Tone.Player.prototype,'reverse',{get:function(){return this._buffer.reverse},set:function(rev){this._buffer.reverse=rev}});Tone.Player.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);if(this._source!==null){this._source.disconnect();this._source=null}
this._buffer.dispose();this._buffer=null;return this};return Tone.Player});Module(function(Tone){Tone.Sampler=function(urls,options){options=this.defaultArg(options,Tone.Sampler.defaults);Tone.Instrument.call(this,options);this.player=new Tone.Player(options.player);this.player.retrigger=!0;this._buffers={};this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.filterEnvelope=new Tone.FrequencyEnvelope(options.filterEnvelope);this._sample=options.sample;this._pitch=options.pitch;this.filter=new Tone.Filter(options.filter);this._loadBuffers(urls);this.pitch=options.pitch;this.player.chain(this.filter,this.envelope,this.output);this.filterEnvelope.connect(this.filter.frequency);this._readOnly(['player','filterEnvelope','envelope','filter'])};Tone.extend(Tone.Sampler,Tone.Instrument);Tone.Sampler.defaults={'sample':0,'pitch':0,'player':{'loop':!1},'envelope':{'attack':0.001,'decay':0,'sustain':1,'release':0.1},'filterEnvelope':{'attack':0.001,'decay':0.001,'sustain':1,'release':0.5,'baseFrequency':20,'octaves':10},'filter':{'type':'lowpass'}};Tone.Sampler.prototype._loadBuffers=function(urls){if(this.isString(urls)){this._buffers['0']=new Tone.Buffer(urls,function(){this.sample='0'}.bind(this))}else{urls=this._flattenUrls(urls);for(var buffName in urls){this._sample=buffName;var urlString=urls[buffName];this._buffers[buffName]=new Tone.Buffer(urlString)}}};Tone.Sampler.prototype._flattenUrls=function(ob){var toReturn={};for(var i in ob){if(!ob.hasOwnProperty(i))
continue;if(this.isObject(ob[i])){var flatObject=this._flattenUrls(ob[i]);for(var x in flatObject){if(!flatObject.hasOwnProperty(x))
continue;toReturn[i+'.'+x]=flatObject[x]}}else{toReturn[i]=ob[i]}}
return toReturn};Tone.Sampler.prototype.triggerAttack=function(name,time,velocity){time=this.toSeconds(time);if(name){this.sample=name}
this.player.start(time);this.envelope.triggerAttack(time,velocity);this.filterEnvelope.triggerAttack(time);return this};Tone.Sampler.prototype.triggerRelease=function(time){time=this.toSeconds(time);this.filterEnvelope.triggerRelease(time);this.envelope.triggerRelease(time);this.player.stop(this.toSeconds(this.envelope.release)+time);return this};Object.defineProperty(Tone.Sampler.prototype,'sample',{get:function(){return this._sample},set:function(name){if(this._buffers.hasOwnProperty(name)){this._sample=name;this.player.buffer=this._buffers[name]}else{throw new Error('Sampler does not have a sample named '+name)}}});Object.defineProperty(Tone.Sampler.prototype,'reverse',{get:function(){for(var i in this._buffers){return this._buffers[i].reverse}},set:function(rev){for(var i in this._buffers){this._buffers[i].reverse=rev}}});Object.defineProperty(Tone.Sampler.prototype,'pitch',{get:function(){return this._pitch},set:function(interval){this._pitch=interval;this.player.playbackRate=this.intervalToFrequencyRatio(interval)}});Tone.Sampler.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._writable(['player','filterEnvelope','envelope','filter']);this.player.dispose();this.filterEnvelope.dispose();this.envelope.dispose();this.filter.dispose();this.player=null;this.filterEnvelope=null;this.envelope=null;this.filter=null;for(var sample in this._buffers){this._buffers[sample].dispose();this._buffers[sample]=null}
this._buffers=null;return this};return Tone.Sampler});Module(function(Tone){Tone.SimpleSynth=function(options){options=this.defaultArg(options,Tone.SimpleSynth.defaults);Tone.Monophonic.call(this,options);this.oscillator=new Tone.OmniOscillator(options.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.oscillator.chain(this.envelope,this.output);this.oscillator.start();this._readOnly(['oscillator','frequency','detune','envelope'])};Tone.extend(Tone.SimpleSynth,Tone.Monophonic);Tone.SimpleSynth.defaults={'oscillator':{'type':'triangle'},'envelope':{'attack':0.005,'decay':0.1,'sustain':0.3,'release':1}};Tone.SimpleSynth.prototype._triggerEnvelopeAttack=function(time,velocity){this.envelope.triggerAttack(time,velocity);return this};Tone.SimpleSynth.prototype._triggerEnvelopeRelease=function(time){this.envelope.triggerRelease(time);return this};Tone.SimpleSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(['oscillator','frequency','detune','envelope']);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;this.frequency=null;this.detune=null;return this};return Tone.SimpleSynth});Module(function(Tone){Tone.SimpleAM=function(options){options=this.defaultArg(options,Tone.SimpleAM.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.SimpleSynth(options.carrier);this.modulator=new Tone.SimpleSynth(options.modulator);this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this._modulationScale=new Tone.AudioToGain();this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.modulator.chain(this._modulationScale,this._modulationNode.gain);this.carrier.chain(this._modulationNode,this.output);this._readOnly(['carrier','modulator','frequency','harmonicity'])};Tone.extend(Tone.SimpleAM,Tone.Monophonic);Tone.SimpleAM.defaults={'harmonicity':3,'carrier':{'volume':-10,'portamento':0,'oscillator':{'type':'sine'},'envelope':{'attack':0.01,'decay':0.01,'sustain':1,'release':0.5}},'modulator':{'volume':-10,'portamento':0,'oscillator':{'type':'sine'},'envelope':{'attack':0.5,'decay':0.1,'sustain':1,'release':0.5}}};Tone.SimpleAM.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);return this};Tone.SimpleAM.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.SimpleAM.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(['carrier','modulator','frequency','harmonicity']);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationScale.dispose();this._modulationScale=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.SimpleAM});Module(function(Tone){Tone.SimpleFM=function(options){options=this.defaultArg(options,Tone.SimpleFM.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.SimpleSynth(options.carrier);this.carrier.volume.value=-10;this.modulator=new Tone.SimpleSynth(options.modulator);this.modulator.volume.value=-10;this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this.modulationIndex=new Tone.Multiply(options.modulationIndex);this.modulationIndex.units=Tone.Type.Positive;this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this.modulator.connect(this._modulationNode.gain);this._modulationNode.gain.value=0;this._modulationNode.connect(this.carrier.frequency);this.carrier.connect(this.output);this._readOnly(['carrier','modulator','frequency','harmonicity','modulationIndex'])};Tone.extend(Tone.SimpleFM,Tone.Monophonic);Tone.SimpleFM.defaults={'harmonicity':3,'modulationIndex':10,'carrier':{'volume':-10,'portamento':0,'oscillator':{'type':'sine'},'envelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5}},'modulator':{'volume':-10,'portamento':0,'oscillator':{'type':'triangle'},'envelope':{'attack':0.01,'decay':0,'sustain':1,'release':0.5}}};Tone.SimpleFM.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);return this};Tone.SimpleFM.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.SimpleFM.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(['carrier','modulator','frequency','harmonicity','modulationIndex']);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.modulationIndex.dispose();this.modulationIndex=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.SimpleFM});Module(function(Tone){Tone.Simpler=function(urls,options){options=this.defaultArg(options,Tone.Simpler.defaults);Tone.Instrument.call(this,options);this.player=new Tone.Player(options.player);this._buffers={};this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this._sample=options.sample;this._loadBuffers(urls);this.player.chain(this.envelope,this.output);this._readOnly(['player','envelope'])};Tone.extend(Tone.Simpler,Tone.Instrument);Tone.Simpler.defaults={'sample':0,'pitch':0,'player':{'loop':!1},'envelope':{'attack':0.001,'decay':0,'sustain':1,'release':0.1}};Tone.Simpler.prototype._loadBuffers=function(urls){if(typeof urls==='string'){this._buffers['0']=new Tone.Buffer(urls,function(){this.sample='0'}.bind(this))}else{urls=this._flattenUrls(urls);for(var buffName in urls){this._sample=buffName;var urlString=urls[buffName];this._buffers[buffName]=new Tone.Buffer(urlString)}}};Tone.Simpler.prototype._flattenUrls=function(ob){var toReturn={};for(var i in ob){if(!ob.hasOwnProperty(i))
continue;if(typeof ob[i]=='object'){var flatObject=this._flattenUrls(ob[i]);for(var x in flatObject){if(!flatObject.hasOwnProperty(x))
continue;toReturn[i+'.'+x]=flatObject[x]}}else{toReturn[i]=ob[i]}}
return toReturn};Tone.Simpler.prototype.triggerAttack=function(time,offset,duration,velocity){time=this.toSeconds(time);this.player.start(time,offset,duration);this.envelope.triggerAttack(time,velocity);return this};Tone.Simpler.prototype.triggerRelease=function(time){time=this.toSeconds(time);this.envelope.triggerRelease(time);this.player.stop(this.toSeconds(this.envelope.release)+time);return this};Tone.Simpler.prototype.triggerAttackRelease=function(length,time,offset,duration,velocity){time=this.toSeconds(time);length=this.toSeconds(length);this.triggerAttack(time,offset,duration,velocity);this.triggerRelease(time+length);return this};Object.defineProperty(Tone.Simpler.prototype,'sample',{get:function(){return this._sample},set:function(name){if(this._buffers.hasOwnProperty(name)){this._sample=name;this.player.buffer=this._buffers[name]}else{throw new Error('Simpler does not have a sample named '+name)}}});Object.defineProperty(Tone.Simpler.prototype,'reverse',{get:function(){for(var i in this._buffers){return this._buffers[i].reverse}},set:function(rev){for(var i in this._buffers){this._buffers[i].reverse=rev}}});Tone.Simpler.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._writable(['player','envelope']);this.player.dispose();this.envelope.dispose();this.player=null;this.envelope=null;for(var sample in this._buffers){this._buffers[sample].dispose();this._buffers[sample]=null}
this._buffers=null;return this};return Tone.Simpler});Module(function(Tone){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;Tone.ExternalInput=function(){var options=this.optionsObject(arguments,['inputNum'],Tone.ExternalInput.defaults);Tone.Source.call(this,options);this._mediaStream=null;this._stream=null;this._constraints={'audio':!0};this._inputNum=options.inputNum;this._gate=new Tone.Gain(0).connect(this.output)};Tone.extend(Tone.ExternalInput,Tone.Source);Tone.ExternalInput.defaults={'inputNum':0};Tone.ExternalInput.prototype._getUserMedia=function(callback){if(!Tone.ExternalInput.supported){throw new Error('browser does not support \'getUserMedia\'')}
if(Tone.ExternalInput.sources[this._inputNum]){this._constraints={audio:{optional:[{sourceId:Tone.ExternalInput.sources[this._inputNum].id}]}}}
navigator.getUserMedia(this._constraints,function(stream){this._onStream(stream);callback()}.bind(this),function(err){callback(err)})};Tone.ExternalInput.prototype._onStream=function(stream){if(!this.isFunction(this.context.createMediaStreamSource)){throw new Error('browser does not support the \'MediaStreamSourceNode\'')}
if(!this._stream){this._stream=stream;this._mediaStream=this.context.createMediaStreamSource(stream);this._mediaStream.connect(this._gate)}};Tone.ExternalInput.prototype.open=function(callback){callback=this.defaultArg(callback,Tone.noOp);Tone.ExternalInput.getSources(function(){this._getUserMedia(callback)}.bind(this));return this};Tone.ExternalInput.prototype.close=function(){if(this._stream){var track=this._stream.getTracks()[this._inputNum];if(!this.isUndef(track)){track.stop()}
this._stream=null}
return this};Tone.ExternalInput.prototype._start=function(time){time=this.toSeconds(time);this._gate.gain.setValueAtTime(1,time);return this};Tone.ExternalInput.prototype._stop=function(time){time=this.toSeconds(time);this._gate.gain.setValueAtTime(0,time);return this};Tone.ExternalInput.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);this.close();if(this._mediaStream){this._mediaStream.disconnect();this._mediaStream=null}
this._constraints=null;this._gate.dispose();this._gate=null;return this};Tone.ExternalInput.sources=[];Tone.ExternalInput._canGetSources=!Tone.prototype.isUndef(window.MediaStreamTrack)&&Tone.prototype.isFunction(MediaStreamTrack.getSources);Object.defineProperty(Tone.ExternalInput,'supported',{get:function(){return Tone.prototype.isFunction(navigator.getUserMedia)}});Tone.ExternalInput.getSources=function(callback){if(Tone.ExternalInput.sources.length===0&&Tone.ExternalInput._canGetSources){MediaStreamTrack.getSources(function(media_sources){for(var i=0;i<media_sources.length;i++){if(media_sources[i].kind==='audio'){Tone.ExternalInput.sources[i]=media_sources[i]}}
callback(Tone.ExternalInput.sources)})}else{callback(Tone.ExternalInput.sources)}
return this};return Tone.ExternalInput});Module(function(Tone){Tone.Microphone=function(){Tone.ExternalInput.call(this,0)};Tone.extend(Tone.Microphone,Tone.ExternalInput);Object.defineProperty(Tone.Microphone,'supported',{get:function(){return Tone.ExternalInput.supported}});return Tone.Microphone});Module(function(Tone){Tone.Clip=function(min,max){if(min>max){var tmp=min;min=max;max=tmp}
this.min=this.input=new Tone.Min(max);this._readOnly('min');this.max=this.output=new Tone.Max(min);this._readOnly('max');this.min.connect(this.max)};Tone.extend(Tone.Clip,Tone.SignalBase);Tone.Clip.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable('min');this.min.dispose();this.min=null;this._writable('max');this.max.dispose();this.max=null;return this};return Tone.Clip});Module(function(Tone){Tone.Normalize=function(inputMin,inputMax){this._inputMin=this.defaultArg(inputMin,0);this._inputMax=this.defaultArg(inputMax,1);this._sub=this.input=new Tone.Add(0);this._div=this.output=new Tone.Multiply(1);this._sub.connect(this._div);this._setRange()};Tone.extend(Tone.Normalize,Tone.SignalBase);Object.defineProperty(Tone.Normalize.prototype,'min',{get:function(){return this._inputMin},set:function(min){this._inputMin=min;this._setRange()}});Object.defineProperty(Tone.Normalize.prototype,'max',{get:function(){return this._inputMax},set:function(max){this._inputMax=max;this._setRange()}});Tone.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin;this._div.value=1/(this._inputMax-this._inputMin)};Tone.Normalize.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._sub.dispose();this._sub=null;this._div.dispose();this._div=null;return this};return Tone.Normalize});Module(function(Tone){Tone.Route=function(outputCount){outputCount=this.defaultArg(outputCount,2);Tone.call(this,1,outputCount);this.gate=new Tone.Signal(0);this._readOnly('gate');for(var i=0;i<outputCount;i++){var routeGate=new RouteGate(i);this.output[i]=routeGate;this.gate.connect(routeGate.selecter);this.input.connect(routeGate)}};Tone.extend(Tone.Route,Tone.SignalBase);Tone.Route.prototype.select=function(which,time){which=Math.floor(which);this.gate.setValueAtTime(which,this.toSeconds(time));return this};Tone.Route.prototype.dispose=function(){this._writable('gate');this.gate.dispose();this.gate=null;for(var i=0;i<this.output.length;i++){this.output[i].dispose();this.output[i]=null}
Tone.prototype.dispose.call(this);return this};var RouteGate=function(num){this.selecter=new Tone.Equal(num);this.gate=this.input=this.output=this.context.createGain();this.selecter.connect(this.gate.gain)};Tone.extend(RouteGate);RouteGate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.selecter.dispose();this.selecter=null;this.gate.disconnect();this.gate=null};return Tone.Route});Module(function(Tone){Tone.Switch=function(open){open=this.defaultArg(open,!1);Tone.call(this);this.gate=new Tone.Signal(0);this._readOnly('gate');this._thresh=new Tone.GreaterThan(0.5);this.input.connect(this.output);this.gate.chain(this._thresh,this.output.gain);if(open){this.open()}};Tone.extend(Tone.Switch,Tone.SignalBase);Tone.Switch.prototype.open=function(time){this.gate.setValueAtTime(1,this.toSeconds(time));return this};Tone.Switch.prototype.close=function(time){this.gate.setValueAtTime(0,this.toSeconds(time));return this};Tone.Switch.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable('gate');this.gate.dispose();this.gate=null;this._thresh.dispose();this._thresh=null;return this};return Tone.Switch});if(typeof define==="function"&&define.amd){define("Tone",[],function(){return Tone})}else if(typeof module==="object"){module.exports=Tone}else{root.Tone=Tone}
Tone.registeredPreload=function(callback){return function(){callback()}};Tone.Buffer.load=function(url,callback){var handle=Tone.registeredPreload();var request=new XMLHttpRequest();request.open("GET",url,!0);request.responseType="arraybuffer";request.onload=function(){Tone.context.decodeAudioData(request.response,function(buff){if(!buff){throw new Error("could not decode audio data:"+url)}
callback(buff);handle()})};request.send();return request};p5.prototype.registerPreloadMethod("registeredPreload",Tone)}(this))